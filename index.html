<!DOCTYPE html>
<html lang="en"> <!-- Default language set here -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EVA Canteen</title> <!-- Updated Title -->
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            /* Colors */
            --main-bg-color: #48B4F6; --lighter-blue-bg: #6ADDEF; --button-bg-color: #6ADDEF;
            --active-green: #90EE90; --remove-red: #FF6B6B; --pending-orange: #FFA500;
            --delivered-green: #32CD32; --preparing-yellow: #FFD700; --text-color-dark: #000;
            --text-color-light: #fff; --border-color: #000;
            /* Sizes & Radii */
            --screen-min-height: 600px; --screen-border-radius: 35px; --element-border-radius: 10px;
            --pill-border-radius: 50px; --border-thickness: 2px;
            /* Transitions */
            --transition-speed: 0.3s; /* <--- USED FOR MODAL ANIMATION */
            --fast-transition-speed: 0.15s; --view-change-speed: 0.4s;
            --lang-change-speed: 0.3s;
            /* Fonts */
            --font-en: 'Nunito', sans-serif; --font-ar: 'Cairo', sans-serif;
        }
        html { font-size: 16px; scroll-behavior: smooth; height: 100%; box-sizing: border-box; }
        *, *:before, *:after { box-sizing: inherit; }
        /* DEFAULT BODY STYLES (LTR) */
        body { background-color: #282828; display: flex; justify-content: center; align-items: flex-start; padding: 20px 10px; font-family: var(--font-en); margin: 0; min-height: 100vh; overflow-x: hidden; transition: padding var(--view-change-speed) ease, background-color var(--view-change-speed) ease; direction: ltr; }

        /* --- START: Arabic (RTL) Styles --- */
        html[lang="ar"] body { direction: rtl; font-family: var(--font-ar); }
        html[lang="ar"] .header { flex-direction: row-reverse; } html[lang="ar"] .header-button i { margin-right: 8px; margin-left: 0; }
        html[lang="ar"] .cart-badge { left: -5px; right: auto; } html[lang="ar"] .menu-item { text-align: right; }
        html[lang="ar"] .cart-item { flex-direction: row-reverse; } /* Image on right */
        html[lang="ar"] .item-details { margin-left: 30px; /* RTL space for remove btn */ margin-right: 10px; /* Gap between image and details */ }
        html[lang="ar"] .item-info { flex-direction: row-reverse; /* RTL: Quantity then Name */ order: 2; /* RTL order: Info second */ }
        html[lang="ar"] .item-info p { text-align: right; /* RTL text align */ }
        html[lang="ar"] .item-price-button { margin-right: auto; /* RTL override - Pushes button to the left */ margin-left: 0; /* Reset LTR margin */ order: 1; /* RTL order: Price first */ }
        html[lang="ar"] .payment-button i { margin-left: 8px; margin-right: 0; } html[lang="ar"] .search-section { flex-direction: row-reverse; }
        html[lang="ar"] .order-id { text-align: right; }
        html[lang="ar"] .order-total { text-align: left; } /* Price aligned left in RTL */
        html[lang="ar"] .order-preview-content p { text-align: right; }
        html[lang="ar"] .order-preview-content ul { padding-left: 0; padding-right: 15px; } html[lang="ar"] .order-status-controls { flex-direction: row-reverse; flex-wrap: wrap-reverse; }
        html[lang="ar"] .status-button i { margin-left: 8px; margin-right: 0; } html[lang="ar"] .add-to-cart-preview-button i { margin-left: 10px; margin-right: 0; }
        html[lang="ar"] input[type="email"], html[lang="ar"] input[type="password"], html[lang="ar"] input[type="text"] { text-align: right; } html[lang="ar"] input::placeholder { text-align: right; }
        html[lang="ar"] .logout-button i, html[lang="ar"] .back-button i, html[lang="ar"] .item-preview-container .header-button i { transform: scaleX(-1); }
        html[lang="ar"] h2, html[lang="ar"] h4, html[lang="ar"] .screen-title, html[lang="ar"] .preview-name, html[lang="ar"] .preview-description, html[lang="ar"] .empty-cart-message, html[lang="ar"] .no-orders-message, html[lang="ar"] .order-preview-placeholder, html[lang="ar"] .error-message, html[lang="ar"] .sort-options p, html[lang="ar"] .payment-label, html[lang="ar"] .switch-account p, html[lang="ar"] .pick-photo-label, html[lang="ar"] #screen-1 .form-box h3, html[lang="ar"] #screen-2 .form-box h3,
        html[lang="ar"] .order-status { text-align: center !important; }
        /* --- END: Arabic (RTL) Styles --- */

        /* App Container */
        .app-container { width: 100%; max-width: 340px; min-height: var(--screen-min-height); position: relative; overflow: hidden; border-radius: var(--screen-border-radius); border: var(--border-thickness) solid var(--border-color); box-shadow: 0 5px 15px rgba(0,0,0,0.2); background-color: var(--main-bg-color); margin: 0 auto; transition: max-width var(--view-change-speed) ease, min-height var(--view-change-speed) ease, height var(--view-change-speed) ease, width var(--view-change-speed) ease, margin var(--view-change-speed) ease, border-radius var(--view-change-speed) ease, border var(--view-change-speed) ease, box-shadow var(--view-change-speed) ease, opacity var(--lang-change-speed) ease-in-out; }
        .app-container.language-switching { opacity: 0; pointer-events: none; }
        /* Full Screen Mode */
        body.full-screen-mode { padding: 0; background-color: var(--main-bg-color); align-items: stretch; overflow: hidden; height: 100%; }
        body.full-screen-mode .app-container { max-width: none; margin: 0; border: none; border-radius: 0; box-shadow: none; width: 100%; height: 100%; min-height: 100%; }
        /* Screen Styling */
        .screen { background-color: var(--main-bg-color); width: 100%; height: 100%; padding: 25px 20px; box-sizing: border-box; display: flex; flex-direction: column; position: absolute; top: 0; left: 0; opacity: 0; pointer-events: none; transform: translateY(40px); transition: opacity var(--transition-speed) ease-in-out, transform calc(var(--transition-speed) * 1.5) cubic-bezier(0.175, 0.885, 0.32, 1.275); overflow-y: auto; z-index: 1; }
        .screen.active { opacity: 1; pointer-events: auto; transform: translateY(0); z-index: 2; }
        .screen-content { display: flex; flex-direction: column; align-items: center; width: 100%; flex-grow: 1; max-width: 1100px; margin-left: auto; margin-right: auto; padding-bottom: 70px; }

        /* (Keep other styles like Headings, Forms, Buttons, etc. as they were) */
        h2 { color: var(--text-color-light); -webkit-text-stroke: 1px var(--text-color-dark); text-stroke: 1px var(--text-color-dark); paint-order: stroke fill; font-size: 2rem; margin-bottom: 25px; text-align: center; font-weight: 700; }
        h3:not(.screen-title) { color: var(--text-color-dark); font-size: 1.3rem; margin-bottom: 20px; text-align: center; }
        h4 { color: var(--text-color-light); -webkit-text-stroke: 1px var(--text-color-dark); text-stroke: 1px var(--text-color-dark); paint-order: stroke fill; font-size: 1.8rem; margin-top: 10px; margin-bottom: 20px; text-align: center; font-weight: 700; }
        #screen-5 h4 { font-size: 1.5rem; margin-bottom: 10px; color: var(--text-color-dark); -webkit-text-stroke: none; text-stroke: none; text-align: center; }
        .form-box { width: 100%; margin-bottom: 25px; display: flex; flex-direction: column; align-items: center; max-width: 450px; }
        #screen-1 .form-box h3, #screen-2 .form-box h3 { font-size: 1.5rem; text-align: center; }
        input[type="email"], input[type="password"], input[type="text"] { background-color: var(--lighter-blue-bg); border: var(--border-thickness) solid var(--border-color); border-radius: var(--element-border-radius); padding: 12px 15px; margin-bottom: 15px; width: 100%; box-sizing: border-box; color: var(--text-color-dark); font-size: 1rem; transition: box-shadow var(--fast-transition-speed) ease; text-align: left; }
        input:focus { outline: none; box-shadow: 0 0 0 2px var(--active-green); }
        input::placeholder { color: #555; text-align: left; }
        .error-message { color: red; font-size: 0.9rem; display: none; margin-top: -10px; margin-bottom: 10px; text-align: center; }
        .button { border: var(--border-thickness) solid var(--border-color); border-radius: var(--pill-border-radius); padding: 10px 25px; cursor: pointer; font-size: 1.1rem; font-weight: 600; text-align: center; background-color: var(--lighter-blue-bg); color: var(--text-color-dark); transition: background-color var(--fast-transition-speed) ease, transform var(--fast-transition-speed) ease; width: 70%; margin-top: 15px; box-sizing: border-box; user-select: none; max-width: 350px; font-family: inherit; }
        .button:hover { background-color: #8beeff; } .button:active { transform: scale(0.96); background-color: #a1f1ff; }
        .button.rect-button { border-radius: var(--element-border-radius); width: 100%; } .button.submit-button { width: auto; padding: 10px 35px; margin-top: 25px; font-size: 1.2rem; }
        .button.small-button { font-size: 0.9rem; padding: 6px 15px; width: auto; margin-top: 5px; } .button.back-button { width: auto; padding: 8px 20px; font-size: 0.9rem; margin-top: 20px; background: transparent; border: none; }
        .switch-account { margin-top: 40px; text-align: center; width: 80%; max-width: 350px; } .switch-account p { font-size: 0.9rem; color: var(--text-color-dark); margin-bottom: 8px; text-align: center; }
        .pick-photo-label { font-size: 1.1rem; color: var(--text-color-dark); margin-top: 20px; margin-bottom: 15px; font-weight: 600; text-align: center; }
        .photo-picker { display: flex; justify-content: center; gap: 20px; margin-bottom: 30px; flex-wrap: wrap; }
        .profile-pic { width: 70px; height: 70px; border-radius: 50%; border: 3px solid transparent; cursor: pointer; object-fit: cover; transition: border-color var(--transition-speed) ease, transform var(--fast-transition-speed) ease; background-color: #eee; }
        .profile-pic:active { transform: scale(0.95); } .profile-pic.active { border-color: var(--border-color); transform: scale(1.05); }
        .header { display: flex; align-items: center; justify-content: space-between; width: 100%; margin-bottom: 30px; padding: 0; position: relative; min-height: 60px; gap: 10px; }
        .header h3.screen-title { flex-grow: 1; text-align: center; margin: 0; font-size: 1.8rem; color: var(--text-color-light); -webkit-text-stroke: 1px var(--text-color-dark); text-stroke: 1px var(--text-color-dark); paint-order: stroke fill; font-weight: 700; }
        .header-button { margin-top: 0; flex-shrink: 0; background: var(--lighter-blue-bg); border: var(--border-thickness) solid var(--border-color); border-radius: var(--element-border-radius); padding: 8px 12px; cursor: pointer; font-size: 0.9rem; font-weight: 600; color: var(--text-color-dark); display: flex; align-items: center; gap: 8px; white-space: nowrap; transition: background-color var(--fast-transition-speed) ease, transform var(--fast-transition-speed) ease; user-select: none; font-family: inherit; }
        .header-button:active { transform: scale(0.96); background-color: #a1f1ff; } .header-button i { font-size: 1.1em; margin-left: 8px; }
        .cart-icon-container, .user-icon-container { margin-top: 0; flex-shrink: 0; position: relative; display: flex; flex-direction: column; align-items: center; gap: 3px; min-width: 50px; cursor: pointer; user-select: none; transition: transform var(--fast-transition-speed) ease; }
        .cart-icon-container:active, .user-icon-container:active { transform: scale(0.95); }
        .cart-icon, .user-icon { width: 45px; height: 45px; border-radius: 50%; border: var(--border-thickness) solid var(--border-color); background-color: var(--lighter-blue-bg); display: flex; justify-content: center; align-items: center; font-size: 1.6rem; color: var(--text-color-dark); transition: background-color var(--fast-transition-speed) ease; overflow: hidden; }
        .user-icon img { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; display: none; } .user-icon i.fa-user { display: block; }
        .cart-icon-container:hover .cart-icon, .user-icon-container:hover .user-icon { background-color: #8beeff; }
        .cart-icon-container span, .user-icon-container span { font-size: 0.8rem; font-weight: 600; color: var(--text-color-dark); }
        .cart-badge { position: absolute; top: -5px; right: -5px; background-color: var(--active-green); color: var(--text-color-light); border-radius: 50%; width: 22px; height: 22px; font-size: 0.8rem; font-weight: 700; display: none; justify-content: center; align-items: center; border: 1px solid var(--border-color); transform-origin: center; animation: pulseBadge 1.5s infinite ease-in-out; }
        .cart-badge.visible { display: flex; } @keyframes pulseBadge { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .sort-options { display: flex; flex-direction: column; align-items: center; width: 100%; margin-bottom: 25px; } .sort-options p { margin: 0 0 10px 0; font-size: 1.2rem; font-weight: 600; color: var(--text-color-dark); text-align: center; }
        .sort-buttons { display: flex; gap: 10px; border: var(--border-thickness) solid var(--border-color); border-radius: var(--pill-border-radius); padding: 5px; background-color: rgba(255, 255, 255, 0.2); flex-wrap: wrap; justify-content: center; }
        .sort-button { background: none; border: none; border-radius: var(--pill-border-radius); padding: 6px 18px; cursor: pointer; font-size: 1rem; font-weight: 600; color: var(--text-color-dark); transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease, transform var(--fast-transition-speed) ease; user-select: none; margin: 2px; font-family: inherit; }
        .sort-button.active { background-color: var(--active-green); color: var(--text-color-dark); } .sort-button:active { transform: scale(0.96); }
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; width: 100%; padding-bottom: 10px; }
        @keyframes fadeInItem { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .menu-item { background-color: var(--main-bg-color); border: var(--border-thickness) solid var(--border-color); border-radius: var(--element-border-radius); padding: 10px; text-align: center; flex-direction: column; align-items: center; justify-content: space-between; box-sizing: border-box; cursor: pointer; transition: transform var(--fast-transition-speed) ease, box-shadow var(--fast-transition-speed) ease; opacity: 1; animation: fadeInItem 0.5s ease-out backwards; display: flex; }
        .menu-item.hidden { display: none; } .menu-item:hover { transform: translateY(-3px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); } .menu-item:active { transform: scale(0.98) translateY(-1px); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .menu-item img { width: 100%; aspect-ratio: 4 / 3; object-fit: cover; border-radius: 5px; margin-bottom: 10px; border: 1px solid rgba(0,0,0,0.1); background-color: #eee; pointer-events: none; }
        .menu-item p { margin: 0 0 10px 0; font-size: 1rem; font-weight: 600; color: var(--text-color-dark); pointer-events: none; text-align: center; }
        .menu-item .price-button { background-color: var(--button-bg-color); border: var(--border-thickness) solid var(--border-color); border-radius: var(--pill-border-radius); padding: 5px 15px; font-size: 0.9rem; font-weight: 700; color: var(--text-color-dark); display: inline-block; transition: background-color var(--fast-transition-speed) ease, transform var(--fast-transition-speed) ease; pointer-events: auto; user-select: none; z-index: 5; position: relative; font-family: inherit; }
        .menu-item .price-button:active { transform: scale(0.95); background-color: #a1f1ff; }
        .cart-items { width: 100%; margin-bottom: 25px; display: flex; flex-direction: column; gap: 15px; min-height: 100px; max-width: 600px; margin-left: auto; margin-right: auto; }
        .cart-item { display: flex; align-items: center; background-color: var(--main-bg-color); border: var(--border-thickness) solid var(--border-color); border-radius: var(--element-border-radius); padding: 10px; gap: 10px; animation: fadeInItem 0.5s ease-out backwards; position: relative; }
        .cart-item img { width: 65px; height: 65px; border-radius: 5px; object-fit: cover; border: 1px solid rgba(0,0,0,0.1); background-color: #eee; flex-shrink: 0; }
        .item-details { flex-grow: 1; display: flex; align-items: center; gap: 10px; flex-wrap: nowrap; margin-right: 30px; overflow: hidden; }
        .item-info { display: flex; flex-direction: row; align-items: baseline; gap: 8px; flex-grow: 1; flex-shrink: 1; overflow: hidden; min-width: 0; order: 1; }
        .item-info p { margin: 0; font-size: 1rem; font-weight: 700; color: var(--text-color-dark); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex-shrink: 1; min-width: 0; text-align: left; }
        span.item-quantity { font-size: 0.9rem; font-weight: 600; color: var(--text-color-dark); margin: 0; white-space: nowrap; flex-shrink: 0; }
        .item-price-button { background-color: var(--button-bg-color); border: var(--border-thickness) solid var(--border-color); border-radius: var(--pill-border-radius); padding: 6px 12px; font-size: 0.9rem; font-weight: 700; color: var(--text-color-dark); white-space: nowrap; margin-left: auto; flex-shrink: 0; font-family: inherit; order: 2; }
        .remove-item-button { position: absolute; top: 5px; right: 5px; background: var(--remove-red); color: white; border: 1px solid var(--border-color); border-radius: 50%; width: 20px; height: 20px; font-size: 0.8rem; line-height: 18px; text-align: center; cursor: pointer; font-weight: bold; transition: background-color var(--fast-transition-speed) ease, transform var(--fast-transition-speed) ease; }
        .remove-item-button:hover { background-color: #E74C3C; } .remove-item-button:active { transform: scale(0.9); }
        .cart-total { padding-top: 15px; width: 100%; margin-top: auto; display: flex; flex-direction: column; align-items: center; gap: 8px; max-width: 600px; margin-left: auto; margin-right: auto; }
        .cart-total h4 { font-size: 1.5rem; margin-bottom: 5px; color: var(--text-color-dark); text-stroke: none; -webkit-text-stroke: none; text-align: center; }
        .total-calculation { text-align: center; width: 100%; font-size: 0.9rem; color: var(--text-color-dark); line-height: 1.4; max-height: 80px; overflow-y: auto; padding: 0 5px; }
        .total-calculation p { margin: 2px 0; font-weight: 600;}
        span.final-equals { font-size: 1.3rem; font-weight: 700; color: var(--text-color-dark); margin-top: 5px; }
        .total-amount-button { background-color: var(--button-bg-color); border: var(--border-thickness) solid var(--border-color); border-radius: var(--pill-border-radius); padding: 8px 25px; font-size: 1.2rem; font-weight: 700; color: var(--text-color-dark); display: inline-block; cursor: pointer; transition: background-color var(--fast-transition-speed) ease, transform var(--fast-transition-speed) ease; user-select: none; font-family: inherit; }
        .total-amount-button:active { transform: scale(0.96); background-color: #a1f1ff; }
        .empty-cart-message, .no-orders-message { color: var(--text-color-dark); font-weight: 600; margin: 20px 0; text-align: center; }
        .payment-method-section { display: flex; flex-direction: column; align-items: center; width: 100%; margin-top: 15px; margin-bottom: 10px; }
        .payment-label { margin: 0 0 8px 0; font-size: 1.1rem; font-weight: 600; color: var(--text-color-dark); text-align: center; }
        .payment-methods { display: flex; gap: 10px; border: var(--border-thickness) solid var(--border-color); border-radius: var(--pill-border-radius); padding: 5px; background-color: rgba(255, 255, 255, 0.2); flex-wrap: wrap; justify-content: center; }
        .payment-button { display: flex; align-items: center; gap: 8px; padding: 6px 15px; margin: 2px; font-family: inherit; }
        .payment-button i { font-size: 1.1em; margin-right: 8px; }
        .management-container { display: flex; flex-direction: column; width: 100%; flex-grow: 1; gap: 20px; }
        .search-section { display: flex; gap: 10px; width: 100%; margin-bottom: 0; flex-wrap: wrap; }
        .search-section input { flex-grow: 1; margin-bottom: 0; min-width: 150px; }
        .search-section .button { width: auto; margin-top: 0; padding: 10px 15px; font-size: 1rem; border-radius: var(--element-border-radius); flex-shrink: 0; }
        .order-management-layout { display: flex; flex-direction: column; flex-grow: 1; gap: 15px; width: 100%; }
        .order-log-section { display: flex; flex-direction: column; width: 100%; }
        .order-log-container { max-height: 200px; overflow-y: auto; border: var(--border-thickness) solid var(--border-color); border-radius: var(--element-border-radius); padding: 10px; background-color: rgba(255, 255, 255, 0.1); display: flex; flex-direction: column; gap: 8px; }
        .order-log-item { display: flex; justify-content: space-between; align-items: center; background-color: var(--lighter-blue-bg); border: 1px solid var(--border-color); border-radius: 5px; padding: 8px 12px; cursor: pointer; transition: background-color var(--fast-transition-speed); gap: 5px; }
        .order-log-item:hover { background-color: #a1f1ff; } .order-log-item.active { background-color: var(--active-green); border-width: 2px; }
        .order-log-item span { font-size: 0.9rem; font-weight: 600; white-space: nowrap; }
        .order-id { flex-basis: 40%; overflow: hidden; text-overflow: ellipsis; flex-shrink: 1; text-align: left; }
        .order-status { flex-basis: 30%; text-align: center; text-transform: capitalize; padding: 2px 6px; border-radius: 4px; color: var(--text-color-dark); flex-shrink: 0; }
        .order-total { flex-basis: 30%; text-align: right; flex-shrink: 0; }
        .order-status.pending { background-color: var(--pending-orange); } .order-status.preparing { background-color: var(--preparing-yellow); } .order-status.delivered { background-color: var(--delivered-green); color: var(--text-color-light); }
        .order-preview-section { display: flex; flex-direction: column; width: 100%; border: var(--border-thickness) solid var(--border-color); border-radius: var(--element-border-radius); padding: 15px; background-color: rgba(255, 255, 255, 0.1); min-height: 150px; }
        .order-preview-content { font-size: 0.9rem; color: var(--text-color-dark); flex-grow: 1; text-align: left; }
        .order-preview-content p { margin: 3px 0; font-weight: 600; } .order-preview-content p strong { margin-right: 5px; } html[lang="ar"] .order-preview-content p strong { margin-left: 5px; margin-right: 0; } .order-preview-content p span { font-weight: normal; }
        .order-preview-content ul { list-style: none; padding-left: 15px; margin: 5px 0; } .order-preview-content li { margin-bottom: 2px; font-size: 0.95em;}
        .order-preview-placeholder { text-align: center; color: #555; margin-top: 20px; }
        .order-status-controls { display: flex; gap: 10px; margin-top: 15px; justify-content: center; flex-wrap: wrap; }
        .status-button { font-family: inherit; } .status-button i { margin-right: 5px; } .status-button.active { background-color: var(--active-green); } .status-button:disabled { background-color: #ccc; cursor: not-allowed; border-color: #999; }
        .item-preview-container { align-items: center; padding-top: 10px; }
        .preview-image { width: 80%; max-width: 220px; height: auto; aspect-ratio: 4 / 3; object-fit: cover; border-radius: var(--element-border-radius); border: var(--border-thickness) solid var(--border-color); margin-bottom: 20px; background-color: #eee; box-shadow: 0 3px 8px rgba(0,0,0,0.15); }
        .preview-name { font-size: 1.7rem; color: var(--text-color-dark); font-weight: 700; margin-bottom: 10px; text-align: center; }
        .preview-description { font-size: 0.95rem; color: var(--text-color-dark); text-align: center; margin-bottom: 20px; margin-top: 0; padding: 0 10px; width: 95%; line-height: 1.4; max-width: 500px; }
        .preview-price { font-size: 1.3rem; font-weight: 700; color: var(--text-color-dark); margin-bottom: 30px; background-color: var(--button-bg-color); padding: 6px 20px; border-radius: var(--pill-border-radius); border: var(--border-thickness) solid var(--border-color); display: inline-block; font-family: inherit; }
        .add-to-cart-preview-button { width: 80%; max-width: 240px; margin-top: auto; margin-bottom: 15px; padding: 12px 20px; font-size: 1.2rem; display: flex; justify-content: center; align-items: center; gap: 10px; background-color: var(--active-green); border-color: var(--border-color); color: var(--text-color-dark); font-family: inherit; }
        .add-to-cart-preview-button i { margin-right: 10px; } .add-to-cart-preview-button:hover { background-color: #76d776; } .add-to-cart-preview-button:active { transform: scale(0.96); background-color: #a1f1ff; }
        .add-to-cart-preview-button.added { background-color: var(--pending-orange); cursor: pointer; }
        .add-to-cart-preview-button.added:hover { background-color: #ffb733; }
        @media (min-width: 600px) { html { font-size: 17px; } body:not(.full-screen-mode) { padding: 30px 20px; } .app-container:not(body.full-screen-mode *) { max-width: 500px; border-radius: 45px; min-height: 650px; } .screen { padding: 30px 30px; } .screen-content { padding-bottom: 80px; } .header { margin-bottom: 40px; min-height: 70px; } .header-button { padding: 10px 15px; } .cart-icon, .user-icon { width: 50px; height: 50px; font-size: 1.8rem; } .menu-grid { gap: 20px; grid-template-columns: repeat(3, 1fr); } .cart-item img { width: 75px; height: 75px; } .item-details { margin-right: 35px; } html[lang="ar"] .item-details { margin-left: 30px; margin-right: 10px; } .remove-item-button { width: 22px; height: 22px; font-size: 0.9rem; line-height: 20px; } .total-calculation { max-height: 100px; } .preview-image { max-width: 280px; } .preview-name { font-size: 1.9rem; } .preview-description { font-size: 1rem; max-width: 600px; } .preview-price { font-size: 1.4rem; } .add-to-cart-preview-button { max-width: 280px; font-size: 1.3rem; } .order-log-container { max-height: 250px; } .order-preview-section { min-height: 200px; } }
        @media (min-width: 992px) { html { font-size: 18px; } body:not(.full-screen-mode) { padding: 40px 30px; align-items: center; } .app-container:not(body.full-screen-mode *) { max-width: 800px; min-height: 700px; border-radius: 50px; } .screen { padding: 35px 40px; } .screen-content { padding-bottom: 90px; } h2 { font-size: 2.5rem; } h4 { font-size: 2rem; } #screen-5 h4 { font-size: 1.7rem; } .menu-grid { grid-template-columns: repeat(3, 1fr); gap: 30px; } .cart-total { gap: 10px; } .total-calculation { max-height: 120px; } .item-preview-container { padding-top: 20px; } .preview-image { max-width: 350px; } .preview-name { font-size: 2.2rem; } .preview-description { font-size: 1.1rem; max-width: 700px; } .preview-price { font-size: 1.5rem; padding: 8px 25px; } .add-to-cart-preview-button { max-width: 320px; padding: 14px 25px; font-size: 1.4rem; } .management-container { gap: 30px; } .order-management-layout { flex-direction: row; align-items: flex-start; gap: 25px; width: 100%; } html[lang="ar"] .order-management-layout { flex-direction: row-reverse; } .order-log-section { flex: 1 1 45%; } .order-log-container { max-height: 420px; } .order-preview-section { flex: 1 1 55%; min-height: 420px; } .order-preview-content { font-size: 1rem; } }
        @media (min-width: 1200px) { .app-container:not(body.full-screen-mode *) { max-width: 900px; } .screen { padding-left: 50px; padding-right: 50px; } .menu-grid { grid-template-columns: repeat(4, 1fr); gap: 30px; } .order-log-container { max-height: 500px; } .order-preview-section { min-height: 500px; } }
        .fixed-button { position: fixed; bottom: 15px; right: 15px; z-index: 1000; background-color: rgba(0, 0, 0, 0.5); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; padding: 0; cursor: pointer; font-size: 1.1rem; line-height: 40px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.3); transition: background-color 0.2s ease, transform 0.2s ease; }
        .fixed-button:hover { background-color: rgba(0, 0, 0, 0.7); transform: scale(1.1); } .fixed-button:active { transform: scale(0.95); }
        #toggle-fullscreen-btn { }
        #lang-toggle-btn { right: 65px; bottom: 15px; font-weight: bold; font-size: 1rem; }
        @media print { #toggle-fullscreen-btn, #lang-toggle-btn { display: none; } }

        /* --- Custom Alert Modal Styles (CHECKED & UPDATED) --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 100;
            /* Use visibility and opacity for transitions */
            visibility: hidden; /* Initially hidden */
            opacity: 0; /* Start fully transparent */
            display: flex; /* Keep as flex for alignment */
            justify-content: center;
            align-items: center;
            padding: 20px;
            /* Animation for the overlay fade */
            transition: opacity var(--transition-speed) ease, visibility var(--transition-speed) ease; /* Animate visibility too */
            font-family: var(--font-en);
        }
        html[lang="ar"] .modal-overlay {
             font-family: var(--font-ar);
        }

        /* When the overlay should be visible */
        .modal-overlay.visible {
            visibility: visible; /* Make it visible */
            opacity: 1; /* Fade it in */
        }

        .modal-box {
            background-color: #E0F7FA;
            padding: 25px 30px;
            border-radius: var(--element-border-radius);
            border: var(--border-thickness) solid #0077B6;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            max-width: 90%;
            width: 320px;
            text-align: center; /* Default for the box itself */
            color: var(--text-color-dark);
            transform: scale(0.9); /* Start slightly scaled down */
            opacity: 0; /* Start transparent */
            /* Animation for the box scale and fade */
            transition: transform var(--transition-speed) ease, opacity var(--transition-speed) ease;
            will-change: transform, opacity; /* Hint for browser */
        }

        /* When the overlay is visible, animate the box in */
        .modal-overlay.visible .modal-box {
            transform: scale(1); /* Scale to normal size */
            opacity: 1; /* Fade it in */
        }

        .modal-box h3 {
            font-size: 1.4rem;
            margin-top: 0;
            margin-bottom: 15px;
            color: var(--text-color-dark);
            font-weight: 700;
        }

        .modal-box p {
            margin-bottom: 25px;
            line-height: 1.6;
            font-size: 1rem;
            font-weight: 600;
            white-space: pre-line;
            /* Text alignment will be handled by language-specific rules below */
        }

        /* CORRECTED RTL/LTR Specific Alignment for Modal Content */
        html[lang="ar"] .modal-box h3,
        html[lang="ar"] .modal-box p {
             text-align: right !important; /* Arabic: Right */
        }
        html[lang="en"] .modal-box h3,
        html[lang="en"] .modal-box p {
             text-align: left !important; /* English: Left */
        }


        .modal-box .button {
            width: auto;
            padding: 8px 35px;
            margin-top: 10px;
            font-size: 1.1rem;
            background-color: var(--button-bg-color);
            border: var(--border-thickness) solid #0077B6;
            color: var(--text-color-dark);
            border-radius: var(--pill-border-radius);
             /* Ensure button inherits transition timing if needed, though base .button has some */
             transition: background-color var(--fast-transition-speed) ease, transform var(--fast-transition-speed) ease, border-color var(--fast-transition-speed) ease;
        }
        .modal-box .button:hover {
             background-color: #8beeff;
             border-color: #0097cf;
        }
        .modal-box .button:active {
             transform: scale(0.96);
             background-color: #a1f1ff;
        }
        /* --- End Custom Alert Modal Styles --- */

    </style>
</head>
<body>
    <!-- (Keep HTML Body Content the same) -->
    <!-- Fixed Buttons -->
    <button id="toggle-fullscreen-btn" class="fixed-button" title="Enter Full Screen"><i class="fas fa-expand"></i></button>
    <button id="lang-toggle-btn" class="fixed-button" title="Switch Language">EN</button>

    <div class="app-container">
        <!-- Screen 1: Login --> <div class="screen" id="screen-1"> <div class="screen-content"> <h2 class="screen-title" data-lang-key="welcome_title">Welcome to<br>EVA Canteen</h2> <div class="form-box"> <h3 data-lang-key="sign_in_label">sign in</h3> <input type="email" id="login-email" data-lang-placeholder-key="email_placeholder" placeholder="email....."> <input type="password" id="login-password" data-lang-placeholder-key="password_placeholder" placeholder="password*****"> <p id="login-error" class="error-message" data-lang-key="login_error_invalid">Invalid credentials (use any)</p> </div> <button class="button submit-button" id="login-submit" data-lang-key="submit_button">submit</button> <div class="switch-account"> <p data-lang-key="new_account_prompt">new account?</p> <button class="button rect-button register-button" data-target="screen-2" data-lang-key="register_button">Register</button> </div> <button class="button small-button" id="goto-admin-login-button" style="margin-top: 25px; background-color: #ffc107; width: auto;"> <i class="fas fa-cog"></i> <span data-lang-key="management_button">Management</span> </button> </div> </div>
        <!-- Screen 2: Register --> <div class="screen" id="screen-2"> <div class="screen-content"> <h2 class="screen-title" data-lang-key="welcome_title">Welcome to<br>EVA Canteen</h2> <div class="form-box"> <h3 data-lang-key="register_button">Register</h3> <input type="email" id="register-email" data-lang-placeholder-key="email_placeholder" placeholder="email....."> <input type="password" id="register-password" data-lang-placeholder-key="password_placeholder" placeholder="password*****"> <input type="password" id="register-password-confirm" data-lang-placeholder-key="password_again_placeholder" placeholder="password again*****"> <p id="register-error" class="error-message" data-lang-key="register_error_match">Passwords don't match or field empty.</p> <p class="pick-photo-label" data-lang-key="pick_photo_label">pick photo</p> <div class="photo-picker" id="register-photo-picker"> <img src="https://i.postimg.cc/6pkqNQdB/file-000000005f5052309370194ce0d09274-conversation-id-67e85992-b064-8005-abf6-a96aee541aaf-message-i.png" alt="Profile Pic 1" class="profile-pic"> <img src="https://i.postimg.cc/XYGqh5B2/IMG.png" alt="Profile Pic 2" class="profile-pic active"> <img src="https://i.postimg.cc/sXy2v068/file-000000000cb852309a865637b17bf852-conversation-id-67e85992-b064-8005-abf6-a96aee541aaf-message-i.png" alt="Profile Pic 3" class="profile-pic"> </div> </div> <button class="button submit-button" id="register-submit" data-lang-key="submit_button">submit</button> <button class="button back-button" data-target="screen-1"> <i class="fas fa-arrow-left"></i> <span data-lang-key="back_to_login_button">Back to Login</span> </button> </div> </div>
        <!-- Screen 3: Menu --> <div class="screen" id="screen-3"> <div class="screen-content"> <div class="header"> <button class="header-button logout-button" id="logout-button"> <span data-lang-key="logout_button">Log out</span> <i class="fas fa-arrow-left"></i> </button> <h3 class="screen-title" data-lang-key="canteen_name">EVA Canteen</h3> <div class="cart-icon-container" data-target="screen-4"> <div class="cart-icon"><i class="fas fa-shopping-cart"></i><span class="cart-badge" id="cart-badge">0</span></div> <span data-lang-key="cart_label">Cart</span> </div> </div> <div class="sort-options"> <p data-lang-key="sort_label">Sort</p> <div class="sort-buttons" id="menu-sort-buttons"> <button class="sort-button active" data-category="sweet" data-lang-key="sort_sweet">sweet</button> <button class="sort-button" data-category="lunch" data-lang-key="sort_lunch">lunch</button> <button class="sort-button" data-category="snacks" data-lang-key="sort_snacks">snacks</button> </div> </div> <div class="menu-grid" id="menu-grid"></div> </div> </div>
        <!-- Screen 4: Cart --> <div class="screen" id="screen-4"> <div class="screen-content"> <div class="header"> <button class="header-button" data-target="screen-3"> <span data-lang-key="menu_label">Menu</span> <i class="fas fa-utensils"></i> </button> <h3 class="screen-title" data-lang-key="canteen_name">EVA Canteen</h3> <div class="user-icon-container"> <div class="user-icon"> <img id="user-profile-image-display" src="" alt="User Profile" style="display: none;"> <i id="guest-user-icon" class="fas fa-user" style="display: block;"></i> </div> <span id="user-display-name">@guest</span> </div> </div> <h4 data-lang-key="cart_label">Cart</h4> <div class="cart-items" id="cart-items-container"></div> <div class="cart-total"> <h4 data-lang-key="total_label">Total</h4> <div class="total-calculation" id="total-calculation-details"></div> <div class="payment-method-section"> <p class="payment-label" data-lang-key="payment_method_label">Payment Method</p> <div class="payment-methods" id="payment-methods"> <button class="sort-button payment-button active" data-method="cash"> <i class="fas fa-money-bill-wave"></i> <span data-lang-key="payment_cash">Cash</span> </button> <button class="sort-button payment-button" data-method="card"> <i class="fas fa-credit-card"></i> <span data-lang-key="payment_card">Card</span> </button> </div> </div> <span class="final-equals">=</span> <span class="total-amount-button" id="checkout-button">0 L.E</span> </div> </div> </div>
        <!-- Screen 6: Admin Login --> <div class="screen" id="screen-6"> <div class="screen-content"> <h2 class="screen-title" data-lang-key="admin_login_title">Management<br>Login</h2> <div class="form-box"> <h3 data-lang-key="admin_enter_creds">Enter Credentials</h3> <input type="email" id="admin-email" data-lang-placeholder-key="admin_email_placeholder" placeholder="admin email....." value="admin@canteen.app"> <input type="password" id="admin-password" data-lang-placeholder-key="admin_password_placeholder" placeholder="admin password*****" value="admin123"> <p id="admin-login-error" class="error-message" data-lang-key="admin_login_error">Invalid admin credentials.</p> </div> <button class="button submit-button" id="admin-login-submit" data-lang-key="login_button">Login</button> <button class="button back-button" data-target="screen-1"> <i class="fas fa-arrow-left"></i> <span data-lang-key="back_to_welcome_button">Back to Welcome</span> </button> </div> </div>
        <!-- Screen 5: Order Management --> <div class="screen" id="screen-5"> <div class="screen-content management-container"> <div class="header"> <button class="header-button back-to-login-button" id="mgmt-back-to-login"> <span data-lang-key="exit_button">Exit</span> <i class="fas fa-sign-out-alt"></i> </button> <h3 class="screen-title" data-lang-key="order_management_title">Order Management</h3> <div style="width: 80px; flex-shrink: 0;"></div> </div> <div class="search-section"> <input type="text" id="order-search-input" data-lang-placeholder-key="search_order_id_placeholder" placeholder="Search by Order ID..."> <button class="button small-button" id="order-search-button"><i class="fas fa-search"></i> <span data-lang-key="search_button">Search</span></button> </div> <div class="order-management-layout"> <div class="order-log-section"> <h4 data-lang-key="order_log_title">Order Log</h4> <div class="order-log-container" id="order-log-container"></div> </div> <div class="order-preview-section" id="order-preview-section"> <h4 data-lang-key="order_preview_title">Order Preview</h4> <div class="order-preview-content" id="order-preview-content"></div> <div class="order-status-controls" id="order-status-controls"></div> </div> </div> </div> </div>
        <!-- Screen 7: Item Preview --> <div class="screen" id="screen-7"> <div class="screen-content item-preview-container"> <div class="header"> <button class="header-button" data-target="screen-3"> <i class="fas fa-arrow-left"></i> <span data-lang-key="back_button">Back</span> </button> <h3 class="screen-title" data-lang-key="item_details_title">Item Details</h3> <div class="cart-icon-container" data-target="screen-4" style="visibility: visible;"> <div class="cart-icon"> <i class="fas fa-shopping-cart"></i> <span class="cart-badge" id="cart-badge-preview">0</span> </div> <span data-lang-key="cart_label">Cart</span> </div> </div> <img id="preview-item-image" src="https://via.placeholder.com/220x165/eee?text=Loading..." alt="Item Image" class="preview-image"> <h3 id="preview-item-name" class="preview-name" data-lang-key="item_name_placeholder">Item Name</h3> <p id="preview-item-description" class="preview-description" data-lang-key="item_description_placeholder">Item description loading...</p> <p id="preview-item-price" class="preview-price">0 L.E</p>
             <button class="button add-to-cart-preview-button" id="add-to-cart-preview-button">
                 <i class="fas fa-cart-plus"></i> <span data-lang-key="add_to_cart_button">Add to Cart</span>
             </button>
        </div> </div>
    </div><!-- end app-container -->

    <!-- Custom Alert Modal -->
    <div id="custom-alert-overlay" class="modal-overlay">
        <div id="custom-alert-box" class="modal-box">
            <h3 data-lang-key="checkout_success_title">Order Confirmed!</h3>
            <p id="custom-alert-message"></p>
            <button id="custom-alert-close" class="button" data-lang-key="ok_button">OK</button>
        </div>
    </div>
    <!-- End Custom Alert Modal -->

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Element References (Keep as before) ---
            const appContainer = document.querySelector('.app-container'), allScreens = document.querySelectorAll('.screen'), navigationElements = document.querySelectorAll('[data-target]'), htmlElement = document.documentElement, bodyElement = document.body, loginEmailInput = document.getElementById('login-email'), loginPasswordInput = document.getElementById('login-password'), loginSubmitButton = document.getElementById('login-submit'), loginErrorMsg = document.getElementById('login-error'), gotoAdminLoginButton = document.getElementById('goto-admin-login-button'), registerEmailInput = document.getElementById('register-email'), registerPasswordInput = document.getElementById('register-password'), registerPasswordConfirmInput = document.getElementById('register-password-confirm'), registerPhotoPicker = document.getElementById('register-photo-picker'), registerSubmitButton = document.getElementById('register-submit'), registerErrorMsg = document.getElementById('register-error'), logoutButton = document.getElementById('logout-button'), menuGrid = document.getElementById('menu-grid'), menuSortButtonsContainer = document.getElementById('menu-sort-buttons'), cartBadge = document.getElementById('cart-badge'), cartItemsContainer = document.getElementById('cart-items-container'), totalCalculationDetails = document.getElementById('total-calculation-details'), checkoutButton = document.getElementById('checkout-button'), userDisplayName = document.getElementById('user-display-name'), userProfileImage = document.getElementById('user-profile-image-display'), guestUserIcon = document.getElementById('guest-user-icon'), paymentMethodsContainer = document.getElementById('payment-methods'), adminEmailInput = document.getElementById('admin-email'), adminPasswordInput = document.getElementById('admin-password'), adminLoginSubmitButton = document.getElementById('admin-login-submit'), adminLoginErrorMsg = document.getElementById('admin-login-error'), mgmtBackToLoginButton = document.getElementById('mgmt-back-to-login'), orderSearchInput = document.getElementById('order-search-input'), orderSearchButton = document.getElementById('order-search-button'), orderLogContainer = document.getElementById('order-log-container'), orderPreviewSection = document.getElementById('order-preview-section'), orderPreviewContent = document.getElementById('order-preview-content'), orderStatusControls = document.getElementById('order-status-controls'), previewItemImage = document.getElementById('preview-item-image'), previewItemName = document.getElementById('preview-item-name'), previewItemDescription = document.getElementById('preview-item-description'), previewItemPrice = document.getElementById('preview-item-price'), addToCartPreviewButton = document.getElementById('add-to-cart-preview-button'), cartBadgePreview = document.getElementById('cart-badge-preview'), toggleFullScreenButton = document.getElementById('toggle-fullscreen-btn'), langToggleButton = document.getElementById('lang-toggle-btn');
            const customAlertOverlay = document.getElementById('custom-alert-overlay');
            const customAlertBox = document.getElementById('custom-alert-box');
            const customAlertMessage = document.getElementById('custom-alert-message');
            const customAlertCloseBtn = document.getElementById('custom-alert-close');
            const customAlertTitle = customAlertBox.querySelector('h3');

            // --- State Variables (Keep as before) ---
            let currentScreen = null, currentUser = null, cart = [], selectedPaymentMethod = 'cash', allOrders = [], currentAdminOrderSelection = null;
            const ADMIN_EMAIL = "admin@canteen.app", ADMIN_PASSWORD = "admin123", DEFAULT_PROFILE_PIC = 'https://i.postimg.cc/XYGqh5B2/IMG.png';
            let currentLanguage = localStorage.getItem('appLanguage') || 'en';
            let previewButtonTimeout = null;

            // --- Data & Translations (Keep as before, including modal keys) ---
            const baseMenuData = [ {id: 'coffee', price: 30, image: 'https://media.elwatannews.com/media/img/mediaarc/large/20237496061663046251.jpg', category: 'sweet', name_key: 'item_name_coffee', description_key: 'item_desc_coffee'}, {id: 'pizza', price: 70, image: 'https://www.foodandwine.com/thmb/4qg95tjf0mgdHqez5OLLYc0PNT4=/750x0/filters:no_upscale():max_bytes(150000):strip_icc():format(webp)/classic-cheese-pizza-FT-RECIPE0422-31a2c938fc2546c9a07b7011658cfd05.jpg', category: 'lunch', name_key: 'item_name_pizza', description_key: 'item_desc_pizza'}, {id: 'cookies', price: 20, image: 'https://interpretationfordream.com/wp-content/uploads/2024/09/069873874340983.webp', category: 'sweet', name_key: 'item_name_cookies', description_key: 'item_desc_cookies'}, {id: 'fries', price: 35, image: 'https://images.themodernproper.com/production/posts/2022/Homemade-French-Fries_8.jpg?w=1200&q=82&auto=format&fit=crop&dm=1662474181&s=687036746e03f50b6204c1390acdb537', category: 'snacks', name_key: 'item_name_fries', description_key: 'item_desc_fries'}, {id: 'burger', price: 60, image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcScReRWtq7d-yl2aIG7jOJs5FUrxeJpi-DyfZ8OycsNa_taC8mePeUW6-JE&s=10', category: 'lunch', name_key: 'item_name_burger', description_key: 'item_desc_burger'}, {id: 'soda', price: 15, image: 'https://jx.sa/8860-large_default/soda-star-water-300-ml-x-24.jpg', category: 'snacks', name_key: 'item_name_soda', description_key: 'item_desc_soda'}, {id: 'salad', price: 45, image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ5sqfCpGLeoxFBPGxFxzmygHlKJgDnU-SJHEx9hVIyhnrpGmldu20OirA&s=10', category: 'lunch', name_key: 'item_name_salad', description_key: 'item_desc_salad'}, {id: 'cake', price: 40, image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRvFIIgqKfBgFotly6OrxXqxBGO_jLh-DIINS_e-_o4gaKlk3I9tvobZaKk&s=10', category: 'sweet', name_key: 'item_name_cake', description_key: 'item_desc_cake'}, {id: 'croissant', price: 25, image: 'https://static01.nyt.com/images/2021/04/07/dining/06croissantsrex1/merlin_184841898_ccc8fb62-ee41-44e8-9ddf-b95b198b88db-articleLarge.jpg', category: 'sweet', name_key: 'item_name_croissant', description_key: 'item_desc_croissant'}, {id: 'pasta', price: 55, image: 'https://images.services.kitchenstories.io/eT6sd87C6s0sOmsM8S2IDw96_Xs=/1080x0/filters:quality(85)/images.kitchenstories.io/wagtailOriginalImages/R131-final-photo-3-sg.jpg', category: 'lunch', name_key: 'item_name_pasta', description_key: 'item_desc_pasta'}, {id: 'chips', price: 10, image: 'https://preppykitchen.com/wp-content/uploads/2024/05/Homemade-Potato-Chips-Recipe-Card.jpg', category: 'snacks', name_key: 'item_name_chips', description_key: 'item_desc_chips'}, {id: 'juice', price: 20, image: 'https://images-prod.healthline.com/hlcmsresource/images/AN_images/orange-juice-1296x728-feature.jpg', category: 'sweet', name_key: 'item_name_juice', description_key: 'item_desc_juice'}, {id: 'sandwich', price: 50, image: 'https://www.dukeshill.co.uk/cdn/shop/articles/20240725081844-chicken-20bacon-20club-20sandwich-20main-20landscape_1024x1024.jpg?v=1724401314', category: 'lunch', name_key: 'item_name_sandwich', description_key: 'item_desc_sandwich'}, {id: 'muffin', price: 22, image: 'https://www.giallozafferano.com/images/269-26998/Chocolate-Chip-Muffins_1200x800.jpg', category: 'sweet', name_key: 'item_name_muffin', description_key: 'item_desc_muffin'}, {id: 'onionrings', price: 30, image: 'https://i0.wp.com/www.angsarap.net/wp-content/uploads/2015/03/Onion-Rings-Wide.jpg', category: 'snacks', name_key: 'item_name_onionrings', description_key: 'item_desc_onionrings'}, {id: 'soup', price: 35, image: 'https://i.postimg.cc/HxCYPzWN/Soup.jpg', category: 'lunch', name_key: 'item_name_soup', description_key: 'item_desc_soup'} ];
            const translations = { welcome_title: { en: "Welcome to<br>EVA Canteen", ar: "  <br> " }, canteen_name: { en: "EVA Canteen", ar: " " }, sign_in_label: { en: "sign in", ar: " " }, email_placeholder: { en: "email.....", ar: " ....." }, password_placeholder: { en: "password*****", ar: " *****" }, password_again_placeholder: { en: "password again*****", ar: "   *****" }, submit_button: { en: "submit", ar: "" }, register_button: { en: "Register", ar: "" }, login_button: { en: "Login", ar: "" }, new_account_prompt: { en: "new account?", ar: " " }, pick_photo_label: { en: "pick photo", ar: " " }, back_to_login_button: { en: "Back to Login", ar: " " }, back_to_welcome_button: { en: "Back to Welcome", ar: " " }, back_button: { en: "Back", ar: "" }, logout_button: { en: "Log out", ar: " " }, cart_label: { en: "Cart", ar: "" }, menu_label: { en: "Menu", ar: "" }, sort_label: { en: "Sort", ar: "" }, sort_sweet: { en: "sweet", ar: "" }, sort_lunch: { en: "lunch", ar: "" }, sort_snacks: { en: "snacks", ar: "" }, total_label: { en: "Total", ar: "" }, payment_method_label: { en: "Payment Method", ar: " " }, payment_cash: { en: "Cash", ar: "" }, payment_card: { en: "Card", ar: "" }, add_to_cart_button: { en: "Add to Cart", ar: "  " }, added_to_cart_button: { en: "Added!", ar: " !" }, item_details_title: { en: "Item Details", ar: " " }, item_name_placeholder: { en: "Item Name", ar: " " }, item_description_placeholder: { en: "Item description loading...", ar: "   ..." }, cart_empty_message: { en: "Your cart is empty.", ar: " ." }, checkout_success_alert: { en: "Payment Method: {method}\nOrder ID: {id}\n\nYour order is placed (simulation).", ar: ": {total}\n : {method}\n : {id}\n\n   ()." }, checkout_success_title: { en: "Order Confirmed!", ar: "  !" }, ok_button: { en: "OK", ar: "" }, cart_is_empty_alert: { en: "Your cart is empty!", ar: " !" }, currency_symbol: { en: "L.E", ar: "." }, quantity_prefix: { en: "x", ar: "" }, login_error_invalid: { en: "Invalid credentials.", ar: "   ." }, login_error_fields: { en: "Please enter email and password.", ar: "     ." }, register_error_match: { en: "Passwords don't match or field empty.", ar: "      ." }, register_error_fields: { en: "Please fill all fields.", ar: "   ." }, register_error_photo: { en: "Please select a profile picture.", ar: "   ." }, management_button: { en: "Management", ar: "" }, admin_login_title: { en: "Management<br>Login", ar: " <br>" }, admin_enter_creds: { en: "Enter Credentials", ar: "  " }, admin_email_placeholder: { en: "admin email.....", ar: " ....." }, admin_password_placeholder: { en: "admin password*****", ar: "  *****" }, admin_login_error: { en: "Invalid admin credentials.", ar: "    ." }, exit_button: { en: "Exit", ar: "" }, order_management_title: { en: "Order Management", ar: " " }, search_order_id_placeholder: { en: "Search by Order ID...", ar: "  ..." }, search_button: { en: "Search", ar: "" }, order_log_title: { en: "Order Log", ar: " " }, no_orders_found: { en: "No orders found.", ar: "    ." }, order_preview_title: { en: "Order Preview", ar: " " }, order_preview_placeholder: { en: "Select an order from the log to view details.", ar: "     ." }, order_id_label: { en: "Order ID", ar: " " }, order_placed_label: { en: "Placed", ar: " " }, order_status_label: { en: "Status", ar: "" }, order_payment_label: { en: "Payment", ar: "" }, order_total_label: { en: "Total", ar: "" }, order_items_label: { en: "Items", ar: "" }, order_status_pending: { en: "pending", ar: " " }, order_status_preparing: { en: "preparing", ar: " " }, order_status_delivered: { en: "delivered", ar: " " }, item_name_coffee: { en: "Coffee", ar: "" }, item_name_pizza: { en: "Pizza", ar: "" }, item_name_cookies: { en: "Cookies", ar: "" }, item_name_fries: { en: "French fries", ar: " " }, item_name_burger: { en: "Burger", ar: "" }, item_name_soda: { en: "Soda", ar: "" }, item_name_salad: { en: "Salad", ar: "" }, item_name_cake: { en: "Cake Slice", ar: " " }, item_name_croissant: { en: "Croissant", ar: "" }, item_name_pasta: { en: "Pasta Aglio e Olio", ar: "   " }, item_name_chips: { en: "Potato Chips", ar: " " }, item_name_juice: { en: "Orange Juice", ar: " " }, item_name_sandwich: { en: "Club Sandwich", ar: " " }, item_name_muffin: { en: "Muffin", ar: "" }, item_name_onionrings: { en: "Onion Rings", ar: " " }, item_name_soup: { en: "Soup of the Day", ar: " " }, item_desc_coffee: { en: "A rich and aromatic blend, perfect to kickstart your day or enjoy a relaxing break.", ar: "         ." }, item_desc_pizza: { en: "Classic cheese pizza with a tangy tomato sauce and a crispy crust. Always a favorite!", ar: "       .   !" }, item_desc_cookies: { en: "Deliciously chewy chocolate chip cookies, baked fresh. Irresistible!", ar: "     .  !" }, item_desc_fries: { en: "Crispy golden french fries, lightly salted. The perfect side or snack.", ar: "     .      ." }, item_desc_burger: { en: "Juicy beef patty on a toasted bun with lettuce, tomato, and our special sauce.", ar: "           ." }, item_desc_soda: { en: "A cold and refreshing fizzy drink to quench your thirst.", ar: "     ." }, item_desc_salad: { en: "A fresh mix of greens, vegetables, and a light vinaigrette dressing. Healthy and tasty!", ar: "        .  !" }, item_desc_cake: { en: "A moist and decadent slice of chocolate cake with creamy frosting. Pure indulgence!", ar: "       .  !" }, item_desc_croissant: { en: "A buttery, flaky, viennoiserie pastry inspired by the shape of the Austrian kipferl.", ar: "        ." }, item_desc_pasta: { en: "Simple yet delicious Italian pasta dish with garlic, olive oil, and red pepper flakes.", ar: "           ." }, item_desc_chips: { en: "Thinly sliced potatoes, deep-fried or baked until crispy. The ultimate salty snack!", ar: "        .    !" }, item_desc_juice: { en: "Freshly squeezed orange juice, packed with Vitamin C and natural sweetness.", ar: "       ." }, item_desc_sandwich: { en: "Classic club sandwich with layers of turkey, bacon, lettuce, tomato, and mayo on toasted bread.", ar: "              ." }, item_desc_muffin: { en: "A soft and moist muffin, perfect for breakfast or a sweet treat. Ask for today's flavor!", ar: "      .    !" }, item_desc_onionrings: { en: "Thick-cut onion rings coated in a crispy batter and fried to golden perfection.", ar: "         ." }, item_desc_soup: { en: "Warm and comforting soup made fresh daily. Please ask your server for today's selection.", ar: "     .      ." }, item_desc_default: { en: "A tasty item from our menu.", ar: "   ." } };

            // --- Helper Functions (Keep as before) ---
            function getText(key) { const ts = translations[key]; if (ts) return ts[currentLanguage] || ts['en'] || `[${key}]`; console.warn(`TKey not found: ${key}`); return `[${key}]`; }
            function getCurrency() { return getText('currency_symbol'); } function formatPrice(p) { return `${p} ${getCurrency()}`; }

            // --- Language and UI Update Functions (Keep as before) ---
            function updateLanguageUI() {
                htmlElement.lang = currentLanguage; langToggleButton.textContent = currentLanguage === 'en' ? '' : 'EN'; langToggleButton.title = currentLanguage === 'en' ? '  ' : 'Switch to English';
                document.querySelectorAll('[data-lang-key]').forEach(el => { const k = el.dataset.langKey, t = getText(k); if (['welcome_title', 'admin_login_title'].includes(k)) el.innerHTML = t; else if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') el.value = t; else if (el.dataset.langValueTarget) el.setAttribute(el.dataset.langValueTarget, t); else el.textContent = t; });
                document.querySelectorAll('[data-lang-placeholder-key]').forEach(el => { const k = el.dataset.langPlaceholderKey; if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') el.placeholder = getText(k); });
                populateMenuGrid(); updateCartUI();
                if (currentScreen && currentScreen.id === 'screen-5') { const lt = currentScreen.querySelector('.order-log-section h4'); if(lt) lt.textContent = getText('order_log_title'); const pt = currentScreen.querySelector('.order-preview-section h4'); if(pt) pt.textContent = getText('order_preview_title'); renderOrderLog(); if (currentAdminOrderSelection) showOrderDetails(currentAdminOrderSelection); else clearOrderPreview(); }
                if (currentScreen && currentScreen.id === 'screen-7') { const ci = addToCartPreviewButton.dataset.itemId; if (ci) showItemPreview(ci, false); }
                updateModalLanguage();
            }

            // --- Screen Management (Keep as before) ---
            function showScreen(id, skip = false) { const ts = document.getElementById(id); if (ts && ts !== currentScreen) { if (currentScreen) currentScreen.classList.remove('active'); requestAnimationFrame(() => { ts.classList.add('active'); currentScreen = ts; if (id !== 'screen-7') resetPreviewButtonState(); if (id === 'screen-4') updateCartUI(); if (id === 'screen-5') { renderOrderLog(); clearOrderPreview(); orderSearchInput.value = ''; } if (id === 'screen-6') adminLoginErrorMsg.style.display = 'none'; if (id === 'screen-7') updateCartBadge(); if (ts && !skip) ts.scrollTop = 0; }); } else if (!ts) console.error(`Screen ${id} not found`); else if (ts === currentScreen && !skip) ts.scrollTop = 0; }

            // --- User and Profile Functions (Keep as before) ---
            function updateUserInfoUI() { if (currentUser) { const n = currentUser.email.split('@')[0]; userDisplayName.textContent = `@${n}`; userProfileImage.src = currentUser.profilePic; userProfileImage.alt = `${n}'s PP`; userProfileImage.style.display = 'block'; guestUserIcon.style.display = 'none'; } else { userDisplayName.textContent = '@guest'; userProfileImage.src = ''; userProfileImage.alt = 'User Profile'; userProfileImage.style.display = 'none'; guestUserIcon.style.display = 'block'; } }

            // --- Menu and Filtering Functions (Keep as before) ---
            function populateMenuGrid() { menuGrid.innerHTML = ''; const acb = menuSortButtonsContainer.querySelector('.sort-button.active'); let ac = 'sweet'; if (acb) ac = acb.dataset.category; else { const sb = menuSortButtonsContainer.querySelector('[data-category="sweet"]'); if(sb) sb.classList.add('active'); } baseMenuData.forEach((item, i) => { const mi = document.createElement('div'); mi.className = 'menu-item'; mi.dataset.id = item.id; mi.dataset.category = item.category; const n = getText(item.name_key), p = formatPrice(item.price); mi.innerHTML = `<img src="${item.image}" alt="${n}"><p>${n}</p><span class="price-button">${p}</span>`; if (item.category !== ac) { mi.classList.add('hidden'); mi.style.animation = 'none'; } else mi.style.animation = `fadeInItem 0.4s ${i * 0.04}s ease-out backwards`; menuGrid.appendChild(mi); }); }
            function applyFilter(s, a = true) { if (!s || s.id !== 'screen-3') return; const m = s.querySelectorAll('.menu-grid .menu-item'), b = s.querySelector('.sort-buttons .sort-button.active'), c = b ? b.dataset.category : null; m.forEach((i, x) => { const v = !c || i.dataset.category === c; i.classList.toggle('hidden', !v); i.style.animation = (v && a) ? `fadeInItem 0.4s ${x * 0.04}s ease-out backwards` : 'none'; }); }

            // --- Cart Functions (Keep as before) ---
            function updateCartBadge() { const t = cart.reduce((s, i) => s + i.quantity, 0); [cartBadge, cartBadgePreview].forEach(b => { if (b) { b.textContent = t; b.classList.toggle('visible', t > 0); } }); }
            function updateCartUI() { cartItemsContainer.innerHTML = ''; totalCalculationDetails.innerHTML = ''; let tp = 0; const c = getCurrency(), qp = getText('quantity_prefix'); if (cart.length === 0) { cartItemsContainer.innerHTML = `<p class="empty-cart-message">${getText('cart_empty_message')}</p>`; } else { cart.forEach(i => { const itp = i.price * i.quantity; tp += itp; const ci = document.createElement('div'); ci.className = 'cart-item'; ci.dataset.id = i.id; const n = getText(i.name_key); ci.innerHTML = `<img src="${i.image}" alt="${n}"><div class="item-details"><div class="item-info"><p title="${n}">${n}</p><span class="item-quantity">${qp}${i.quantity}</span></div><span class="item-price-button">${itp} ${c}</span></div><button class="remove-item-button" title="Remove item">&times;</button>`; cartItemsContainer.appendChild(ci); totalCalculationDetails.innerHTML += `<p>${qp}${i.quantity} ${n} = ${itp} ${c}</p>`; }); } checkoutButton.textContent = `${tp} ${c}`; checkoutButton.disabled = cart.length === 0; updateCartBadge(); }
            function addToCart(id) { const d = baseMenuData.find(i => i.id === id); if (!d) return; const e = cart.find(i => i.id === id); if (e) e.quantity++; else cart.push({ ...d, quantity: 1 }); updateCartUI(); }
            function removeFromCart(id) { const i = cart.findIndex(i => i.id === id); if (i === -1) return; if (cart[i].quantity > 1) cart[i].quantity--; else cart.splice(i, 1); updateCartUI(); }

            // --- Item Preview Functions (Keep as before) ---
             function showItemPreview(id, n = true) { const d = baseMenuData.find(i => i.id === id); if (!d) return; const nm = getText(d.name_key), ds = getText(d.description_key || 'item_desc_default'), p = formatPrice(d.price); previewItemImage.src = d.image; previewItemImage.alt = nm; previewItemName.textContent = nm; previewItemDescription.textContent = ds; previewItemPrice.textContent = p; addToCartPreviewButton.dataset.itemId = id; const itemIsInCart = cart.some(ci => ci.id === id); setPreviewButtonState(itemIsInCart); if (n) showScreen('screen-7'); else updateCartBadge(); }
             function setPreviewButtonState(a) { if (!addToCartPreviewButton) return; addToCartPreviewButton.classList.toggle('added', a); const k = a ? 'added_to_cart_button' : 'add_to_cart_button', i = a ? 'fas fa-check' : 'fas fa-cart-plus'; let spanElement = addToCartPreviewButton.querySelector('span'); if (!spanElement) { spanElement = document.createElement('span'); addToCartPreviewButton.appendChild(spanElement); } spanElement.dataset.langKey = k; spanElement.textContent = getText(k); let iconElement = addToCartPreviewButton.querySelector('i'); if (!iconElement) { iconElement = document.createElement('i'); addToCartPreviewButton.prepend(iconElement, ' '); } iconElement.className = i; }
             function resetPreviewButtonState() { if(addToCartPreviewButton) { if (previewButtonTimeout) { clearTimeout(previewButtonTimeout); previewButtonTimeout = null; } setPreviewButtonState(false); addToCartPreviewButton.dataset.itemId = ''; } }

            // --- Order Placement and Management Functions (Keep as before) ---
             function generateOrderId() { return `ORD-${Date.now()}-${Math.floor(Math.random()*10)}`; }
             function placeOrder() {
                 if (cart.length === 0) {
                     alert(getText('cart_is_empty_alert'));
                     return;
                 }
                 const totalAmount = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                 const order = { id: generateOrderId(), items: cart.map(item => ({ id: item.id, name_key: item.name_key, price: item.price, quantity: item.quantity })), totalAmount: totalAmount, timestamp: new Date(), status: 'pending', paymentMethod: selectedPaymentMethod };
                 allOrders.push(order);
                 console.log("Order Placed:", order);
                 cart = [];
                 selectedPaymentMethod = 'cash';
                 updateCartUI();
                 if (paymentMethodsContainer) paymentMethodsContainer.querySelectorAll('.payment-button').forEach(b => b.classList.toggle('active', b.dataset.method === 'cash'));
                 const alertMessage = getText('checkout_success_alert').replace('{total}', formatPrice(order.totalAmount)).replace('{method}', getText(`payment_${order.paymentMethod}`)).replace('{id}', order.id);
                 showCustomAlert(alertMessage);
             }
             function renderOrderLog(fo = allOrders) { orderLogContainer.innerHTML = ''; const so = [...fo].sort((a, b) => b.timestamp - a.timestamp), c = getCurrency(); if (so.length === 0) { orderLogContainer.innerHTML = `<p class="no-orders-message">${getText('no_orders_found')}</p>`; return; } so.forEach(o => { const li = document.createElement('div'); li.className = 'order-log-item'; li.dataset.orderId = o.id; const ts = getText(`order_status_${o.status}`); li.innerHTML = `<span class="order-id" title="${o.id}">${o.id}</span><span class="order-status ${o.status}">${ts}</span><span class="order-total">${o.totalAmount} ${c}</span>`; li.classList.toggle('active', o.id === currentAdminOrderSelection); li.addEventListener('click', () => { currentAdminOrderSelection = o.id; showOrderDetails(o.id); renderOrderLog(fo); }); orderLogContainer.appendChild(li); }); }
             function clearOrderPreview() { orderPreviewContent.innerHTML = `<p class="order-preview-placeholder">${getText('order_preview_placeholder')}</p>`; orderStatusControls.innerHTML = ''; currentAdminOrderSelection = null; orderLogContainer.querySelectorAll('.order-log-item.active').forEach(i => i.classList.remove('active')); }
             function showOrderDetails(id) { const o = allOrders.find(o => o.id === id); if (!o) { clearOrderPreview(); return; } const c = getCurrency(), l = currentLanguage === 'ar' ? 'ar-EG' : 'en-GB', ft = o.timestamp.toLocaleString(l, { day: '2-digit', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: true }), tst = getText(`order_status_${o.status}`), tp = getText(`payment_${o.paymentMethod}`); let ih = '<ul>'; o.items.forEach(i => { const n = getText(i.name_key); ih += `<li>${getText('quantity_prefix')}${i.quantity} ${n} (${i.price*i.quantity} ${c})</li>`; }); ih += '</ul>'; orderPreviewContent.innerHTML = `<p><strong>${getText('order_id_label')}:</strong> <span>${o.id}</span></p><p><strong>${getText('order_placed_label')}:</strong> <span>${ft}</span></p><p><strong>${getText('order_status_label')}:</strong><span style="text-transform:capitalize;font-weight:bold;">${tst}</span></p><p><strong>${getText('order_payment_label')}:</strong><span style="text-transform:capitalize;">${tp}</span></p><p><strong>${getText('order_total_label')}:</strong> <span>${o.totalAmount} ${c}</span></p><p><strong>${getText('order_items_label')}:</strong></p>${ih}`; renderStatusButtons(o); }
             function renderStatusButtons(o) { orderStatusControls.innerHTML = ''; const ps = ['pending', 'preparing', 'delivered']; ps.forEach(sk => { const b = document.createElement('button'); b.className = 'button small-button status-button'; b.dataset.status = sk; const tst = getText(`order_status_${sk}`); b.textContent = tst.charAt(0).toUpperCase() + tst.slice(1); b.disabled = (o.status === sk); b.classList.toggle('active', o.status === sk); let ic = ''; if (sk === 'pending') ic = 'fas fa-hourglass-start'; else if (sk === 'preparing') ic = 'fas fa-cogs'; else if (sk === 'delivered') ic = 'fas fa-check-circle'; if(ic) { const i = document.createElement('i'); i.className = ic; b.prepend(i, ' '); } b.addEventListener('click', () => updateOrderStatus(o.id, sk)); orderStatusControls.appendChild(b); }); }
             function updateOrderStatus(id, ns) { const i = allOrders.findIndex(o => o.id === id); if (i === -1) return; allOrders[i].status = ns; console.log(`Order ${id} status -> ${ns}`); handleOrderSearch(); }
             function handleOrderSearch() { const st = orderSearchInput.value.trim().toLowerCase(), otd = st ? allOrders.filter(o => o.id.toLowerCase().includes(st)) : allOrders; renderOrderLog(otd); if (currentAdminOrderSelection && otd.some(o => o.id === currentAdminOrderSelection)) showOrderDetails(currentAdminOrderSelection); else clearOrderPreview(); }

            // --- Custom Alert Functions (CHECKED & CONFIRMED) ---
            function updateModalLanguage() {
                if (customAlertTitle) customAlertTitle.textContent = getText('checkout_success_title');
                if (customAlertCloseBtn) customAlertCloseBtn.textContent = getText('ok_button');
            }

            function showCustomAlert(message) {
                if (!customAlertOverlay || !customAlertMessage) return;
                updateModalLanguage();
                customAlertMessage.textContent = message;
                // Use rAF to ensure display is set before adding class for transition
                requestAnimationFrame(() => {
                    customAlertOverlay.classList.add('visible');
                });
            }

            function hideCustomAlert() {
                if (!customAlertOverlay || !customAlertOverlay.classList.contains('visible')) {
                     console.log("Hide alert called but overlay not visible.");
                     // Prevent multiple navigation calls if already hiding
                     return;
                }

                // Remove .visible to trigger CSS fade-out/scale-down
                customAlertOverlay.classList.remove('visible');

                // Calculate duration from CSS to sync JS actions
                const durationStyle = getComputedStyle(customAlertOverlay).transitionDuration;
                 // A more robust way to parse potentially multiple durations
                 const durations = durationStyle.split(',').map(d => parseFloat(d) * 1000);
                 const maxDuration = Math.max(...durations, 300); // Find max duration, fallback 300ms

                console.log(`Modal transition duration: ${maxDuration}ms`); // Debug

                // Use setTimeout with the *calculated* duration
                setTimeout(() => {
                     // Check if it's still supposed to be hidden before navigating
                     // (This check might be redundant if event listeners are careful, but adds safety)
                     if (!customAlertOverlay.classList.contains('visible')) {
                          console.log("Modal transition finished, navigating to screen-3");
                          showScreen('screen-3'); // Navigate AFTER animation
                     } else {
                          console.log("Modal became visible again during hide transition?"); // Should not happen normally
                     }
                }, maxDuration);
            }
            // --- End Custom Alert Functions ---

            // --- Event Listeners (Keep as before, including modal listeners) ---
            navigationElements.forEach(e => e.addEventListener('click', () => { const t = e.dataset.target; if (t) showScreen(t); }));
            loginSubmitButton.addEventListener('click', () => { const e = loginEmailInput.value.trim(), p = loginPasswordInput.value; loginErrorMsg.style.display = 'none'; if (e && p) { currentUser = { email: e, profilePic: DEFAULT_PROFILE_PIC }; loginEmailInput.value = ''; loginPasswordInput.value = ''; updateUserInfoUI(); showScreen('screen-3'); } else { loginErrorMsg.textContent = getText('login_error_fields'); loginErrorMsg.style.display = 'block'; } });
            gotoAdminLoginButton.addEventListener('click', () => showScreen('screen-6'));
            registerSubmitButton.addEventListener('click', () => { const e = registerEmailInput.value.trim(), p = registerPasswordInput.value, c = registerPasswordConfirmInput.value, a = registerPhotoPicker.querySelector('.profile-pic.active'); registerErrorMsg.style.display = 'none'; if (!e || !p || !c) { registerErrorMsg.textContent = getText('register_error_fields'); registerErrorMsg.style.display = 'block'; return; } if (p !== c) { registerErrorMsg.textContent = getText('register_error_match'); registerErrorMsg.style.display = 'block'; return; } if (!a) { registerErrorMsg.textContent = getText('register_error_photo'); registerErrorMsg.style.display = 'block'; return; } currentUser = { email: e, profilePic: a.src }; registerEmailInput.value = ''; registerPasswordInput.value = ''; registerPasswordConfirmInput.value = ''; updateUserInfoUI(); showScreen('screen-3'); });
            registerPhotoPicker.addEventListener('click', e => { if (e.target.classList.contains('profile-pic')) { registerPhotoPicker.querySelectorAll('.profile-pic').forEach(p => p.classList.remove('active')); e.target.classList.add('active'); } });
            logoutButton.addEventListener('click', () => { currentUser = null; cart = []; selectedPaymentMethod = 'cash'; updateCartUI(); updateUserInfoUI(); if(paymentMethodsContainer) paymentMethodsContainer.querySelectorAll('.payment-button').forEach(b => b.classList.toggle('active', b.dataset.method === 'cash')); if (menuSortButtonsContainer) { const dsc = baseMenuData[0]?.category || 'sweet'; menuSortButtonsContainer.querySelectorAll('.sort-button').forEach(b => b.classList.toggle('active', b.dataset.category === dsc)); populateMenuGrid(); } showScreen('screen-1'); });
            menuGrid.addEventListener('click', e => { const mi = e.target.closest('.menu-item'), pb = e.target.closest('.price-button'); if (mi) { const id = mi.dataset.id; if (pb) { addToCart(id); pb.style.transition = 'transform 0.1s ease-out, background-color 0.1s ease-out'; pb.style.backgroundColor = 'var(--active-green)'; pb.style.transform = 'scale(1.1)'; setTimeout(() => { pb.style.backgroundColor = ''; pb.style.transform = ''; setTimeout(() => pb.style.transition = '', 150); }, 150); } else { showItemPreview(id); } } });
            menuSortButtonsContainer.addEventListener('click', e => { if (e.target.classList.contains('sort-button')) { const b = e.target; if (b.classList.contains('active')) return; menuSortButtonsContainer.querySelectorAll('.sort-button').forEach(btn => btn.classList.remove('active')); b.classList.add('active'); applyFilter(document.getElementById('screen-3'), true); } });
            paymentMethodsContainer.addEventListener('click', e => { const b = e.target.closest('.payment-button'); if (b && !b.classList.contains('active')) { selectedPaymentMethod = b.dataset.method; paymentMethodsContainer.querySelectorAll('.payment-button').forEach(btn => btn.classList.remove('active')); b.classList.add('active'); } });
            cartItemsContainer.addEventListener('click', e => { if (e.target.classList.contains('remove-item-button')) { const c = e.target.closest('.cart-item'), id = c?.dataset.id; if (id) removeFromCart(id); } });
            checkoutButton.addEventListener('click', () => { placeOrder(); });
            adminLoginSubmitButton.addEventListener('click', () => { const e = adminEmailInput.value, p = adminPasswordInput.value; adminLoginErrorMsg.style.display = 'none'; if (e === ADMIN_EMAIL && p === ADMIN_PASSWORD) { console.log("Admin login OK"); showScreen('screen-5'); } else { console.log("Admin login FAIL"); adminLoginErrorMsg.textContent = getText('admin_login_error'); adminLoginErrorMsg.style.display = 'block'; } });
            mgmtBackToLoginButton.addEventListener('click', () => { clearOrderPreview(); orderSearchInput.value = ''; showScreen('screen-1'); });
            orderSearchButton.addEventListener('click', handleOrderSearch); orderSearchInput.addEventListener('keypress', e => { if (e.key === 'Enter') handleOrderSearch(); }); orderSearchInput.addEventListener('input', () => { if (orderSearchInput.value.trim() === '') handleOrderSearch(); });
            addToCartPreviewButton.addEventListener('click', e => { const b = e.target.closest('button'), id = b?.dataset.itemId; if (id) { addToCart(id); if (previewButtonTimeout) { clearTimeout(previewButtonTimeout); } setPreviewButtonState(true); previewButtonTimeout = setTimeout(() => { if (currentScreen && currentScreen.id === 'screen-7' && addToCartPreviewButton.dataset.itemId === id) { setPreviewButtonState(false); } previewButtonTimeout = null; }, 1500); } });
            toggleFullScreenButton.addEventListener('click', () => { bodyElement.classList.toggle('full-screen-mode'); const f = bodyElement.classList.contains('full-screen-mode'); toggleFullScreenButton.innerHTML = f ? '<i class="fas fa-compress"></i>' : '<i class="fas fa-expand"></i>'; toggleFullScreenButton.title = f ? 'Exit Full Screen' : 'Enter Full Screen'; });
            langToggleButton.addEventListener('click', () => { appContainer.classList.add('language-switching'); setTimeout(() => { currentLanguage = (currentLanguage === 'en') ? 'ar' : 'en'; localStorage.setItem('appLanguage', currentLanguage); updateLanguageUI(); requestAnimationFrame(() => { appContainer.classList.remove('language-switching'); }); }, parseFloat(getComputedStyle(appContainer).transitionDuration.split(',')[0] || '0.3') * 1000); });

            // --- Custom Alert Event Listeners (CHECKED & CONFIRMED) ---
            customAlertCloseBtn.addEventListener('click', hideCustomAlert);
            customAlertOverlay.addEventListener('click', (e) => {
                // Only hide if the click is on the overlay itself, not the box
                if (e.target === customAlertOverlay) { hideCustomAlert(); }
            });
            // --- End Custom Alert Event Listeners ---

            // --- Initialization (Keep as before) ---
            updateLanguageUI(); showScreen('screen-1'); updateCartUI(); updateUserInfoUI();
        });
    </script>

</body>
</html>