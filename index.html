<!DOCTYPE html>
<html lang="en"> <!-- Default language set here -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EVA Canteen</title> <!-- Updated Title -->
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            /* --- Theme Variables --- */
             /* Blue Theme (Original - Base) */
            --main-bg-color-blue: #48B4F6; --lighter-bg-blue: #6ADDEF; --button-bg-color-blue: #6ADDEF;
            --active-green-blue: #90EE90; --remove-red-blue: #FF6B6B; --pending-orange-blue: #FFA500;
            --delivered-green-blue: #32CD32; --preparing-yellow-blue: #FFD700; --text-color-dark-blue: #000;
            --text-color-light-blue: #fff; --border-color-blue: #000;
            --body-outer-bg-blue: #282828;

            /* Green Theme (Refined) */
            --main-bg-color-green: #4CAF50;    /* Slightly richer green */
            --lighter-bg-green: #81C784;      /* Softer light green */
            --button-bg-color-green: #81C784;
            --active-green-green: #FFEB3B;     /* Vibrant Yellow for contrast */
            --remove-red-green: #ef5350;       /* Slightly softer red */
            --pending-orange-green: #FFA726;   /* Clear Orange */
            --delivered-green-green: #66BB6A;  /* Complementary delivered green */
            --preparing-yellow-green: #FFEE58; /* Lighter preparing yellow */
            --text-color-dark-green: #000;     /* Black text mostly works */
            --text-color-light-green: #fff;
            --border-color-green: #2E7D32;     /* Darker green border */
            --body-outer-bg-green: #1B5E20;     /* Dark forest green */

            /* Purple Theme (Refined) */
            --main-bg-color-purple: #9C27B0;   /* Standard Material Purple */
            --lighter-bg-purple: #CE93D8;     /* Lighter lavender */
            --button-bg-color-purple: #CE93D8;
            --active-green-purple: #76FF03;    /* Bright Lime green active */
            --remove-red-purple: #F44336;      /* Standard Material Red */
            --pending-orange-purple: #FF9800;  /* Standard Material Orange */
            --delivered-green-purple: #4CAF50; /* Standard Material Green */
            --preparing-yellow-purple: #FFEB3B;/* Standard Material Yellow */
            --text-color-dark-purple: #000;    /* Black text */
            --text-color-light-purple: #fff;   /* White text */
            --border-color-purple: #4A148C;    /* Deep purple border */
            --body-outer-bg-purple: #311B92;    /* Deep indigo/purple outer */

            /* Theme 1: White & Blue (Light Blue) */
            --main-bg-color-light-blue: #ffffff; --lighter-bg-light-blue: #E3F2FD; --button-bg-color-light-blue: #E3F2FD;
            --active-green-light-blue: #66BB6A; --remove-red-light-blue: #EF5350; --pending-orange-light-blue: #FFA726;
            --delivered-green-light-blue: #4CAF50; --preparing-yellow-light-blue: #FFEE58; --text-color-dark-light-blue: #0D47A1; /* Dark Blue Text */
            --text-color-light-light-blue: #0D47A1; /* Dark Blue Text for buttons */ --border-color-light-blue: #90A4AE; /* Blue Grey Border */
            --body-outer-bg-light-blue: #ECEFF1; /* Very Light Grey Outer */
            /* Colors for Light Blue Swatch */
            --swatch-light-blue-1: #ffffff;
            --swatch-light-blue-2: #90CAF9; /* A visible light blue */

            /* Theme 2: White & Black (Monochrome Light) */
            --main-bg-color-mono-light: #ffffff; --lighter-bg-mono-light: #f5f5f5; --button-bg-color-mono-light: #f5f5f5;
            --active-green-mono-light: #4CAF50; --remove-red-mono-light: #f44336; --pending-orange-mono-light: #ff9800;
            --delivered-green-mono-light: #8BC34A; --preparing-yellow-mono-light: #FFEB3B; --text-color-dark-mono-light: #000000; /* Black Text */
            --text-color-light-mono-light: #000000; /* Black Text for buttons */ --border-color-mono-light: #000000; /* Black Border */
            --body-outer-bg-mono-light: #e0e0e0; /* Light Grey Outer */
            /* Colors for Monochrome Light Swatch */
            --swatch-mono-light-1: #ffffff;
            --swatch-mono-light-2: #000000;

            /* Theme 3: Dark Grey (Refined Dark) */
            --main-bg-color-dark-grey: #37474F; --lighter-bg-dark-grey: #546E7A; --button-bg-color-dark-grey: #546E7A;
            --active-green-dark-grey: #80CBC4; --remove-red-dark-grey: #EF9A9A; --pending-orange-dark-grey: #FFCC80;
            --delivered-green-dark-grey: #A5D6A7; --preparing-yellow-dark-grey: #FFF59D; --text-color-dark-dark-grey: #ECEFF1; /* Light Text */
            --text-color-light-dark-grey: #ffffff; /* White Text Title */ --border-color-dark-grey: #78909C; /* Lighter Grey Border */
            --body-outer-bg-dark-grey: #263238; /* Very Dark Grey Outer */

            /* Theme 4: Dark Blue (Night) */
            --main-bg-color-night: #0d1b2a; --lighter-bg-night: #1b263b; --button-bg-color-night: #1b263b;
            --active-green-night: #00A896; --remove-red-night: #D00000; --pending-orange-night: #FF8C00;
            --delivered-green-night: #007F5F; --preparing-yellow-night: #FFBA08; --text-color-dark-night: #E0E1DD; /* Off-white text */
            --text-color-light-night: #FFFFFF; /* White Text Title */ --border-color-night: #415a77; /* Mid Blue Border */
            --body-outer-bg-night: #03071e; /* Almost Black Outer */

            /* Theme 5: Black & White (Monochrome Dark) */
            --main-bg-color-mono-dark: #000000;         /* Black background */
            --lighter-bg-mono-dark: #212121;          /* Dark grey for elements */
            --button-bg-color-mono-dark: #212121;
            --active-green-mono-dark: #ffffff;         /* White for active/highlight */
            --remove-red-mono-dark: #bdbdbd;           /* Medium grey for remove */
            --pending-orange-mono-dark: #9e9e9e;       /* Darker grey for pending */
            --delivered-green-mono-dark: #ffffff;      /* White for delivered status button */
            --preparing-yellow-mono-dark: #ffffff;     /* White for preparing status button */
            --text-color-dark-mono-dark: #f5f5f5;      /* Very light grey text */
            --text-color-light-mono-dark: #ffffff;     /* White text for titles/buttons */
            --border-color-mono-dark: #757575;         /* Mid-grey border */
            --body-outer-bg-mono-dark: #121212;         /* Very dark grey outer bg */
            /* Colors for Monochrome Dark Swatch */
            --swatch-mono-dark-1: #000000;
            --swatch-mono-dark-2: #ffffff;

            /* ADDED: Theme 6: Yellow */
            --main-bg-color-yellow: #FFC107;   /* Bright Yellow */
            --lighter-bg-yellow: #FFD54F;    /* Lighter Yellow */
            --button-bg-color-yellow: #FFD54F;
            --active-green-yellow: #7CB342;   /* Lime Green */
            --remove-red-yellow: #F4511E;     /* Deep Orange/Red */
            --pending-orange-yellow: #FB8C00;  /* Orange */
            --delivered-green-yellow: #558B2F; /* Darker Lime Green */
            --preparing-yellow-yellow: #FFEE58;/* Light Yellow */
            --text-color-dark-yellow: #212121; /* Very Dark Grey/Black */
            --text-color-light-yellow: #000000;/* Black */
            --border-color-yellow: #FFA000;   /* Amber */
            --body-outer-bg-yellow: #F57F17;   /* Darker Yellow/Orange */
            /* Colors for Yellow Swatch */
            --swatch-yellow-1: #FFC107;
            --swatch-yellow-2: #FFA000;

            /* ADDED: Theme 7: Orange */
            --main-bg-color-orange: #FF9800;   /* Material Orange */
            --lighter-bg-orange: #FFB74D;    /* Lighter Orange */
            --button-bg-color-orange: #FFB74D;
            --active-green-orange: #AED581;   /* Light Green */
            --remove-red-orange: #E57373;     /* Light Red */
            --pending-orange-orange: #FFB74D;  /* Lighter Orange for contrast */
            --delivered-green-orange: #81C784; /* Complementary Green */
            --preparing-yellow-orange: #FFF176; /* Light Yellow */
            --text-color-dark-orange: #000000; /* Black */
            --text-color-light-orange: #FFFFFF;/* White */
            --border-color-orange: #F57C00;   /* Darker Orange */
            --body-outer-bg-orange: #E65100;   /* Deep Orange */
            /* Colors for Orange Swatch */
            --swatch-orange-1: #FF9800;
            --swatch-orange-2: #F57C00;


             /* Aliases - Initially Point to Blue Theme */
            --main-bg-color: var(--main-bg-color-blue); --lighter-blue-bg: var(--lighter-bg-blue); --button-bg-color: var(--button-bg-color-blue);
            --active-green: var(--active-green-blue); --remove-red: var(--remove-red-blue); --pending-orange: var(--pending-orange-blue);
            --delivered-green: var(--delivered-green-blue); --preparing-yellow: var(--preparing-yellow-blue); --text-color-dark: var(--text-color-dark-blue);
            --text-color-light: var(--text-color-light-blue); --border-color: var(--border-color-blue);
            --body-outer-bg: var(--body-outer-bg-blue); /* Alias for outer bg */

            /* Sizes & Radii */
            --screen-min-height: 600px; --screen-border-radius: 35px; --element-border-radius: 10px;
            --pill-border-radius: 50px; --border-thickness: 2px;
            /* Transitions */
            --transition-speed: 0.3s; --fast-transition-speed: 0.15s; --view-change-speed: 0.4s;
            --lang-change-speed: 0.3s;
            /* Fonts */
            --font-en: 'Nunito', sans-serif; --font-ar: 'Cairo', sans-serif;

            /* ADDED: Fixed Status Colors */
            --status-pending-bg: #FFA500;  /* Orange */
            --status-pending-text: #000000; /* Black */
            --status-preparing-bg: #FFD700; /* Gold */
            --status-preparing-text: #000000;/* Black */
            --status-delivered-bg: #32CD32; /* LimeGreen */
            --status-delivered-text: #ffffff;/* White */
        }

        /* Apply Aliases based on theme attribute */
        body[data-theme="green"] {
            --main-bg-color: var(--main-bg-color-green); --lighter-blue-bg: var(--lighter-bg-green); --button-bg-color: var(--button-bg-color-green);
            --active-green: var(--active-green-green); --remove-red: var(--remove-red-green); --pending-orange: var(--pending-orange-green);
            --delivered-green: var(--delivered-green-green); --preparing-yellow: var(--preparing-yellow-green); --text-color-dark: var(--text-color-dark-green);
            --text-color-light: var(--text-color-light-green); --border-color: var(--border-color-green);
            --body-outer-bg: var(--body-outer-bg-green);
        }
        body[data-theme="purple"] {
            --main-bg-color: var(--main-bg-color-purple); --lighter-blue-bg: var(--lighter-bg-purple); --button-bg-color: var(--button-bg-color-purple);
            --active-green: var(--active-green-purple); --remove-red: var(--remove-red-purple); --pending-orange: var(--pending-orange-purple);
            --delivered-green: var(--delivered-green-purple); --preparing-yellow: var(--preparing-yellow-purple); --text-color-dark: var(--text-color-dark-purple);
            --text-color-light: var(--text-color-light-purple); --border-color: var(--border-color-purple);
            --body-outer-bg: var(--body-outer-bg-purple);
        }
         body[data-theme="light-blue"] {
            --main-bg-color: var(--main-bg-color-light-blue); --lighter-blue-bg: var(--lighter-bg-light-blue); --button-bg-color: var(--button-bg-color-light-blue);
            --active-green: var(--active-green-light-blue); --remove-red: var(--remove-red-light-blue); --pending-orange: var(--pending-orange-light-blue);
            --delivered-green: var(--delivered-green-light-blue); --preparing-yellow: var(--preparing-yellow-light-blue); --text-color-dark: var(--text-color-dark-light-blue);
            --text-color-light: var(--text-color-light-light-blue); --border-color: var(--border-color-light-blue);
            --body-outer-bg: var(--body-outer-bg-light-blue);
        }
        body[data-theme="mono-light"] {
            --main-bg-color: var(--main-bg-color-mono-light); --lighter-blue-bg: var(--lighter-bg-mono-light); --button-bg-color: var(--button-bg-color-mono-light);
            --active-green: var(--active-green-mono-light); --remove-red: var(--remove-red-mono-light); --pending-orange: var(--pending-orange-mono-light);
            --delivered-green: var(--delivered-green-mono-light); --preparing-yellow: var(--preparing-yellow-mono-light); --text-color-dark: var(--text-color-dark-mono-light);
            --text-color-light: var(--text-color-light-mono-light); --border-color: var(--border-color-mono-light);
            --body-outer-bg: var(--body-outer-bg-mono-light);
        }
        body[data-theme="dark-grey"] {
            --main-bg-color: var(--main-bg-color-dark-grey); --lighter-blue-bg: var(--lighter-bg-dark-grey); --button-bg-color: var(--button-bg-color-dark-grey);
            --active-green: var(--active-green-dark-grey); --remove-red: var(--remove-red-dark-grey); --pending-orange: var(--pending-orange-dark-grey);
            --delivered-green: var(--delivered-green-dark-grey); --preparing-yellow: var(--preparing-yellow-dark-grey); --text-color-dark: var(--text-color-dark-dark-grey);
            --text-color-light: var(--text-color-light-dark-grey); --border-color: var(--border-color-dark-grey);
            --body-outer-bg: var(--body-outer-bg-dark-grey);
        }
        body[data-theme="night"] {
            --main-bg-color: var(--main-bg-color-night); --lighter-blue-bg: var(--lighter-bg-night); --button-bg-color: var(--button-bg-color-night);
            --active-green: var(--active-green-night); --remove-red: var(--remove-red-night); --pending-orange: var(--pending-orange-night);
            --delivered-green: var(--delivered-green-night); --preparing-yellow: var(--preparing-yellow-night); --text-color-dark: var(--text-color-dark-night);
            --text-color-light: var(--text-color-light-night); --border-color: var(--border-color-night);
            --body-outer-bg: var(--body-outer-bg-night);
        }
        body[data-theme="mono-dark"] {
            --main-bg-color: var(--main-bg-color-mono-dark); --lighter-blue-bg: var(--lighter-bg-mono-dark); --button-bg-color: var(--button-bg-color-mono-dark);
            --active-green: var(--active-green-mono-dark); --remove-red: var(--remove-red-mono-dark); --pending-orange: var(--pending-orange-mono-dark);
            --delivered-green: var(--delivered-green-mono-dark); --preparing-yellow: var(--preparing-yellow-mono-dark); --text-color-dark: var(--text-color-dark-mono-dark);
            --text-color-light: var(--text-color-light-mono-dark); --border-color: var(--border-color-mono-dark);
            --body-outer-bg: var(--body-outer-bg-mono-dark);
        }
        /* ADDED: Yellow Theme Application */
        body[data-theme="yellow"] {
            --main-bg-color: var(--main-bg-color-yellow); --lighter-blue-bg: var(--lighter-bg-yellow); --button-bg-color: var(--button-bg-color-yellow);
            --active-green: var(--active-green-yellow); --remove-red: var(--remove-red-yellow); --pending-orange: var(--pending-orange-yellow);
            --delivered-green: var(--delivered-green-yellow); --preparing-yellow: var(--preparing-yellow-yellow); --text-color-dark: var(--text-color-dark-yellow);
            --text-color-light: var(--text-color-light-yellow); --border-color: var(--border-color-yellow);
            --body-outer-bg: var(--body-outer-bg-yellow);
        }
        /* ADDED: Orange Theme Application */
        body[data-theme="orange"] {
            --main-bg-color: var(--main-bg-color-orange); --lighter-blue-bg: var(--lighter-bg-orange); --button-bg-color: var(--button-bg-color-orange);
            --active-green: var(--active-green-orange); --remove-red: var(--remove-red-orange); --pending-orange: var(--pending-orange-orange);
            --delivered-green: var(--delivered-green-orange); --preparing-yellow: var(--preparing-yellow-orange); --text-color-dark: var(--text-color-dark-orange);
            --text-color-light: var(--text-color-light-orange); --border-color: var(--border-color-orange);
            --body-outer-bg: var(--body-outer-bg-orange);
        }


        html { font-size: 16px; scroll-behavior: smooth; height: 100%; box-sizing: border-box; }
        *, *:before, *:after { box-sizing: inherit; }

        /* DEFAULT BODY STYLES (LTR) */
        body {
            background-color: var(--body-outer-bg); /* Use theme variable */
            display: flex; justify-content: center; align-items: flex-start; padding: 20px 10px; font-family: var(--font-en); margin: 0; min-height: 100vh; overflow-x: hidden;
            transition: padding var(--view-change-speed) ease, background-color var(--view-change-speed) ease;
            direction: ltr;
        }

        /* --- START: Arabic (RTL) Styles --- */
        html[lang="ar"] body { direction: rtl; font-family: var(--font-ar); }
        html[lang="ar"] .header { flex-direction: row-reverse; } html[lang="ar"] .header-button i { margin-right: 8px; margin-left: 0; }
        html[lang="ar"] .cart-badge { left: -5px; right: auto; } html[lang="ar"] .menu-item { text-align: right; }
        html[lang="ar"] .cart-item { flex-direction: row-reverse; } /* Image on right */
        html[lang="ar"] .item-details { margin-left: 30px; /* RTL space for remove btn */ margin-right: 10px; /* Gap between image and details */ }
        html[lang="ar"] .item-info { flex-direction: row-reverse; /* RTL: Quantity then Name */ order: 2; /* RTL order: Info second */ }
        html[lang="ar"] .item-info p { text-align: right; /* RTL text align */ }
        html[lang="ar"] .item-price-button { margin-right: auto; /* RTL override - Pushes button to the left */ margin-left: 0; /* Reset LTR margin */ order: 1; /* RTL order: Price first */ }
        html[lang="ar"] .payment-button i { margin-left: 8px; margin-right: 0; } html[lang="ar"] .search-section { flex-direction: row-reverse; }
        html[lang="ar"] .order-id { text-align: right; }
        html[lang="ar"] .order-total { text-align: left; } /* Price aligned left in RTL */
        html[lang="ar"] .order-preview-content p { text-align: right; }
        html[lang="ar"] .order-preview-content ul { padding-left: 0; padding-right: 15px; } html[lang="ar"] .order-status-controls { flex-direction: row-reverse; flex-wrap: wrap-reverse; }
        html[lang="ar"] .status-button i { margin-left: 8px; margin-right: 0; }
        /* MODIFIED: RTL for Add to Cart Preview Button Icon */
        html[lang="ar"] .add-to-cart-preview-button i { margin-left: 10px !important; margin-right: 0 !important; }
        html[lang="ar"] input[type="email"], html[lang="ar"] input[type="password"], html[lang="ar"] input[type="text"] { text-align: right; } html[lang="ar"] input::placeholder { text-align: right; }
        html[lang="ar"] .logout-button i, html[lang="ar"] .back-button i, html[lang="ar"] .item-preview-container .header-button i { transform: scaleX(-1); }
        html[lang="ar"] h2, html[lang="ar"] h4, html[lang="ar"] .screen-title, html[lang="ar"] .preview-name, html[lang="ar"] .preview-description, html[lang="ar"] .empty-cart-message, html[lang="ar"] .no-orders-message, html[lang="ar"] .order-preview-placeholder, html[lang="ar"] .error-message, html[lang="ar"] .sort-options p, html[lang="ar"] .payment-label, html[lang="ar"] .switch-account p, html[lang="ar"] .pick-photo-label, html[lang="ar"] #screen-1 .form-box h3, html[lang="ar"] #screen-2 .form-box h3,
        html[lang="ar"] .order-status { text-align: center !important; } /* Keep these centered */
        /* RTL Settings Panel Content */
        html[lang="ar"] #settings-panel { font-family: var(--font-ar); } /* Panel itself stays right */
        html[lang="ar"] .settings-label { text-align: right; }
        /* RTL: Current Display Text */
        html[lang="ar"] .settings-current-display span:first-child:not(.theme-swatch) {
             text-align: right; /* Ensure text aligns right within its span */
        }
        /* RTL: Option Item */
        html[lang="ar"] .option-item { text-align: right; flex-direction: row-reverse; }
        /* RTL: Option Item Text Span Alignment */
        html[lang="ar"] .option-item span:first-of-type:not(.theme-swatch) {
             text-align: right; /* Explicit RTL text alignment */
        }
        html[lang="ar"] .option-item .fa-check { /* No specific margin needed due to row-reverse & gap */ }
        /* RTL: Theme Swatch Spacing */
        html[lang="ar"] .theme-swatch { }
        /* --- END: Arabic (RTL) Styles --- */

        /* App Container */
        .app-container {
            width: 100%; max-width: 340px; min-height: var(--screen-min-height); position: relative; overflow: hidden;
            border-radius: var(--screen-border-radius); border: var(--border-thickness) solid var(--border-color); /* Use theme border */
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); background-color: var(--main-bg-color); /* Use theme background */
            margin: 0 auto;
            transition: max-width var(--view-change-speed) ease, min-height var(--view-change-speed) ease, height var(--view-change-speed) ease, width var(--view-change-speed) ease, margin var(--view-change-speed) ease, border-radius var(--view-change-speed) ease, border var(--view-change-speed) ease, box-shadow var(--view-change-speed) ease, opacity var(--lang-change-speed) ease-in-out, background-color var(--view-change-speed) ease; /* Added background-color */
        }
        .app-container.language-switching { opacity: 0; pointer-events: none; }

        /* Full Screen Mode */
        body.full-screen-mode {
            padding: 0;
            background-color: var(--main-bg-color); /* Use theme variable for FS bg */
            align-items: stretch; overflow: hidden; height: 100%;
        }
        body.full-screen-mode .app-container { max-width: none; margin: 0; border: none; border-radius: 0; box-shadow: none; width: 100%; height: 100%; min-height: 100%; }

         /* Base Screen Styling */
        .screen {
            width: 100%; height: 100%; padding: 25px 20px; box-sizing: border-box;
            display: flex; flex-direction: column;
            position: absolute; top: 0; left: 0;
            opacity: 0; pointer-events: none;
            transform: translateY(40px);
            overflow-y: auto; z-index: 1;
            background-color: var(--main-bg-color);
            transition: opacity var(--transition-speed) ease-in-out,
                        transform calc(var(--transition-speed) * 1.5) cubic-bezier(0.175, 0.885, 0.32, 1.275),
                        background-color var(--view-change-speed) ease;
        }

        /* Active Screen Style */
        .screen.active {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0);
            z-index: 2;
        }

        /* Screen Content Base Style */
        .screen-content {
            display: flex; flex-direction: column; align-items: center;
            width: 100%; flex-grow: 1; max-width: 1100px;
            margin-left: auto; margin-right: auto; padding-bottom: 70px;
        }

        /* General Styles (Headings, Forms, Buttons, etc.) */
        h2 { color: var(--text-color-light); -webkit-text-stroke: 1px var(--text-color-dark); text-stroke: 1px var(--text-color-dark); paint-order: stroke fill; font-size: 2rem; margin-bottom: 25px; text-align: center; font-weight: 700; }
        h3:not(.screen-title) { color: var(--text-color-dark); font-size: 1.3rem; margin-bottom: 20px; text-align: center; }
        h4 { color: var(--text-color-light); -webkit-text-stroke: 1px var(--text-color-dark); text-stroke: 1px var(--text-color-dark); paint-order: stroke fill; font-size: 1.8rem; margin-top: 10px; margin-bottom: 20px; text-align: center; font-weight: 700; }
        #screen-5 h4 { font-size: 1.5rem; margin-bottom: 10px; color: var(--text-color-dark); -webkit-text-stroke: none; text-stroke: none; text-align: center; }
        .form-box { width: 100%; margin-bottom: 25px; display: flex; flex-direction: column; align-items: center; max-width: 450px; }
        #screen-1 .form-box h3, #screen-2 .form-box h3 { font-size: 1.5rem; text-align: center; }
        input[type="email"], input[type="password"], input[type="text"] { background-color: var(--lighter-blue-bg); border: var(--border-thickness) solid var(--border-color); border-radius: var(--element-border-radius); padding: 12px 15px; margin-bottom: 15px; width: 100%; box-sizing: border-box; color: var(--text-color-dark); font-size: 1rem; transition: box-shadow var(--fast-transition-speed) ease, background-color var(--view-change-speed) ease, border-color var(--view-change-speed) ease; text-align: left; }
        input:focus { outline: none; box-shadow: 0 0 0 2px var(--active-green); }
        input::placeholder { color: #555; text-align: left; }
         /* Fix placeholder color visibility on light backgrounds with dark text (e.g., yellow theme) */
        body[data-theme="yellow"] input::placeholder,
        body[data-theme="orange"] input::placeholder {
            color: #777; /* Slightly darker grey */
        }
        .error-message { color: red; font-size: 0.9rem; display: none; margin-top: -10px; margin-bottom: 10px; text-align: center; }
        .button { border: var(--border-thickness) solid var(--border-color); border-radius: var(--pill-border-radius); padding: 10px 25px; cursor: pointer; font-size: 1.1rem; font-weight: 600; text-align: center; background-color: var(--lighter-blue-bg); color: var(--text-color-dark); transition: background-color var(--fast-transition-speed) ease, transform var(--fast-transition-speed) ease, border-color var(--view-change-speed) ease, color var(--view-change-speed) ease; width: 70%; margin-top: 15px; box-sizing: border-box; user-select: none; max-width: 350px; font-family: inherit; }
        .button:hover:not(:active) { background-color: color-mix(in srgb, var(--lighter-blue-bg) 80%, white); }
        .button:active { transform: scale(0.96); background-color: color-mix(in srgb, var(--lighter-blue-bg) 60%, white); }
        .button.rect-button { border-radius: var(--element-border-radius); width: 100%; } .button.submit-button { width: auto; padding: 10px 35px; margin-top: 25px; font-size: 1.2rem; }
        .button.small-button { font-size: 0.9rem; padding: 6px 15px; width: auto; margin-top: 5px; }
        .button.back-button { width: auto; padding: 8px 20px; font-size: 0.9rem; margin-top: 25px; background: transparent; border: none; color: var(--text-color-dark); display: inline-flex; align-items: center; gap: 5px; }
        body[data-theme="light-blue"] .button.back-button,
        body[data-theme="mono-light"] .button.back-button { color: #555; }
        body[data-theme="dark-grey"] .button.back-button,
        body[data-theme="night"] .button.back-button,
        body[data-theme="mono-dark"] .button.back-button { color: #ccc; } /* Added mono-dark */
         /* Back button color for yellow/orange themes */
         body[data-theme="yellow"] .button.back-button,
         body[data-theme="orange"] .button.back-button {
            color: var(--text-color-dark); /* Use the main dark text color of the theme */
         }
        .switch-account { margin-top: 40px; text-align: center; width: 80%; max-width: 350px; } .switch-account p { font-size: 0.9rem; color: var(--text-color-dark); margin-bottom: 8px; text-align: center; }
        .pick-photo-label { font-size: 1.1rem; color: var(--text-color-dark); margin-top: 20px; margin-bottom: 15px; font-weight: 600; text-align: center; }
        .photo-picker { display: flex; justify-content: center; gap: 20px; margin-bottom: 30px; flex-wrap: wrap; }
        .profile-pic { width: 70px; height: 70px; border-radius: 50%; border: 3px solid transparent; cursor: pointer; object-fit: cover; transition: border-color var(--transition-speed) ease, transform var(--fast-transition-speed) ease; background-color: #eee; }
        .profile-pic:active { transform: scale(0.95); } .profile-pic.active { border-color: var(--border-color); transform: scale(1.05); }

        /* Header (General) */
        .header { display: flex; align-items: center; justify-content: space-between; width: 100%; margin-bottom: 30px; padding: 0; position: relative; min-height: 60px; gap: 10px; }
        .header h3.screen-title { flex-grow: 1; text-align: center; margin: 0; font-size: 1.8rem; color: var(--text-color-light); -webkit-text-stroke: 1px var(--text-color-dark); text-stroke: 1px var(--text-color-dark); paint-order: stroke fill; font-weight: 700; }
        .header-button { margin-top: 0; flex-shrink: 0; background: var(--lighter-blue-bg); border: var(--border-thickness) solid var(--border-color); border-radius: var(--element-border-radius); padding: 8px 12px; cursor: pointer; font-size: 0.9rem; font-weight: 600; color: var(--text-color-dark); display: flex; align-items: center; gap: 8px; white-space: nowrap; transition: background-color var(--fast-transition-speed) ease, transform var(--fast-transition-speed) ease, border-color var(--view-change-speed) ease, color var(--view-change-speed) ease; user-select: none; font-family: inherit; }
        .header-button:active { transform: scale(0.96); background-color: color-mix(in srgb, var(--lighter-blue-bg) 60%, white); }
        .header-button i { font-size: 1.1em; margin-left: 8px; }


        /* Cart & User Icons */
        .cart-icon-container, .user-icon-container { margin-top: 0; flex-shrink: 0; position: relative; display: flex; flex-direction: column; align-items: center; gap: 3px; min-width: 50px; cursor: pointer; user-select: none; transition: transform var(--fast-transition-speed) ease; }
        .cart-icon-container:active, .user-icon-container:active { transform: scale(0.95); }
        .cart-icon, .user-icon { width: 45px; height: 45px; border-radius: 50%; border: var(--border-thickness) solid var(--border-color); background-color: var(--lighter-blue-bg); display: flex; justify-content: center; align-items: center; font-size: 1.6rem; color: var(--text-color-dark); transition: background-color var(--fast-transition-speed) ease, border-color var(--view-change-speed) ease, color var(--view-change-speed) ease; overflow: hidden; }
        .user-icon img { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; display: none; } .user-icon i.fa-user { display: block; }
        .cart-icon-container:hover .cart-icon, .user-icon-container:hover .user-icon { background-color: color-mix(in srgb, var(--lighter-blue-bg) 80%, white); }
        .cart-icon-container span, .user-icon-container span { font-size: 0.8rem; font-weight: 600; color: var(--text-color-dark); transition: color var(--view-change-speed) ease;}
        .cart-badge { position: absolute; top: -5px; right: -5px; background-color: var(--active-green); color: var(--text-color-light); border-radius: 50%; width: 22px; height: 22px; font-size: 0.8rem; font-weight: 700; display: none; justify-content: center; align-items: center; border: 1px solid var(--border-color); transform-origin: center; animation: pulseBadge 1.5s infinite ease-in-out; transition: background-color var(--view-change-speed) ease, color var(--view-change-speed) ease, border-color var(--view-change-speed) ease; }
        /* Ensure badge text is readable on active color backgrounds */
        body[data-theme="green"] .cart-badge, /* Yellow active green */
        body[data-theme="yellow"] .cart-badge, /* Lime active green */
        body[data-theme="orange"] .cart-badge { /* Light active green */
             color: var(--text-color-dark); /* Use dark text for these */
        }
        .cart-badge.visible { display: flex; } @keyframes pulseBadge { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        /* Menu Styles */
        .sort-options { display: flex; flex-direction: column; align-items: center; width: 100%; margin-bottom: 25px; } .sort-options p { margin: 0 0 10px 0; font-size: 1.2rem; font-weight: 600; color: var(--text-color-dark); text-align: center; transition: color var(--view-change-speed) ease;}
        .sort-buttons { display: flex; gap: 10px; border: var(--border-thickness) solid var(--border-color); border-radius: var(--pill-border-radius); padding: 5px; background-color: rgba(255, 255, 255, 0.2); flex-wrap: wrap; justify-content: center; transition: border-color var(--view-change-speed) ease;}
        .sort-button { background: none; border: none; border-radius: var(--pill-border-radius); padding: 6px 18px; cursor: pointer; font-size: 1rem; font-weight: 600; color: var(--text-color-dark); transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease, transform var(--fast-transition-speed) ease; user-select: none; margin: 2px; font-family: inherit; }
        .sort-button.active { background-color: var(--active-green); color: var(--text-color-dark); } .sort-button:active { transform: scale(0.96); }
        /* Ensure text on active sort button is readable */
        body[data-theme="green"] .sort-button.active, /* Yellow active green */
        body[data-theme="yellow"] .sort-button.active, /* Lime active green */
        body[data-theme="orange"] .sort-button.active { /* Light active green */
             color: var(--text-color-dark); /* Use dark text for these */
        }
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; width: 100%; padding-bottom: 10px; }
        @keyframes fadeInItem { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .menu-item { background-color: var(--main-bg-color); border: var(--border-thickness) solid var(--border-color); border-radius: var(--element-border-radius); padding: 10px; text-align: center; flex-direction: column; align-items: center; justify-content: space-between; box-sizing: border-box; cursor: pointer; transition: transform var(--fast-transition-speed) ease, box-shadow var(--fast-transition-speed) ease, background-color var(--view-change-speed) ease, border-color var(--view-change-speed) ease; opacity: 1; animation: fadeInItem 0.5s ease-out backwards; display: flex; }
        .menu-item.hidden { display: none; } .menu-item:hover { transform: translateY(-3px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); } .menu-item:active { transform: scale(0.98) translateY(-1px); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .menu-item img { width: 100%; aspect-ratio: 4 / 3; object-fit: cover; border-radius: 5px; margin-bottom: 10px; border: 1px solid rgba(0,0,0,0.1); background-color: #eee; pointer-events: none; }
        .menu-item p { margin: 0 0 10px 0; font-size: 1rem; font-weight: 600; color: var(--text-color-dark); pointer-events: none; text-align: center; transition: color var(--view-change-speed) ease;}
        .menu-item .price-button { background-color: var(--button-bg-color); border: var(--border-thickness) solid var(--border-color); border-radius: var(--pill-border-radius); padding: 5px 15px; font-size: 0.9rem; font-weight: 700; color: var(--text-color-dark); display: inline-block; transition: background-color var(--fast-transition-speed) ease, transform var(--fast-transition-speed) ease, border-color var(--view-change-speed) ease, color var(--view-change-speed) ease; pointer-events: auto; user-select: none; z-index: 5; position: relative; font-family: inherit; }
        .menu-item .price-button:active { transform: scale(0.95); background-color: color-mix(in srgb, var(--button-bg-color) 60%, white); }

        /* Cart Styles */
        .cart-items { width: 100%; margin-bottom: 25px; display: flex; flex-direction: column; gap: 15px; min-height: 100px; max-width: 600px; margin-left: auto; margin-right: auto; }
        .cart-item { display: flex; align-items: center; background-color: var(--main-bg-color); border: var(--border-thickness) solid var(--border-color); border-radius: var(--element-border-radius); padding: 10px; gap: 10px; animation: fadeInItem 0.5s ease-out backwards; position: relative; transition: background-color var(--view-change-speed) ease, border-color var(--view-change-speed) ease;}
        .cart-item img { width: 65px; height: 65px; border-radius: 5px; object-fit: cover; border: 1px solid rgba(0,0,0,0.1); background-color: #eee; flex-shrink: 0; }
        .item-details { flex-grow: 1; display: flex; align-items: center; gap: 10px; flex-wrap: nowrap; margin-right: 30px; overflow: hidden; }
        .item-info { display: flex; flex-direction: row; align-items: baseline; gap: 8px; flex-grow: 1; flex-shrink: 1; overflow: hidden; min-width: 0; order: 1; }
        .item-info p { margin: 0; font-size: 1rem; font-weight: 700; color: var(--text-color-dark); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex-shrink: 1; min-width: 0; text-align: left; transition: color var(--view-change-speed) ease;}
        span.item-quantity { font-size: 0.9rem; font-weight: 600; color: var(--text-color-dark); margin: 0; white-space: nowrap; flex-shrink: 0; transition: color var(--view-change-speed) ease;}
        .item-price-button { background-color: var(--button-bg-color); border: var(--border-thickness) solid var(--border-color); border-radius: var(--pill-border-radius); padding: 6px 12px; font-size: 0.9rem; font-weight: 700; color: var(--text-color-dark); white-space: nowrap; margin-left: auto; flex-shrink: 0; font-family: inherit; order: 2; transition: background-color var(--view-change-speed) ease, border-color var(--view-change-speed) ease, color var(--view-change-speed) ease;}
        .remove-item-button { position: absolute; top: 5px; right: 5px; background: var(--remove-red); color: white; border: 1px solid var(--border-color); border-radius: 50%; width: 20px; height: 20px; font-size: 0.8rem; line-height: 18px; text-align: center; cursor: pointer; font-weight: bold; transition: background-color var(--fast-transition-speed) ease, transform var(--fast-transition-speed) ease, border-color var(--view-change-speed) ease; }
        /* Ensure remove button text is visible */
        body[data-theme="dark-grey"] .remove-item-button, /* Light Red */
        body[data-theme="orange"] .remove-item-button { /* Light Red */
             color: var(--text-color-dark); /* Use dark text for these */
        }
        .remove-item-button:hover { background-color: color-mix(in srgb, var(--remove-red) 80%, black); } .remove-item-button:active { transform: scale(0.9); }
        .cart-total { padding-top: 15px; width: 100%; margin-top: auto; display: flex; flex-direction: column; align-items: center; gap: 8px; max-width: 600px; margin-left: auto; margin-right: auto; }
        .cart-total h4 { font-size: 1.5rem; margin-bottom: 5px; color: var(--text-color-dark); text-stroke: none; -webkit-text-stroke: none; text-align: center; transition: color var(--view-change-speed) ease;}
        .total-calculation { text-align: center; width: 100%; font-size: 0.9rem; color: var(--text-color-dark); line-height: 1.4; max-height: 80px; overflow-y: auto; padding: 0 5px; transition: color var(--view-change-speed) ease;}
        .total-calculation p { margin: 2px 0; font-weight: 600;}
        span.final-equals { font-size: 1.3rem; font-weight: 700; color: var(--text-color-dark); margin-top: 5px; transition: color var(--view-change-speed) ease;}
        .total-amount-button { background-color: var(--button-bg-color); border: var(--border-thickness) solid var(--border-color); border-radius: var(--pill-border-radius); padding: 8px 25px; font-size: 1.2rem; font-weight: 700; color: var(--text-color-dark); display: inline-block; cursor: pointer; transition: background-color var(--fast-transition-speed) ease, transform var(--fast-transition-speed) ease, border-color var(--view-change-speed) ease, color var(--view-change-speed) ease; user-select: none; font-family: inherit; }
        .total-amount-button:active { transform: scale(0.96); background-color: color-mix(in srgb, var(--button-bg-color) 60%, white); }
        .empty-cart-message, .no-orders-message { color: var(--text-color-dark); font-weight: 600; margin: 20px 0; text-align: center; transition: color var(--view-change-speed) ease;}
        .payment-method-section { display: flex; flex-direction: column; align-items: center; width: 100%; margin-top: 15px; margin-bottom: 10px; }
        .payment-label { margin: 0 0 8px 0; font-size: 1.1rem; font-weight: 600; color: var(--text-color-dark); text-align: center; transition: color var(--view-change-speed) ease;}
        .payment-methods { display: flex; gap: 10px; border: var(--border-thickness) solid var(--border-color); border-radius: var(--pill-border-radius); padding: 5px; background-color: rgba(255, 255, 255, 0.2); flex-wrap: wrap; justify-content: center; transition: border-color var(--view-change-speed) ease;}
        .payment-button { display: flex; align-items: center; gap: 8px; padding: 6px 15px; margin: 2px; font-family: inherit; } /* Inherits .sort-button styles */
        /* Ensure payment button text is readable when active */
        body[data-theme="green"] .payment-button.active, /* Yellow active green */
        body[data-theme="yellow"] .payment-button.active, /* Lime active green */
        body[data-theme="orange"] .payment-button.active { /* Light active green */
             color: var(--text-color-dark); /* Use dark text for these */
        }
        .payment-button i { font-size: 1.1em; margin-right: 8px; }

        /* Management Screen */
        .management-container { display: flex; flex-direction: column; width: 100%; flex-grow: 1; gap: 20px; }
        .search-section { display: flex; gap: 10px; width: 100%; margin-bottom: 0; flex-wrap: wrap; }
        .search-section input { flex-grow: 1; margin-bottom: 0; min-width: 150px; }
        .search-section .button { width: auto; margin-top: 0; padding: 10px 15px; font-size: 1rem; border-radius: var(--element-border-radius); flex-shrink: 0; }
        .order-management-layout { display: flex; flex-direction: column; flex-grow: 1; gap: 15px; width: 100%; }
        .order-log-section { display: flex; flex-direction: column; width: 100%; }
        .order-log-container { max-height: 200px; overflow-y: auto; border: var(--border-thickness) solid var(--border-color); border-radius: var(--element-border-radius); padding: 10px; background-color: rgba(255, 255, 255, 0.1); display: flex; flex-direction: column; gap: 8px; transition: border-color var(--view-change-speed) ease;}
        .order-log-item { display: flex; justify-content: space-between; align-items: center; background-color: var(--lighter-blue-bg); border: 1px solid var(--border-color); border-radius: 5px; padding: 8px 12px; cursor: pointer; transition: background-color var(--fast-transition-speed), border-color var(--view-change-speed), color var(--view-change-speed); gap: 5px; }
        .order-log-item:hover { background-color: color-mix(in srgb, var(--lighter-blue-bg) 80%, white); } .order-log-item.active { background-color: var(--active-green); border-width: 2px; }
         /* Ensure text on active order log item is readable */
         body[data-theme="green"] .order-log-item.active, /* Yellow active green */
         body[data-theme="yellow"] .order-log-item.active, /* Lime active green */
         body[data-theme="orange"] .order-log-item.active { /* Light active green */
              color: var(--text-color-dark); /* Use dark text for these */
         }
         body[data-theme="green"] .order-log-item.active span,
         body[data-theme="yellow"] .order-log-item.active span,
         body[data-theme="orange"] .order-log-item.active span {
              color: inherit; /* Inherit dark text */
         }
        .order-log-item span { font-size: 0.9rem; font-weight: 600; white-space: nowrap; transition: color var(--view-change-speed) ease;}
        .order-id { flex-basis: 40%; overflow: hidden; text-overflow: ellipsis; flex-shrink: 1; text-align: left; color: var(--text-color-dark); }
        .order-total { flex-basis: 30%; text-align: right; flex-shrink: 0; color: var(--text-color-dark); }

        /* Order Status Styling */
        .order-status { flex-basis: 30%; text-align: center; text-transform: capitalize; padding: 3px 8px; border-radius: 4px; font-weight: 700; flex-shrink: 0; transition: background-color 0.2s ease, color 0.2s ease; border: 1px solid rgba(0,0,0,0.2); }
        .order-status.pending { background-color: var(--status-pending-bg); color: var(--status-pending-text); }
        .order-status.preparing { background-color: var(--status-preparing-bg); color: var(--status-preparing-text); }
        .order-status.delivered { background-color: var(--status-delivered-bg); color: var(--status-delivered-text); }

        .order-preview-section { display: flex; flex-direction: column; width: 100%; border: var(--border-thickness) solid var(--border-color); border-radius: var(--element-border-radius); padding: 15px; background-color: rgba(255, 255, 255, 0.1); min-height: 150px; transition: border-color var(--view-change-speed) ease;}
        .order-preview-content { font-size: 0.9rem; color: var(--text-color-dark); flex-grow: 1; text-align: left; transition: color var(--view-change-speed) ease;}
        .order-preview-content p { margin: 3px 0; font-weight: 600; } .order-preview-content p strong { margin-right: 5px; } html[lang="ar"] .order-preview-content p strong { margin-left: 5px; margin-right: 0; } .order-preview-content p span { font-weight: normal; }
        .order-preview-content ul { list-style: none; padding-left: 15px; margin: 5px 0; } .order-preview-content li { margin-bottom: 2px; font-size: 0.95em;}
        .order-preview-placeholder { text-align: center; color: #555; margin-top: 20px; transition: color var(--view-change-speed) ease;}
         /* Placeholder color for light themes */
         body[data-theme="yellow"] .order-preview-placeholder,
         body[data-theme="orange"] .order-preview-placeholder {
              color: #888; /* Slightly darker grey */
         }
        .order-status-controls { display: flex; gap: 10px; margin-top: 15px; justify-content: center; flex-wrap: wrap; }
        .status-button { font-family: inherit; } .status-button i { margin-right: 5px; } .status-button.active { background-color: var(--active-green); } .status-button:disabled { background-color: #ccc; cursor: not-allowed; border-color: #999; color: #666; }
         /* Ensure text on active status button is readable */
         body[data-theme="green"] .status-button.active, /* Yellow active green */
         body[data-theme="yellow"] .status-button.active, /* Lime active green */
         body[data-theme="orange"] .status-button.active { /* Light active green */
              color: var(--text-color-dark); /* Use dark text for these */
         }


        /* Item Preview Screen */
        .item-preview-container { align-items: center; padding-top: 10px; }
        .preview-image { width: 80%; max-width: 220px; height: auto; aspect-ratio: 4 / 3; object-fit: cover; border-radius: var(--element-border-radius); border: var(--border-thickness) solid var(--border-color); margin-bottom: 20px; background-color: #eee; box-shadow: 0 3px 8px rgba(0,0,0,0.15); transition: border-color var(--view-change-speed) ease;}
        .preview-name { font-size: 1.7rem; color: var(--text-color-dark); font-weight: 700; margin-bottom: 10px; text-align: center; transition: color var(--view-change-speed) ease;}
        .preview-description { font-size: 0.95rem; color: var(--text-color-dark); text-align: center; margin-bottom: 20px; margin-top: 0; padding: 0 10px; width: 95%; line-height: 1.4; max-width: 500px; transition: color var(--view-change-speed) ease;}
        .preview-price { font-size: 1.3rem; font-weight: 700; color: var(--text-color-dark); margin-bottom: 30px; background-color: var(--button-bg-color); padding: 6px 20px; border-radius: var(--pill-border-radius); border: var(--border-thickness) solid var(--border-color); display: inline-block; font-family: inherit; transition: background-color var(--view-change-speed) ease, border-color var(--view-change-speed) ease, color var(--view-change-speed) ease;}
        .add-to-cart-preview-button { width: 80%; max-width: 240px; margin-top: auto; margin-bottom: 15px; padding: 12px 20px; font-size: 1.2rem; display: flex; justify-content: center; align-items: center; gap: 10px; background-color: var(--active-green); border-color: var(--border-color); color: var(--text-color-dark); font-family: inherit; transition: background-color var(--fast-transition-speed) ease, transform var(--fast-transition-speed) ease, border-color var(--view-change-speed) ease, color var(--view-change-speed) ease;}
        /* Ensure text on add-to-cart button is readable */
        body[data-theme="green"] .add-to-cart-preview-button, /* Yellow active green */
        body[data-theme="yellow"] .add-to-cart-preview-button, /* Lime active green */
        body[data-theme="orange"] .add-to-cart-preview-button { /* Light active green */
             color: var(--text-color-dark); /* Use dark text for these */
        }
        /* Ensure text on 'added' state button is readable */
         body[data-theme="yellow"] .add-to-cart-preview-button.added { background-color: var(--pending-orange-yellow); color: var(--text-color-dark-yellow); }
         body[data-theme="yellow"] .add-to-cart-preview-button.added:hover:not(:active) { background-color: color-mix(in srgb, var(--pending-orange-yellow) 80%, white); }
         body[data-theme="orange"] .add-to-cart-preview-button.added { background-color: var(--pending-orange-orange); color: var(--text-color-dark-orange); }
         body[data-theme="orange"] .add-to-cart-preview-button.added:hover:not(:active) { background-color: color-mix(in srgb, var(--pending-orange-orange) 80%, white); }


        .add-to-cart-preview-button i { margin-right: 10px !important; margin-left: 0 !important; }
        .add-to-cart-preview-button:hover:not(:active) { background-color: color-mix(in srgb, var(--active-green) 80%, white); }
        .add-to-cart-preview-button:active { transform: scale(0.96); background-color: color-mix(in srgb, var(--active-green) 60%, white); }
        .add-to-cart-preview-button.added { background-color: var(--pending-orange); cursor: pointer; color: var(--text-color-dark); /* Default pending color text */ }
        .add-to-cart-preview-button.added:hover:not(:active) { background-color: color-mix(in srgb, var(--pending-orange) 80%, white); }


        /* --- Floating Settings Panel Styles --- */
        #settings-panel { position: fixed; bottom: 65px; right: 15px; width: 280px; background-color: #4a4a4a; color: #e0e0e0; border-radius: 12px; padding: 15px 20px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4); z-index: 1100; font-family: var(--font-en); border: 1px solid #666; visibility: hidden; opacity: 0; transform: translateY(15px) scale(0.95); transform-origin: bottom right; transition: visibility 0.25s ease-out, opacity 0.25s ease-out, transform 0.25s ease-out; }
        html[lang="ar"] #settings-panel { font-family: var(--font-ar); }
        #settings-panel.visible { visibility: visible; opacity: 1; transform: translateY(0) scale(1); }
        .settings-group { margin-bottom: 15px; position: relative; } .settings-group:last-child { margin-bottom: 5px; }
        .settings-label { display: block; font-size: 0.9rem; font-weight: 600; color: #bbb; margin-bottom: 8px; text-align: left; } html[lang="ar"] .settings-label { text-align: right; }
        .settings-current-display { display: flex; align-items: center; gap: 10px; background-color: #5f5f5f; padding: 10px 12px; border-radius: 8px; cursor: pointer; border: 1px solid #777; transition: background-color 0.2s ease; outline: none; }
        .settings-current-display:hover, .settings-current-display:focus { background-color: #6a6a6a; }
        .settings-current-display span:first-child:not(.theme-swatch) { flex-grow: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; } html[lang="ar"] .settings-current-display span:first-child:not(.theme-swatch) { text-align: right; }
        .settings-current-display .fa-chevron-down { transition: transform 0.3s ease; font-size: 0.9em; color: #ccc; flex-shrink: 0; } .settings-group.open .settings-current-display .fa-chevron-down { transform: rotate(180deg); }
        .settings-options-list { position: absolute; background-color: #3a3a3a; border-radius: 8px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3); z-index: 1101; padding: 5px 0; width: 100%; left: 0; top: calc(100% + 5px); border: 1px solid #555; max-height: 0; overflow: hidden; opacity: 0; visibility: hidden; transition: max-height 0.25s ease-out, opacity 0.25s ease-out; }
        .settings-group.open-upward .settings-options-list { top: auto; bottom: calc(100% + 5px); }
        .settings-group.open .settings-options-list { max-height: 200px; opacity: 1; visibility: visible; overflow-y: auto; transition: max-height 0.25s ease-out, opacity 0.25s ease-out; z-index: 1102; }
        .option-item { display: flex; align-items: center; gap: 8px; padding: 10px 15px; cursor: pointer; color: #e0e0e0; transition: background-color 0.15s ease; text-align: left; } html[lang="ar"] .option-item { text-align: right; flex-direction: row-reverse; }
        .option-item:hover { background-color: #555; }
        .option-item span:first-of-type:not(.theme-swatch) { flex-grow: 1; text-align: left; } html[lang="ar"] .option-item span:first-of-type:not(.theme-swatch) { text-align: right; }
        .option-item .fa-check { display: none; color: #00bcd4; font-size: 0.9em; flex-shrink: 0; }
        .option-item.active .fa-check { display: inline-block; } .option-item.active { font-weight: 700; color: #fff; }
        .theme-swatch { display: inline-block; width: 18px; height: 18px; border-radius: 50%; border: 1px solid #888; flex-shrink: 0; vertical-align: middle; background-color: #ccc; }
        .swatch-blue { background-color: var(--main-bg-color-blue); } .swatch-green { background-color: var(--main-bg-color-green); } .swatch-purple { background-color: var(--main-bg-color-purple); } .swatch-dark-grey { background-color: var(--main-bg-color-dark-grey); } .swatch-night { background-color: var(--main-bg-color-night); }
        .swatch-light-blue { background: linear-gradient(to right, var(--swatch-light-blue-1) 0%, var(--swatch-light-blue-1) 50%, var(--swatch-light-blue-2) 50%, var(--swatch-light-blue-2) 100%); background-color: transparent; }
        .swatch-mono-light { background: linear-gradient(to right, var(--swatch-mono-light-1) 0%, var(--swatch-mono-light-1) 50%, var(--swatch-mono-light-2) 50%, var(--swatch-mono-light-2) 100%); background-color: transparent; }
        .swatch-mono-dark { background: linear-gradient(to right, var(--swatch-mono-dark-1) 0%, var(--swatch-mono-dark-1) 50%, var(--swatch-mono-dark-2) 50%, var(--swatch-mono-dark-2) 100%); background-color: transparent; }
        /* ADDED: Swatch Styles for Yellow & Orange */
        .swatch-yellow { background: linear-gradient(to right, var(--swatch-yellow-1) 0%, var(--swatch-yellow-1) 50%, var(--swatch-yellow-2) 50%, var(--swatch-yellow-2) 100%); background-color: transparent; }
        .swatch-orange { background: linear-gradient(to right, var(--swatch-orange-1) 0%, var(--swatch-orange-1) 50%, var(--swatch-orange-2) 50%, var(--swatch-orange-2) 100%); background-color: transparent; }
        /* --- End Floating Settings Panel Styles --- */

        /* Order Preview Dark/Light Theme Text Color Fix */
        body[data-theme="dark-grey"] #order-preview-content,
        body[data-theme="night"] #order-preview-content,
        body[data-theme="mono-dark"] #order-preview-content { /* Added mono-dark */
            color: var(--text-color-dark); /* Use the theme's light text */
        }
        body[data-theme="dark-grey"] #order-preview-content p, body[data-theme="dark-grey"] #order-preview-content li, body[data-theme="dark-grey"] #order-preview-content span, body[data-theme="dark-grey"] #order-preview-content strong,
        body[data-theme="night"] #order-preview-content p, body[data-theme="night"] #order-preview-content li, body[data-theme="night"] #order-preview-content span, body[data-theme="night"] #order-preview-content strong,
        body[data-theme="mono-dark"] #order-preview-content p, body[data-theme="mono-dark"] #order-preview-content li, body[data-theme="mono-dark"] #order-preview-content span, body[data-theme="mono-dark"] #order-preview-content strong { /* Added mono-dark */
            color: inherit; /* Inherit the light color from parent */
        }
         /* Placeholder color for dark themes */
        body[data-theme="dark-grey"] .order-preview-placeholder,
        body[data-theme="night"] .order-preview-placeholder,
        body[data-theme="mono-dark"] .order-preview-placeholder { /* Added mono-dark */
             color: #90A4AE; /* Lighter grey */
        }

        /* --- Custom Alert Modal Styles --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); z-index: 100; visibility: hidden; opacity: 0; display: flex; justify-content: center; align-items: center; padding: 20px; transition: opacity var(--transition-speed) ease, visibility var(--transition-speed) ease; font-family: var(--font-en); }
        html[lang="ar"] .modal-overlay { font-family: var(--font-ar); } .modal-overlay.visible { visibility: visible; opacity: 1; }
        .modal-box { background-color: #E0F7FA; padding: 25px 30px; border-radius: var(--element-border-radius); border: var(--border-thickness) solid #0077B6; box-shadow: 0 5px 15px rgba(0,0,0,0.3); max-width: 90%; width: 320px; text-align: center; color: #111; transform: scale(0.9); opacity: 0; transition: transform var(--transition-speed) ease, opacity var(--transition-speed) ease; will-change: transform, opacity; }
        .modal-overlay.visible .modal-box { transform: scale(1); opacity: 1; }
        .modal-box h3 { font-size: 1.4rem; margin-top: 0; margin-bottom: 15px; color: #000; font-weight: 700; -webkit-text-stroke: 0; text-stroke: 0; }
        .modal-box p { margin-bottom: 25px; line-height: 1.6; font-size: 1rem; font-weight: 600; white-space: pre-line; color: #333; }
        html[lang="ar"] .modal-box h3, html[lang="ar"] .modal-box p { text-align: right !important; } html[lang="en"] .modal-box h3, html[lang="en"] .modal-box p { text-align: left !important; }
        .modal-box .button { width: auto; padding: 8px 35px; margin-top: 10px; font-size: 1.1rem; background-color: var(--button-bg-color); border: var(--border-thickness) solid var(--border-color); color: var(--text-color-dark); border-radius: var(--pill-border-radius); transition: background-color var(--fast-transition-speed) ease, transform var(--fast-transition-speed) ease, border-color var(--fast-transition-speed) ease, color var(--fast-transition-speed) ease; }
        .modal-box .button:hover { background-color: color-mix(in srgb, var(--button-bg-color) 80%, white); border-color: color-mix(in srgb, var(--border-color) 80%, white); }
        .modal-box .button:active { transform: scale(0.96); background-color: color-mix(in srgb, var(--button-bg-color) 60%, white); }

        /* Custom Alert Text/Button Color Fix for Dark Themes (and ensure light themes use defaults) */
        body[data-theme="dark-grey"] #custom-alert-box,
        body[data-theme="night"] #custom-alert-box,
        body[data-theme="mono-dark"] #custom-alert-box { /* Added mono-dark */
            background-color: #424242; /* Darker grey */
            color: #eee; border-color: #616161;
        }
        body[data-theme="dark-grey"] #custom-alert-box h3,
        body[data-theme="night"] #custom-alert-box h3,
        body[data-theme="mono-dark"] #custom-alert-box h3 { /* Added mono-dark */
             color: #fff; -webkit-text-stroke: 0; text-stroke: 0;
        }
        body[data-theme="dark-grey"] #custom-alert-box p,
        body[data-theme="night"] #custom-alert-box p,
        body[data-theme="mono-dark"] #custom-alert-box p { /* Added mono-dark */
             color: #ddd;
        }
         /* Alert buttons already use theme variables, should adapt automatically */

        /* --- End Custom Alert Modal Styles --- */

        /* --- START: Fixes for Monochrome Dark Text Visibility --- */

        /* Cart Badge Text */
        body[data-theme="mono-dark"] .cart-badge {
            color: var(--main-bg-color-mono-dark); /* Black text on white badge */
            border-color: var(--text-color-dark-mono-dark); /* Lighter border for contrast */
        }

        /* Add to Cart Button (Preview Screen) Text */
        body[data-theme="mono-dark"] .add-to-cart-preview-button {
            color: var(--main-bg-color-mono-dark); /* Black text on white button */
        }
        body[data-theme="mono-dark"] .add-to-cart-preview-button:hover:not(:active) {
             background-color: #e0e0e0; /* Slightly off-white hover */
             color: var(--main-bg-color-mono-dark); /* Keep black text */
        }
        /* Ensure text on 'added' state button is readable */
         body[data-theme="mono-dark"] .add-to-cart-preview-button.added {
             color: var(--main-bg-color-mono-dark); /* Black text on grey bg */
             background-color: var(--pending-orange-mono-dark);
         }
         body[data-theme="mono-dark"] .add-to-cart-preview-button.added:hover:not(:active) {
             background-color: color-mix(in srgb, var(--pending-orange-mono-dark) 80%, white);
             color: var(--main-bg-color-mono-dark); /* Keep black text */
         }

        /* Active Sort/Payment Buttons Text */
        body[data-theme="mono-dark"] .sort-button.active,
        body[data-theme="mono-dark"] .payment-button.active {
            color: var(--main-bg-color-mono-dark); /* Black text on white active button */
        }

        /* Active Status Buttons (Management Screen) Text */
         body[data-theme="mono-dark"] .status-button.active {
              color: var(--main-bg-color-mono-dark); /* Black text on white active button */
         }

         /* Active Order Log Item Text (Management Screen) */
         body[data-theme="mono-dark"] .order-log-item.active {
              color: var(--main-bg-color-mono-dark); /* Black text on white active item */
         }
         body[data-theme="mono-dark"] .order-log-item.active span:not(.order-status) {
              color: inherit; /* Ensure child spans inherit black text */
         }
         /* The .order-status span keeps its specific fixed background/text colors */


        /* Management Button (Login Screen) Text on Yellow Background */
        body[data-theme="mono-dark"] #goto-admin-login-button {
            color: #000000 !important; /* Force black text on yellow */
            border-color: #000000; /* Black border */
        }
        body[data-theme="mono-dark"] #goto-admin-login-button:hover {
            color: #000000 !important; /* Keep black text */
            background-color: #ffda63 !important; /* Slightly lighter yellow */
        }

        /* Remove Button (Cart) - Ensure contrast */
        body[data-theme="mono-dark"] .remove-item-button {
             background-color: var(--remove-red-mono-dark); /* #bdbdbd */
             color: var(--main-bg-color-mono-dark); /* Black text on grey button */
             border-color: var(--text-color-dark-mono-dark); /* Lighter border */
        }
        body[data-theme="mono-dark"] .remove-item-button:hover {
             background-color: color-mix(in srgb, var(--remove-red-mono-dark) 80%, black);
        }

        /* --- END: Fixes for Monochrome Dark Text Visibility --- */


        /* Management Button Text Color Fix for Yellow/Orange Theme */
        body[data-theme="yellow"] #goto-admin-login-button,
        body[data-theme="orange"] #goto-admin-login-button {
            color: #000 !important; /* Ensure black text on yellow/orange button */
        }
        body[data-theme="yellow"] #goto-admin-login-button:hover,
        body[data-theme="orange"] #goto-admin-login-button:hover {
            color: #000 !important;
        }

        /* Fixed Buttons Positioning Update & RTL */
        .fixed-button { position: fixed; bottom: 15px; z-index: 1000; background-color: rgba(0, 0, 0, 0.5); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; padding: 0; cursor: pointer; font-size: 1.1rem; line-height: 40px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.3); transition: background-color 0.2s ease, transform 0.2s ease, left 0s, right 0s; }
        .fixed-button:hover { background-color: rgba(0, 0, 0, 0.7); transform: scale(1.1); } .fixed-button:active { transform: scale(0.95); }
        #toggle-fullscreen-btn { right: 15px; left: auto; } #settings-btn { right: 65px; left: auto; font-size: 1.2rem; }
        @media print { #toggle-fullscreen-btn, #settings-btn { display: none; } }


        /* Media Queries */
        @media (min-width: 600px) { html { font-size: 17px; } body:not(.full-screen-mode) { padding: 30px 20px; } .app-container:not(body.full-screen-mode *) { max-width: 500px; border-radius: 45px; min-height: 650px; } .screen { padding: 30px 30px; } .screen-content { padding-bottom: 80px; } .header { margin-bottom: 40px; min-height: 70px; } .header-button { padding: 10px 15px; } .cart-icon, .user-icon { width: 50px; height: 50px; font-size: 1.8rem; } .menu-grid { gap: 20px; grid-template-columns: repeat(3, 1fr); } .cart-item img { width: 75px; height: 75px; } .item-details { margin-right: 35px; } html[lang="ar"] .item-details { margin-left: 35px; margin-right: 10px; } .remove-item-button { width: 22px; height: 22px; font-size: 0.9rem; line-height: 20px; } .total-calculation { max-height: 100px; } .preview-image { max-width: 280px; } .preview-name { font-size: 1.9rem; } .preview-description { font-size: 1rem; max-width: 600px; } .preview-price { font-size: 1.4rem; } .add-to-cart-preview-button { max-width: 280px; font-size: 1.3rem; } .order-log-container { max-height: 250px; } .order-preview-section { min-height: 200px; } }
        @media (min-width: 992px) { html { font-size: 18px; } body:not(.full-screen-mode) { padding: 40px 30px; align-items: center; } .app-container:not(body.full-screen-mode *) { max-width: 800px; min-height: 700px; border-radius: 50px; } .screen { padding: 35px 40px; } .screen-content { padding-bottom: 90px; } h2 { font-size: 2.5rem; } h4 { font-size: 2rem; } #screen-5 h4 { font-size: 1.7rem; } .menu-grid { grid-template-columns: repeat(3, 1fr); gap: 30px; } .cart-total { gap: 10px; } .total-calculation { max-height: 120px; } .item-preview-container { padding-top: 20px; } .preview-image { max-width: 350px; } .preview-name { font-size: 2.2rem; } .preview-description { font-size: 1.1rem; max-width: 700px; } .preview-price { font-size: 1.5rem; padding: 8px 25px; } .add-to-cart-preview-button { max-width: 320px; padding: 14px 25px; font-size: 1.4rem; } .management-container { gap: 30px; } .order-management-layout { flex-direction: row; align-items: flex-start; gap: 25px; width: 100%; } html[lang="ar"] .order-management-layout { flex-direction: row-reverse; } .order-log-section { flex: 1 1 45%; } .order-log-container { max-height: 420px; } .order-preview-section { flex: 1 1 55%; min-height: 420px; } .order-preview-content { font-size: 1rem; } }
        @media (min-width: 1200px) { .app-container:not(body.full-screen-mode *) { max-width: 900px; } .screen { padding-left: 50px; padding-right: 50px; } .menu-grid { grid-template-columns: repeat(4, 1fr); gap: 30px; } .order-log-container { max-height: 500px; } .order-preview-section { min-height: 500px; } }

    </style>
</head>
<body data-theme="blue"> <!-- Default theme set here -->

    <!-- Fixed Buttons -->
    <button id="toggle-fullscreen-btn" class="fixed-button" title="Enter Full Screen"><i class="fas fa-expand"></i></button>
    <button id="settings-btn" class="fixed-button" title="Settings"><i class="fas fa-cog"></i></button>

    <div class="app-container">
        <!-- Screen 1: Login --> <div class="screen" id="screen-1"> <div class="screen-content"> <h2 class="screen-title" data-lang-key="welcome_title">Welcome to<br>EVA Canteen</h2> <div class="form-box"> <h3 data-lang-key="sign_in_label">sign in</h3> <input type="email" id="login-email" data-lang-placeholder-key="email_placeholder" placeholder="email....."> <input type="password" id="login-password" data-lang-placeholder-key="password_placeholder" placeholder="password*****"> <p id="login-error" class="error-message" data-lang-key="login_error_invalid">Invalid credentials (use any)</p> </div> <button class="button submit-button" id="login-submit" data-lang-key="submit_button">submit</button> <div class="switch-account"> <p data-lang-key="new_account_prompt">new account?</p> <button class="button rect-button register-button" data-target="screen-2" data-lang-key="register_button">Register</button> </div> <button class="button small-button" id="goto-admin-login-button" style="margin-top: 25px; background-color: #ffc107; width: auto;"> <i class="fas fa-cog"></i> <span data-lang-key="management_button">Management</span> </button> </div> </div>
        <!-- Screen 2: Register --> <div class="screen" id="screen-2"> <div class="screen-content"> <h2 class="screen-title" data-lang-key="welcome_title">Welcome to<br>EVA Canteen</h2> <div class="form-box"> <h3 data-lang-key="register_button">Register</h3> <input type="email" id="register-email" data-lang-placeholder-key="email_placeholder" placeholder="email....."> <input type="password" id="register-password" data-lang-placeholder-key="password_placeholder" placeholder="password*****"> <input type="password" id="register-password-confirm" data-lang-placeholder-key="password_again_placeholder" placeholder="password again*****"> <p id="register-error" class="error-message" data-lang-key="register_error_match">Passwords don't match or field empty.</p> <p class="pick-photo-label" data-lang-key="pick_photo_label">pick photo</p> <div class="photo-picker" id="register-photo-picker"> <img src="https://i.postimg.cc/6pkqNQdB/file-000000005f5052309370194ce0d09274-conversation-id-67e85992-b064-8005-abf6-a96aee541aaf-message-i.png" alt="Profile Pic 1" class="profile-pic"> <img src="https://i.postimg.cc/XYGqh5B2/IMG.png" alt="Profile Pic 2" class="profile-pic active"> <img src="https://i.postimg.cc/sXy2v068/file-000000000cb852309a865637b17bf852-conversation-id-67e85992-b064-8005-abf6-a96aee541aaf-message-i.png" alt="Profile Pic 3" class="profile-pic"> </div> </div> <button class="button submit-button" id="register-submit" data-lang-key="submit_button">submit</button> <button class="button back-button" data-target="screen-1"> <i class="fas fa-arrow-left"></i> <span data-lang-key="back_to_login_button">Back to Login</span> </button> </div> </div>
        <!-- Screen 3: Menu --> <div class="screen" id="screen-3"> <div class="screen-content">
            <div class="header">
                 <button class="header-button logout-button" id="logout-button">
                     <span data-lang-key="logout_button">Log out</span> <i class="fas fa-arrow-left"></i>
                 </button>
                 <h3 class="screen-title" data-lang-key="canteen_name">EVA Canteen</h3>
                 <div class="cart-icon-container" data-target="screen-4"> <div class="cart-icon"><i class="fas fa-shopping-cart"></i><span class="cart-badge" id="cart-badge">0</span></div> <span data-lang-key="cart_label">Cart</span> </div>
             </div>
            <div class="sort-options"> <p data-lang-key="sort_label">Sort</p> <div class="sort-buttons" id="menu-sort-buttons"> <button class="sort-button active" data-category="sweet" data-lang-key="sort_sweet">sweet</button> <button class="sort-button" data-category="lunch" data-lang-key="sort_lunch">lunch</button> <button class="sort-button" data-category="snacks" data-lang-key="sort_snacks">snacks</button> </div> </div> <div class="menu-grid" id="menu-grid"></div> </div> </div>
        <!-- Screen 4: Cart --> <div class="screen" id="screen-4"> <div class="screen-content">
            <div class="header">
                <button class="header-button" data-target="screen-3">
                    <span data-lang-key="menu_label">Menu</span> <i class="fas fa-utensils"></i>
                </button>
                <h3 class="screen-title" data-lang-key="canteen_name">EVA Canteen</h3>
                <div class="user-icon-container"> <div class="user-icon"> <img id="user-profile-image-display" src="" alt="User Profile" style="display: none;"> <i id="guest-user-icon" class="fas fa-user" style="display: block;"></i> </div> <span id="user-display-name">@guest</span> </div>
            </div> <h4 data-lang-key="cart_label">Cart</h4> <div class="cart-items" id="cart-items-container"></div> <div class="cart-total"> <h4 data-lang-key="total_label">Total</h4> <div class="total-calculation" id="total-calculation-details"></div> <div class="payment-method-section"> <p class="payment-label" data-lang-key="payment_method_label">Payment Method</p> <div class="payment-methods" id="payment-methods"> <button class="sort-button payment-button active" data-method="cash"> <i class="fas fa-money-bill-wave"></i> <span data-lang-key="payment_cash">Cash</span> </button> <button class="sort-button payment-button" data-method="card"> <i class="fas fa-credit-card"></i> <span data-lang-key="payment_card">Card</span> </button> </div> </div> <span class="final-equals">=</span> <span class="total-amount-button" id="checkout-button">0 L.E</span> </div> </div> </div>
        <!-- Screen 6: Admin Login --> <div class="screen" id="screen-6"> <div class="screen-content"> <h2 class="screen-title" data-lang-key="admin_login_title">Management<br>Login</h2> <div class="form-box"> <h3 data-lang-key="admin_enter_creds">Enter Credentials</h3> <input type="email" id="admin-email" data-lang-placeholder-key="admin_email_placeholder" placeholder="admin email....." value="admin@canteen.app"> <input type="password" id="admin-password" data-lang-placeholder-key="admin_password_placeholder" placeholder="admin password*****" value="admin123"> <p id="admin-login-error" class="error-message" data-lang-key="admin_login_error">Invalid admin credentials.</p> </div> <button class="button submit-button" id="admin-login-submit" data-lang-key="login_button">Login</button> <button class="button back-button" data-target="screen-1"> <i class="fas fa-arrow-left"></i> <span data-lang-key="back_to_welcome_button">Back to Welcome</span> </button> </div> </div>
        <!-- Screen 5: Order Management --> <div class="screen" id="screen-5"> <div class="screen-content management-container">
             <div class="header">
                 <button class="header-button back-to-login-button" id="mgmt-back-to-login">
                     <span data-lang-key="exit_button">Exit</span> <i class="fas fa-sign-out-alt"></i>
                 </button>
                 <h3 class="screen-title" data-lang-key="order_management_title">Order Management</h3>
                 <div style="width: 80px; flex-shrink: 0;"></div> <!-- Keep Spacer -->
             </div>
             <div class="search-section"> <input type="text" id="order-search-input" data-lang-placeholder-key="search_order_id_placeholder" placeholder="Search by Order ID..."> <button class="button small-button" id="order-search-button"><i class="fas fa-search"></i> <span data-lang-key="search_button">Search</span></button> </div> <div class="order-management-layout"> <div class="order-log-section"> <h4 data-lang-key="order_log_title">Order Log</h4> <div class="order-log-container" id="order-log-container"></div> </div> <div class="order-preview-section" id="order-preview-section"> <h4 data-lang-key="order_preview_title">Order Preview</h4> <div class="order-preview-content" id="order-preview-content"></div> <div class="order-status-controls" id="order-status-controls"></div> </div> </div> </div> </div>
        <!-- Screen 7: Item Preview --> <div class="screen" id="screen-7"> <div class="screen-content item-preview-container"> <div class="header"> <button class="header-button" data-target="screen-3"> <i class="fas fa-arrow-left"></i> <span data-lang-key="back_button">Back</span> </button> <h3 class="screen-title" data-lang-key="item_details_title">Item Details</h3> <div class="cart-icon-container" data-target="screen-4" style="visibility: visible;"> <div class="cart-icon"> <i class="fas fa-shopping-cart"></i> <span class="cart-badge" id="cart-badge-preview">0</span> </div> <span data-lang-key="cart_label">Cart</span> </div> </div> <img id="preview-item-image" src="https://via.placeholder.com/220x165/eee?text=Loading..." alt="Item Image" class="preview-image"> <h3 id="preview-item-name" class="preview-name" data-lang-key="item_name_placeholder">Item Name</h3> <p id="preview-item-description" class="preview-description" data-lang-key="item_description_placeholder">Item description loading...</p> <p id="preview-item-price" class="preview-price">0 L.E</p>
             <button class="button add-to-cart-preview-button" id="add-to-cart-preview-button">
                 <i class="fas fa-cart-plus"></i> <span data-lang-key="add_to_cart_button">Add to Cart</span>
             </button>
        </div> </div>

        <!-- Screen 8 Removed -->

    </div><!-- end app-container -->

     <!-- Floating Settings Panel -->
    <div id="settings-panel">
        <!-- Language Section -->
        <div class="settings-group" id="language-group">
            <span class="settings-label" data-lang-key="language_setting_label">Language</span>
            <div class="settings-current-display" id="current-language-display" tabindex="0" role="button" aria-haspopup="listbox" aria-expanded="false">
                <span id="current-language-text">English</span>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="settings-options-list language-options" id="language-options" role="listbox">
                <div class="option-item active" data-lang="en" role="option" aria-selected="true">
                    <span>English</span>
                    <i class="fas fa-check"></i>
                </div>
                <div class="option-item" data-lang="ar" role="option" aria-selected="false">
                    <span></span>
                    <i class="fas fa-check"></i>
                </div>
            </div>
        </div>

        <!-- Theme Section -->
        <div class="settings-group" id="theme-group">
            <span class="settings-label" data-lang-key="theme_setting_label">App Theme</span>
            <div class="settings-current-display" id="current-theme-display" tabindex="0" role="button" aria-haspopup="listbox" aria-expanded="false">
                <span class="theme-swatch swatch-blue" id="current-theme-swatch"></span> <!-- Initial swatch -->
                <span id="current-theme-text">Default Blue</span>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="settings-options-list theme-options" id="theme-options" role="listbox">
                <div class="option-item active" data-theme="blue" role="option" aria-selected="true">
                    <span class="theme-swatch swatch-blue"></span>
                    <span data-lang-key="theme_blue">Default Blue</span>
                    <i class="fas fa-check"></i>
                </div>
                <div class="option-item" data-theme="green" role="option" aria-selected="false">
                    <span class="theme-swatch swatch-green"></span>
                    <span data-lang-key="theme_green">Green</span>
                    <i class="fas fa-check"></i>
                </div>
                <div class="option-item" data-theme="purple" role="option" aria-selected="false">
                    <span class="theme-swatch swatch-purple"></span>
                    <span data-lang-key="theme_purple">Purple</span>
                    <i class="fas fa-check"></i>
                </div>
                 <div class="option-item" data-theme="light-blue" role="option" aria-selected="false">
                    <span class="theme-swatch swatch-light-blue"></span>
                    <span data-lang-key="theme_light_blue">Light Blue</span>
                    <i class="fas fa-check"></i>
                </div>
                 <div class="option-item" data-theme="mono-light" role="option" aria-selected="false">
                    <span class="theme-swatch swatch-mono-light"></span>
                    <span data-lang-key="theme_mono_light">Monochrome Light</span>
                    <i class="fas fa-check"></i>
                </div>
                 <div class="option-item" data-theme="dark-grey" role="option" aria-selected="false">
                    <span class="theme-swatch swatch-dark-grey"></span>
                    <span data-lang-key="theme_dark_grey">Dark Grey</span>
                    <i class="fas fa-check"></i>
                </div>
                 <div class="option-item" data-theme="night" role="option" aria-selected="false">
                    <span class="theme-swatch swatch-night"></span>
                    <span data-lang-key="theme_night">Night Mode</span>
                    <i class="fas fa-check"></i>
                </div>
                 <div class="option-item" data-theme="mono-dark" role="option" aria-selected="false">
                    <span class="theme-swatch swatch-mono-dark"></span>
                    <span data-lang-key="theme_mono_dark">Monochrome Dark</span>
                    <i class="fas fa-check"></i>
                </div>
                <!-- ADDED: Yellow Theme Option -->
                 <div class="option-item" data-theme="yellow" role="option" aria-selected="false">
                    <span class="theme-swatch swatch-yellow"></span>
                    <span data-lang-key="theme_yellow">Yellow</span>
                    <i class="fas fa-check"></i>
                </div>
                <!-- ADDED: Orange Theme Option -->
                 <div class="option-item" data-theme="orange" role="option" aria-selected="false">
                    <span class="theme-swatch swatch-orange"></span>
                    <span data-lang-key="theme_orange">Orange</span>
                    <i class="fas fa-check"></i>
                </div>
            </div>
        </div>
    </div>
    <!-- End Floating Settings Panel -->

    <!-- Custom Alert Modal -->
    <div id="custom-alert-overlay" class="modal-overlay">
        <div id="custom-alert-box" class="modal-box">
            <h3 data-lang-key="checkout_success_title">Order Confirmed!</h3>
            <p id="custom-alert-message"></p>
            <button id="custom-alert-close" class="button" data-lang-key="ok_button">OK</button>
        </div>
    </div>
    <!-- End Custom Alert Modal -->

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Element References ---
            const appContainer = document.querySelector('.app-container'),
                  allScreens = document.querySelectorAll('.screen'),
                  navigationElements = document.querySelectorAll('[data-target]'),
                  htmlElement = document.documentElement,
                  bodyElement = document.body,
                  loginEmailInput = document.getElementById('login-email'),
                  loginPasswordInput = document.getElementById('login-password'),
                  loginSubmitButton = document.getElementById('login-submit'),
                  loginErrorMsg = document.getElementById('login-error'),
                  gotoAdminLoginButton = document.getElementById('goto-admin-login-button'),
                  registerEmailInput = document.getElementById('register-email'),
                  registerPasswordInput = document.getElementById('register-password'),
                  registerPasswordConfirmInput = document.getElementById('register-password-confirm'),
                  registerPhotoPicker = document.getElementById('register-photo-picker'),
                  registerSubmitButton = document.getElementById('register-submit'),
                  registerErrorMsg = document.getElementById('register-error'),
                  logoutButton = document.getElementById('logout-button'),
                  menuGrid = document.getElementById('menu-grid'),
                  menuSortButtonsContainer = document.getElementById('menu-sort-buttons'),
                  cartBadge = document.getElementById('cart-badge'),
                  cartItemsContainer = document.getElementById('cart-items-container'),
                  totalCalculationDetails = document.getElementById('total-calculation-details'),
                  checkoutButton = document.getElementById('checkout-button'),
                  userDisplayName = document.getElementById('user-display-name'),
                  userProfileImage = document.getElementById('user-profile-image-display'),
                  guestUserIcon = document.getElementById('guest-user-icon'),
                  paymentMethodsContainer = document.getElementById('payment-methods'),
                  adminEmailInput = document.getElementById('admin-email'),
                  adminPasswordInput = document.getElementById('admin-password'),
                  adminLoginSubmitButton = document.getElementById('admin-login-submit'),
                  adminLoginErrorMsg = document.getElementById('admin-login-error'),
                  mgmtBackToLoginButton = document.getElementById('mgmt-back-to-login'),
                  orderSearchInput = document.getElementById('order-search-input'),
                  orderSearchButton = document.getElementById('order-search-button'),
                  orderLogContainer = document.getElementById('order-log-container'),
                  orderPreviewSection = document.getElementById('order-preview-section'),
                  orderPreviewContent = document.getElementById('order-preview-content'),
                  orderStatusControls = document.getElementById('order-status-controls'),
                  previewItemImage = document.getElementById('preview-item-image'),
                  previewItemName = document.getElementById('preview-item-name'),
                  previewItemDescription = document.getElementById('preview-item-description'),
                  previewItemPrice = document.getElementById('preview-item-price'),
                  addToCartPreviewButton = document.getElementById('add-to-cart-preview-button'),
                  cartBadgePreview = document.getElementById('cart-badge-preview'),
                  toggleFullScreenButton = document.getElementById('toggle-fullscreen-btn'),
                  settingsBtn = document.getElementById('settings-btn'),
                  settingsPanel = document.getElementById('settings-panel'),
                  languageGroup = document.getElementById('language-group'),
                  currentLanguageDisplay = document.getElementById('current-language-display'),
                  currentLanguageText = document.getElementById('current-language-text'),
                  languageOptions = document.getElementById('language-options'),
                  themeGroup = document.getElementById('theme-group'),
                  currentThemeDisplay = document.getElementById('current-theme-display'),
                  currentThemeText = document.getElementById('current-theme-text'),
                  currentThemeSwatch = document.getElementById('current-theme-swatch'),
                  themeOptions = document.getElementById('theme-options');
            const customAlertOverlay = document.getElementById('custom-alert-overlay');
            const customAlertBox = document.getElementById('custom-alert-box');
            const customAlertMessage = document.getElementById('custom-alert-message');
            const customAlertCloseBtn = document.getElementById('custom-alert-close');
            const customAlertTitle = customAlertBox.querySelector('h3');

            // --- State Variables ---
            let currentScreen = null,
                currentUser = null,
                cart = [],
                selectedPaymentMethod = 'cash',
                allOrders = [],
                currentAdminOrderSelection = null;
            const ADMIN_EMAIL = "admin@canteen.app",
                  ADMIN_PASSWORD = "admin123",
                  DEFAULT_PROFILE_PIC = 'https://i.postimg.cc/XYGqh5B2/IMG.png';
            let currentLanguage = localStorage.getItem('appLanguage') || 'en';
            let currentTheme = localStorage.getItem('appTheme') || 'blue';
            let previousScreenId = null;
            let previewButtonTimeout = null;


            // --- Data & Translations ---
            const baseMenuData = [ {id: 'coffee', price: 30, image: 'https://media.elwatannews.com/media/img/mediaarc/large/20237496061663046251.jpg', category: 'sweet', name_key: 'item_name_coffee', description_key: 'item_desc_coffee'}, {id: 'pizza', price: 70, image: 'https://www.foodandwine.com/thmb/4qg95tjf0mgdHqez5OLLYc0PNT4=/750x0/filters:no_upscale():max_bytes(150000):strip_icc():format(webp)/classic-cheese-pizza-FT-RECIPE0422-31a2c938fc2546c9a07b7011658cfd05.jpg', category: 'lunch', name_key: 'item_name_pizza', description_key: 'item_desc_pizza'}, {id: 'cookies', price: 20, image: 'https://interpretationfordream.com/wp-content/uploads/2024/09/069873874340983.webp', category: 'sweet', name_key: 'item_name_cookies', description_key: 'item_desc_cookies'}, {id: 'fries', price: 35, image: 'https://images.themodernproper.com/production/posts/2022/Homemade-French-Fries_8.jpg?w=1200&q=82&auto=format&fit=crop&dm=1662474181&s=687036746e03f50b6204c1390acdb537', category: 'snacks', name_key: 'item_name_fries', description_key: 'item_desc_fries'}, {id: 'burger', price: 60, image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcScReRWtq7d-yl2aIG7jOJs5FUrxeJpi-DyfZ8OycsNa_taC8mePeUW6-JE&s=10', category: 'lunch', name_key: 'item_name_burger', description_key: 'item_desc_burger'}, {id: 'soda', price: 15, image: 'https://jx.sa/8860-large_default/soda-star-water-300-ml-x-24.jpg', category: 'snacks', name_key: 'item_name_soda', description_key: 'item_desc_soda'}, {id: 'salad', price: 45, image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ5sqfCpGLeoxFBPGxFxzmygHlKJgDnU-SJHEx9hVIyhnrpGmldu20OirA&s=10', category: 'lunch', name_key: 'item_name_salad', description_key: 'item_desc_salad'}, {id: 'cake', price: 40, image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRvFIIgqKfBgFotly6OrxXqxBGO_jLh-DIINS_e-_o4gaKlk3I9tvobZaKk&s=10', category: 'sweet', name_key: 'item_name_cake', description_key: 'item_desc_cake'}, {id: 'croissant', price: 25, image: 'https://static01.nyt.com/images/2021/04/07/dining/06croissantsrex1/merlin_184841898_ccc8fb62-ee41-44e8-9ddf-b95b198b88db-articleLarge.jpg', category: 'sweet', name_key: 'item_name_croissant', description_key: 'item_desc_croissant'}, {id: 'pasta', price: 55, image: 'https://images.services.kitchenstories.io/eT6sd87C6s0sOmsM8S2IDw96_Xs=/1080x0/filters:quality(85)/images.kitchenstories.io/wagtailOriginalImages/R131-final-photo-3-sg.jpg', category: 'lunch', name_key: 'item_name_pasta', description_key: 'item_desc_pasta'}, {id: 'chips', price: 10, image: 'https://preppykitchen.com/wp-content/uploads/2024/05/Homemade-Potato-Chips-Recipe-Card.jpg', category: 'snacks', name_key: 'item_name_chips', description_key: 'item_desc_chips'}, {id: 'juice', price: 20, image: 'https://images-prod.healthline.com/hlcmsresource/images/AN_images/orange-juice-1296x728-feature.jpg', category: 'sweet', name_key: 'item_name_juice', description_key: 'item_desc_juice'}, {id: 'sandwich', price: 50, image: 'https://www.dukeshill.co.uk/cdn/shop/articles/20240725081844-chicken-20bacon-20club-20sandwich-20main-20landscape_1024x1024.jpg?v=1724401314', category: 'lunch', name_key: 'item_name_sandwich', description_key: 'item_desc_sandwich'}, {id: 'muffin', price: 22, image: 'https://www.giallozafferano.com/images/269-26998/Chocolate-Chip-Muffins_1200x800.jpg', category: 'sweet', name_key: 'item_name_muffin', description_key: 'item_desc_muffin'}, {id: 'onionrings', price: 30, image: 'https://i0.wp.com/www.angsarap.net/wp-content/uploads/2015/03/Onion-Rings-Wide.jpg', category: 'snacks', name_key: 'item_name_onionrings', description_key: 'item_desc_onionrings'}, {id: 'soup', price: 35, image: 'https://i.postimg.cc/HxCYPzWN/Soup.jpg', category: 'lunch', name_key: 'item_name_soup', description_key: 'item_desc_soup'} ];
             const translations = { welcome_title: { en: "Welcome to<br>EVA Canteen", ar: "  <br> " }, canteen_name: { en: "EVA Canteen", ar: " " }, sign_in_label: { en: "sign in", ar: " " }, email_placeholder: { en: "email.....", ar: " ....." }, password_placeholder: { en: "password*****", ar: " *****" }, password_again_placeholder: { en: "password again*****", ar: "   *****" }, submit_button: { en: "submit", ar: "" }, register_button: { en: "Register", ar: "" }, login_button: { en: "Login", ar: "" }, new_account_prompt: { en: "new account?", ar: " " }, pick_photo_label: { en: "pick photo", ar: " " }, back_to_login_button: { en: "Back to Login", ar: " " }, back_to_welcome_button: { en: "Back to Welcome", ar: " " }, back_button: { en: "Back", ar: "" }, logout_button: { en: "Log out", ar: " " }, cart_label: { en: "Cart", ar: "" }, menu_label: { en: "Menu", ar: "" }, sort_label: { en: "Sort", ar: "" }, sort_sweet: { en: "sweet", ar: "" }, sort_lunch: { en: "lunch", ar: "" }, sort_snacks: { en: "snacks", ar: "" }, total_label: { en: "Total", ar: "" }, payment_method_label: { en: "Payment Method", ar: " " }, payment_cash: { en: "Cash", ar: "" }, payment_card: { en: "Card", ar: "" }, add_to_cart_button: { en: "Add to Cart", ar: "  " }, added_to_cart_button: { en: "Added!", ar: " !" }, item_details_title: { en: "Item Details", ar: " " }, item_name_placeholder: { en: "Item Name", ar: " " }, item_description_placeholder: { en: "Item description loading...", ar: "   ..." }, cart_empty_message: { en: "Your cart is empty.", ar: " ." }, checkout_success_alert: { en: "Payment Method: {method}\nOrder ID: {id}\n\nYour order is placed (simulation).", ar: ": {total}\n : {method}\n : {id}\n\n   ()." }, checkout_success_title: { en: "Order Confirmed!", ar: "  !" }, ok_button: { en: "OK", ar: "" }, cart_is_empty_alert: { en: "Your cart is empty!", ar: " !" }, currency_symbol: { en: "L.E", ar: "." }, quantity_prefix: { en: "x", ar: "" }, login_error_invalid: { en: "Invalid credentials.", ar: "   ." }, login_error_fields: { en: "Please enter email and password.", ar: "     ." }, register_error_match: { en: "Passwords don't match or field empty.", ar: "      ." }, register_error_fields: { en: "Please fill all fields.", ar: "   ." }, register_error_photo: { en: "Please select a profile picture.", ar: "   ." }, management_button: { en: "Management", ar: "" }, admin_login_title: { en: "Management<br>Login", ar: " <br>" }, admin_enter_creds: { en: "Enter Credentials", ar: "  " }, admin_email_placeholder: { en: "admin email.....", ar: " ....." }, admin_password_placeholder: { en: "admin password*****", ar: "  *****" }, admin_login_error: { en: "Invalid admin credentials.", ar: "    ." }, exit_button: { en: "Exit", ar: "" }, order_management_title: { en: "Order Management", ar: " " }, search_order_id_placeholder: { en: "Search by Order ID...", ar: "  ..." }, search_button: { en: "Search", ar: "" }, order_log_title: { en: "Order Log", ar: " " }, no_orders_found: { en: "No orders found.", ar: "    ." }, order_preview_title: { en: "Order Preview", ar: " " }, order_preview_placeholder: { en: "Select an order from the log to view details.", ar: "     ." }, order_id_label: { en: "Order ID", ar: " " }, order_placed_label: { en: "Placed", ar: " " }, order_status_label: { en: "Status", ar: "" }, order_payment_label: { en: "Payment", ar: "" }, order_total_label: { en: "Total", ar: "" }, order_items_label: { en: "Items", ar: "" }, order_status_pending: { en: "pending", ar: " " }, order_status_preparing: { en: "preparing", ar: " " }, order_status_delivered: { en: "delivered", ar: " " },
                 settings_title: { en: "Settings", ar: "" }, settings_button_label: { en: "Settings", ar: "" }, language_setting_label: { en: "Language", ar: "" }, theme_setting_label: { en: "App Theme", ar: " " },
                 theme_blue: { en: "Blue (Default)", ar: " ()" }, theme_green: { en: "Green", ar: "" }, theme_purple: { en: "Purple", ar: "" },
                 theme_light_blue: { en: "Light Blue", ar: " " }, theme_mono_light: { en: "Monochrome Light", ar: "  " }, theme_dark_grey: { en: "Dark Grey", ar: " " }, theme_night: { en: "Night Mode", ar: " " },
                 theme_mono_dark: { en: "Monochrome Dark", ar: "  " },
                 theme_yellow: { en: "Yellow", ar: "" }, // <-- ADDED Translation
                 theme_orange: { en: "Orange", ar: "" }, // <-- ADDED Translation
                 item_name_coffee: { en: "Coffee", ar: "" }, item_name_pizza: { en: "Pizza", ar: "" }, item_name_cookies: { en: "Cookies", ar: "" }, item_name_fries: { en: "French fries", ar: " " }, item_name_burger: { en: "Burger", ar: "" }, item_name_soda: { en: "Soda", ar: "" }, item_name_salad: { en: "Salad", ar: "" }, item_name_cake: { en: "Cake Slice", ar: " " }, item_name_croissant: { en: "Croissant", ar: "" }, item_name_pasta: { en: "Pasta Aglio e Olio", ar: "   " }, item_name_chips: { en: "Potato Chips", ar: " " }, item_name_juice: { en: "Orange Juice", ar: " " }, item_name_sandwich: { en: "Club Sandwich", ar: " " }, item_name_muffin: { en: "Muffin", ar: "" }, item_name_onionrings: { en: "Onion Rings", ar: " " }, item_name_soup: { en: "Soup of the Day", ar: " " },
                 item_desc_coffee: { en: "A rich and aromatic blend, perfect to kickstart your day or enjoy a relaxing break.", ar: "         ." }, item_desc_pizza: { en: "Classic cheese pizza with a tangy tomato sauce and a crispy crust. Always a favorite!", ar: "       .   !" }, item_desc_cookies: { en: "Deliciously chewy chocolate chip cookies, baked fresh. Irresistible!", ar: "     .  !" }, item_desc_fries: { en: "Crispy golden french fries, lightly salted. The perfect side or snack.", ar: "     .      ." }, item_desc_burger: { en: "Juicy beef patty on a toasted bun with lettuce, tomato, and our special sauce.", ar: "           ." }, item_desc_soda: { en: "A cold and refreshing fizzy drink to quench your thirst.", ar: "     ." }, item_desc_salad: { en: "A fresh mix of greens, vegetables, and a light vinaigrette dressing. Healthy and tasty!", ar: "        .  !" }, item_desc_cake: { en: "A moist and decadent slice of chocolate cake with creamy frosting. Pure indulgence!", ar: "       .  !" }, item_desc_croissant: { en: "A buttery, flaky, viennoiserie pastry inspired by the shape of the Austrian kipferl.", ar: "        ." }, item_desc_pasta: { en: "Simple yet delicious Italian pasta dish with garlic, olive oil, and red pepper flakes.", ar: "           ." }, item_desc_chips: { en: "Thinly sliced potatoes, deep-fried or baked until crispy. The ultimate salty snack!", ar: "        .    !" }, item_desc_juice: { en: "Freshly squeezed orange juice, packed with Vitamin C and natural sweetness.", ar: "       ." }, item_desc_sandwich: { en: "Classic club sandwich with layers of turkey, bacon, lettuce, tomato, and mayo on toasted bread.", ar: "              ." }, item_desc_muffin: { en: "A soft and moist muffin, perfect for breakfast or a sweet treat. Ask for today's flavor!", ar: "      .    !" }, item_desc_onionrings: { en: "Thick-cut onion rings coated in a crispy batter and fried to golden perfection.", ar: "         ." }, item_desc_soup: { en: "Warm and comforting soup made fresh daily. Please ask your server for today's selection.", ar: "     .      ." }, item_desc_default: { en: "A tasty item from our menu.", ar: "   ." } };

            // --- Helper Functions ---
            function getText(key) { const ts = translations[key]; if (ts) return ts[currentLanguage] || ts['en'] || `[${key}]`; console.warn(`TKey not found: ${key}`); return `[${key}]`; }
            function getCurrency() { return getText('currency_symbol'); } function formatPrice(p) { return `${p} ${getCurrency()}`; }

            // --- Theme Switching Function ---
            function applyTheme(themeName) {
                console.log("Applying theme:", themeName);
                bodyElement.dataset.theme = themeName;
                currentTheme = themeName;
                localStorage.setItem('appTheme', themeName);
                if (settingsPanel) updateThemeDisplay();
            }

            // --- Settings Panel Logic ---
            function toggleSettingsPanel(show) { if (!settingsPanel) return; const i = settingsPanel.classList.contains('visible'); if (typeof show === 'boolean') { if (show && !i) { settingsPanel.classList.add('visible'); document.addEventListener('click', handleOutsideSettingsClick, true); updateSettingsDisplays(); } else if (!show && i) { closeAllSettingsDropdowns(); settingsPanel.classList.remove('visible'); document.removeEventListener('click', handleOutsideSettingsClick, true); } } else { toggleSettingsPanel(!i); } }
            function handleOutsideSettingsClick(e) { if (settingsPanel && !settingsPanel.contains(e.target) && settingsBtn && !settingsBtn.contains(e.target)) { toggleSettingsPanel(false); } else { const cID = currentLanguageDisplay?.contains(e.target) || currentThemeDisplay?.contains(e.target); const cIOL = languageOptions?.contains(e.target) || themeOptions?.contains(e.target); if (settingsPanel && settingsPanel.contains(e.target) && !cID && !cIOL) { closeAllSettingsDropdowns(); } } }
            function toggleSettingsDropdown(g) { if (!g) return; const o = g === languageGroup ? themeGroup : languageGroup; const i = !g.classList.contains('open'); const d = g.querySelector('.settings-current-display'); const l = g.querySelector('.settings-options-list'); if (i && o && o.classList.contains('open')) { o.classList.remove('open', 'open-upward'); const oD = o.querySelector('.settings-current-display'); if (oD) oD.setAttribute('aria-expanded', 'false'); } let u = false; if (i && d && l) { const e = 150; const r = d.getBoundingClientRect(); const sB = window.innerHeight - r.bottom - 10; const sA = r.top - 10; if (sB < e && sA > sB) { u = true; } } g.classList.remove('open-upward'); if(i) { if (u) { g.classList.add('open-upward'); } g.classList.add('open'); } else { g.classList.remove('open'); } if (d) d.setAttribute('aria-expanded', i); }
            function closeAllSettingsDropdowns() { if(languageGroup) languageGroup.classList.remove('open', 'open-upward'); if(themeGroup) themeGroup.classList.remove('open', 'open-upward'); if(currentLanguageDisplay) currentLanguageDisplay.setAttribute('aria-expanded', 'false'); if(currentThemeDisplay) currentThemeDisplay.setAttribute('aria-expanded', 'false'); }
            function updateLanguageDisplay() { const s = languageOptions?.querySelector(`.option-item[data-lang="${currentLanguage}"]`); if (s && currentLanguageText) { currentLanguageText.textContent = s.querySelector('span').textContent; languageOptions?.querySelectorAll('.option-item').forEach(i => { const a = i.dataset.lang === currentLanguage; i.classList.toggle('active', a); i.setAttribute('aria-selected', a); }); } }
            function updateThemeDisplay() { const s = themeOptions?.querySelector(`.option-item[data-theme="${currentTheme}"]`); if (s && currentThemeText && currentThemeSwatch) { const tK = s.querySelector('span:not(.theme-swatch)')?.dataset.langKey; if (tK) { currentThemeText.textContent = getText(tK); } else { currentThemeText.textContent = s.querySelector('span:not(.theme-swatch)')?.textContent || currentTheme; } const w = s.querySelector('.theme-swatch'); if (w) { currentThemeSwatch.style.background = w.style.background; currentThemeSwatch.className = 'theme-swatch'; const c = Array.from(w.classList).find(cls => cls !== 'theme-swatch'); if (c) { currentThemeSwatch.classList.add(c); } } themeOptions?.querySelectorAll('.option-item').forEach(i => { const a = i.dataset.theme === currentTheme; i.classList.toggle('active', a); i.setAttribute('aria-selected', a); }); } }
            function updateSettingsDisplays() { updateLanguageDisplay(); updateThemeDisplay(); }
            // --- End Settings Panel Logic ---

            // --- Language and UI Update Functions ---
            function updateLanguageUI() { htmlElement.lang = currentLanguage; document.querySelectorAll('[data-lang-key]').forEach(el => { const k = el.dataset.langKey, t = getText(k); if (['welcome_title', 'admin_login_title'].includes(k)) el.innerHTML = t; else if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') el.value = t; else if (el.dataset.langValueTarget) el.setAttribute(el.dataset.langValueTarget, t); else el.textContent = t; }); document.querySelectorAll('[data-lang-placeholder-key]').forEach(el => { const k = el.dataset.langPlaceholderKey; if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') el.placeholder = getText(k); }); updateSettingsDisplays(); populateMenuGrid(); updateCartUI(); if (currentScreen && currentScreen.id === 'screen-5') { const lt = currentScreen.querySelector('.order-log-section h4'); if(lt) lt.textContent = getText('order_log_title'); const pt = currentScreen.querySelector('.order-preview-section h4'); if(pt) pt.textContent = getText('order_preview_title'); renderOrderLog(); if (currentAdminOrderSelection) showOrderDetails(currentAdminOrderSelection); else clearOrderPreview(); } if (currentScreen && currentScreen.id === 'screen-7') { const ci = addToCartPreviewButton?.dataset.itemId; if (ci) showItemPreview(ci, false); } updateModalLanguage(); if (addToCartPreviewButton && addToCartPreviewButton.dataset.itemId) { const isAdded = addToCartPreviewButton.classList.contains('added'); setPreviewButtonState(isAdded); } }

            // --- Screen Management ---
            function showScreen(id, skip = false) { const t = document.getElementById(id); if (t && t !== currentScreen) { toggleSettingsPanel(false); if (currentScreen) { currentScreen.classList.remove('active'); if (currentScreen.id === 'screen-7') { resetPreviewButtonState(); } } requestAnimationFrame(() => { t.classList.add('active'); currentScreen = t; if (id === 'screen-4') updateCartUI(); if (id === 'screen-5') { renderOrderLog(); clearOrderPreview(); if(orderSearchInput) orderSearchInput.value = ''; } if (id === 'screen-6') { if(adminLoginErrorMsg) adminLoginErrorMsg.style.display = 'none'; } if (id === 'screen-7') updateCartBadge(); if (t && !skip) t.scrollTop = 0; }); } else if (!t) { console.error(`Screen ${id} not found`); } else if (t === currentScreen && !skip) { t.scrollTop = 0; toggleSettingsPanel(false); } }

            // --- User and Profile Functions ---
            function updateUserInfoUI() { if (currentUser) { const n = currentUser.email.split('@')[0]; if(userDisplayName) userDisplayName.textContent = `@${n}`; if(userProfileImage) { userProfileImage.src = currentUser.profilePic; userProfileImage.alt = `${n}'s PP`; userProfileImage.style.display = 'block'; } if(guestUserIcon) guestUserIcon.style.display = 'none'; } else { if(userDisplayName) userDisplayName.textContent = '@guest'; if(userProfileImage) { userProfileImage.src = ''; userProfileImage.alt = 'User Profile'; userProfileImage.style.display = 'none'; } if(guestUserIcon) guestUserIcon.style.display = 'block'; } }

            // --- Menu and Filtering Functions ---
            function populateMenuGrid() { if(!menuGrid || !menuSortButtonsContainer) return; menuGrid.innerHTML = ''; const a = menuSortButtonsContainer.querySelector('.sort-button.active'); let c = 'sweet'; if (a) c = a.dataset.category; else { const s = menuSortButtonsContainer.querySelector('[data-category="sweet"]'); if(s) s.classList.add('active'); } baseMenuData.forEach((item, i) => { const m = document.createElement('div'); m.className = 'menu-item'; m.dataset.id = item.id; m.dataset.category = item.category; const n = getText(item.name_key), p = formatPrice(item.price); m.innerHTML = `<img src="${item.image}" alt="${n}"><p>${n}</p><span class="price-button">${p}</span>`; if (item.category !== c) { m.classList.add('hidden'); m.style.animation = 'none'; } else m.style.animation = `fadeInItem 0.4s ${i * 0.04}s ease-out backwards`; menuGrid.appendChild(m); }); }
            function applyFilter(s, a = true) { if (!s || s.id !== 'screen-3') return; const m = s.querySelectorAll('.menu-grid .menu-item'), b = s.querySelector('.sort-buttons .sort-button.active'), c = b ? b.dataset.category : null; m.forEach((i, x) => { const v = !c || i.dataset.category === c; i.classList.toggle('hidden', !v); i.style.animation = (v && a) ? `fadeInItem 0.4s ${x * 0.04}s ease-out backwards` : 'none'; }); }

            // --- Cart Functions ---
            function updateCartBadge() { const t = cart.reduce((s, i) => s + i.quantity, 0); [cartBadge, cartBadgePreview].forEach(b => { if (b) { b.textContent = t; b.classList.toggle('visible', t > 0); } }); }
            function updateCartUI() { if(!cartItemsContainer || !totalCalculationDetails || !checkoutButton) return; cartItemsContainer.innerHTML = ''; totalCalculationDetails.innerHTML = ''; let tp = 0; const c = getCurrency(), qp = getText('quantity_prefix'); if (cart.length === 0) { cartItemsContainer.innerHTML = `<p class="empty-cart-message">${getText('cart_empty_message')}</p>`; } else { cart.forEach(i => { const itp = i.price * i.quantity; tp += itp; const ci = document.createElement('div'); ci.className = 'cart-item'; ci.dataset.id = i.id; const n = getText(i.name_key); ci.innerHTML = `<img src="${i.image}" alt="${n}"><div class="item-details"><div class="item-info"><p title="${n}">${n}</p><span class="item-quantity">${qp}${i.quantity}</span></div><span class="item-price-button">${itp} ${c}</span></div><button class="remove-item-button" title="Remove item">&times;</button>`; cartItemsContainer.appendChild(ci); totalCalculationDetails.innerHTML += `<p>${qp}${i.quantity} ${n} = ${itp} ${c}</p>`; }); } checkoutButton.textContent = `${tp} ${c}`; checkoutButton.disabled = cart.length === 0; updateCartBadge(); }
            function addToCart(id) { const d = baseMenuData.find(i => i.id === id); if (!d) return; const e = cart.find(i => i.id === id); if (e) e.quantity++; else cart.push({ ...d, quantity: 1 }); updateCartUI(); }
            function removeFromCart(id) { const i = cart.findIndex(i => i.id === id); if (i === -1) return; if (cart[i].quantity > 1) cart[i].quantity--; else cart.splice(i, 1); updateCartUI(); }

            // --- Item Preview Functions ---
            function showItemPreview(id, n = true) { const d = baseMenuData.find(i => i.id === id); if (!d || !previewItemImage || !previewItemName || !previewItemDescription || !previewItemPrice || !addToCartPreviewButton) return; const nm = getText(d.name_key), ds = getText(d.description_key || 'item_desc_default'), p = formatPrice(d.price); previewItemImage.src = d.image; previewItemImage.alt = nm; previewItemName.textContent = nm; previewItemDescription.textContent = ds; previewItemPrice.textContent = p; addToCartPreviewButton.dataset.itemId = id; setPreviewButtonState(false); if (n) showScreen('screen-7'); else updateCartBadge(); }
            function setPreviewButtonState(a) { if (!addToCartPreviewButton) return; addToCartPreviewButton.classList.toggle('added', a); const k = a ? 'added_to_cart_button' : 'add_to_cart_button'; const c = a ? 'fas fa-check' : 'fas fa-cart-plus'; let s = addToCartPreviewButton.querySelector('span'); if (!s) { s = document.createElement('span'); addToCartPreviewButton.appendChild(s); } s.dataset.langKey = k; s.textContent = getText(k); let i = addToCartPreviewButton.querySelector('i'); if (!i) { i = document.createElement('i'); addToCartPreviewButton.prepend(i); } i.className = c; i.style.marginRight = ''; i.style.marginLeft = ''; /* CSS handles LTR/RTL */ }
            function resetPreviewButtonState() { if(addToCartPreviewButton) { if (previewButtonTimeout) { clearTimeout(previewButtonTimeout); previewButtonTimeout = null; } setPreviewButtonState(false); addToCartPreviewButton.dataset.itemId = ''; } }

            // --- Order Placement and Management Functions ---
             function generateOrderId() { return `ORD-${Date.now()}-${Math.floor(Math.random()*10)}`; }
             function placeOrder() { if (cart.length === 0) { showCustomAlert(getText('cart_is_empty_alert')); return; } const t = cart.reduce((s, i) => s + (i.price * i.quantity), 0); const o = { id: generateOrderId(), items: cart.map(i => ({ id: i.id, name_key: i.name_key, price: i.price, quantity: i.quantity })), totalAmount: t, timestamp: new Date(), status: 'pending', paymentMethod: selectedPaymentMethod }; allOrders.push(o); console.log("Order Placed:", o); cart = []; selectedPaymentMethod = 'cash'; updateCartUI(); if (paymentMethodsContainer) paymentMethodsContainer.querySelectorAll('.payment-button').forEach(b => b.classList.toggle('active', b.dataset.method === 'cash')); const m = getText('checkout_success_alert').replace('{total}', formatPrice(o.totalAmount)).replace('{method}', getText(`payment_${o.paymentMethod}`)).replace('{id}', o.id); showCustomAlert(m); }
             function renderOrderLog(f = allOrders) { if(!orderLogContainer) return; orderLogContainer.innerHTML = ''; const s = [...f].sort((a, b) => b.timestamp - a.timestamp), c = getCurrency(); if (s.length === 0) { orderLogContainer.innerHTML = `<p class="no-orders-message">${getText('no_orders_found')}</p>`; return; } s.forEach(o => { const l = document.createElement('div'); l.className = 'order-log-item'; l.dataset.orderId = o.id; const t = getText(`order_status_${o.status}`); l.innerHTML = `<span class="order-id" title="${o.id}">${o.id}</span><span class="order-status ${o.status}">${t}</span><span class="order-total">${o.totalAmount} ${c}</span>`; l.classList.toggle('active', o.id === currentAdminOrderSelection); l.addEventListener('click', () => { currentAdminOrderSelection = o.id; showOrderDetails(o.id); renderOrderLog(f); }); orderLogContainer.appendChild(l); }); }
             function clearOrderPreview() { if(!orderPreviewContent || !orderStatusControls) return; orderPreviewContent.innerHTML = `<p class="order-preview-placeholder">${getText('order_preview_placeholder')}</p>`; orderStatusControls.innerHTML = ''; currentAdminOrderSelection = null; orderLogContainer?.querySelectorAll('.order-log-item.active').forEach(i => i.classList.remove('active')); }
             function showOrderDetails(id) { const o = allOrders.find(o => o.id === id); if (!o || !orderPreviewContent) { clearOrderPreview(); return; } const c = getCurrency(), l = currentLanguage === 'ar' ? 'ar-EG' : 'en-GB', ft = o.timestamp.toLocaleString(l, { day: '2-digit', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: true }), tst = getText(`order_status_${o.status}`), tp = getText(`payment_${o.paymentMethod}`); let ih = '<ul>'; o.items.forEach(i => { const n = getText(i.name_key); ih += `<li>${getText('quantity_prefix')}${i.quantity} ${n} (${i.price*i.quantity} ${c})</li>`; }); ih += '</ul>'; orderPreviewContent.innerHTML = `<p><strong>${getText('order_id_label')}:</strong> <span>${o.id}</span></p><p><strong>${getText('order_placed_label')}:</strong> <span>${ft}</span></p><p><strong>${getText('order_status_label')}:</strong><span style="text-transform:capitalize;font-weight:bold;"> ${tst}</span></p><p><strong>${getText('order_payment_label')}:</strong><span style="text-transform:capitalize;"> ${tp}</span></p><p><strong>${getText('order_total_label')}:</strong> <span>${o.totalAmount} ${c}</span></p><p><strong>${getText('order_items_label')}:</strong></p>${ih}`; renderStatusButtons(o); }
             function renderStatusButtons(o) { if(!orderStatusControls) return; orderStatusControls.innerHTML = ''; const p = ['pending', 'preparing', 'delivered']; p.forEach(s => { const b = document.createElement('button'); b.className = 'button small-button status-button'; b.dataset.status = s; const t = getText(`order_status_${s}`); b.textContent = t.charAt(0).toUpperCase() + t.slice(1); b.disabled = (o.status === s); b.classList.toggle('active', o.status === s); let ic = ''; if (s === 'pending') ic = 'fas fa-hourglass-start'; else if (s === 'preparing') ic = 'fas fa-cogs'; else if (s === 'delivered') ic = 'fas fa-check-circle'; if(ic) { const i = document.createElement('i'); i.className = ic; b.prepend(i, ' '); } b.addEventListener('click', () => updateOrderStatus(o.id, s)); orderStatusControls.appendChild(b); }); }
             function updateOrderStatus(id, n) { const i = allOrders.findIndex(o => o.id === id); if (i === -1) return; allOrders[i].status = n; console.log(`Order ${id} status -> ${n}`); handleOrderSearch(); }
             function handleOrderSearch() { if(!orderSearchInput) return; const s = orderSearchInput.value.trim().toLowerCase(), o = s ? allOrders.filter(ord => ord.id.toLowerCase().includes(s)) : allOrders; renderOrderLog(o); if (currentAdminOrderSelection && o.some(ord => ord.id === currentAdminOrderSelection)) showOrderDetails(currentAdminOrderSelection); else clearOrderPreview(); }

            // --- Custom Alert Functions ---
            function updateModalLanguage() { if (customAlertTitle) customAlertTitle.textContent = getText('checkout_success_title'); if (customAlertCloseBtn) customAlertCloseBtn.textContent = getText('ok_button'); }
            function showCustomAlert(m) { if (!customAlertOverlay || !customAlertMessage) return; updateModalLanguage(); customAlertMessage.textContent = m; requestAnimationFrame(() => { customAlertOverlay.classList.add('visible'); }); }
            function hideCustomAlert() { if (!customAlertOverlay || !customAlertOverlay.classList.contains('visible')) return; customAlertOverlay.classList.remove('visible'); if(currentScreen?.id !== 'screen-3' && customAlertMessage?.textContent !== getText('cart_is_empty_alert')){ showScreen('screen-3'); } }
            // --- End Custom Alert Functions ---

            // --- Event Listeners ---
            navigationElements.forEach(e => e.addEventListener('click', () => { const t = e.dataset.target; if (t) showScreen(t); }));
            loginSubmitButton?.addEventListener('click', () => { const e = loginEmailInput.value.trim(), p = loginPasswordInput.value; if(!loginErrorMsg) return; loginErrorMsg.style.display = 'none'; if (e && p) { currentUser = { email: e, profilePic: DEFAULT_PROFILE_PIC }; loginEmailInput.value = ''; loginPasswordInput.value = ''; updateUserInfoUI(); showScreen('screen-3'); } else { loginErrorMsg.textContent = getText('login_error_fields'); loginErrorMsg.style.display = 'block'; } });
            gotoAdminLoginButton?.addEventListener('click', () => showScreen('screen-6'));
            registerSubmitButton?.addEventListener('click', () => { const e = registerEmailInput.value.trim(), p = registerPasswordInput.value, c = registerPasswordConfirmInput.value, a = registerPhotoPicker?.querySelector('.profile-pic.active'); if(!registerErrorMsg) return; registerErrorMsg.style.display = 'none'; if (!e || !p || !c) { registerErrorMsg.textContent = getText('register_error_fields'); registerErrorMsg.style.display = 'block'; return; } if (p !== c) { registerErrorMsg.textContent = getText('register_error_match'); registerErrorMsg.style.display = 'block'; return; } if (!a) { registerErrorMsg.textContent = getText('register_error_photo'); registerErrorMsg.style.display = 'block'; return; } currentUser = { email: e, profilePic: a.src }; registerEmailInput.value = ''; registerPasswordInput.value = ''; registerPasswordConfirmInput.value = ''; updateUserInfoUI(); showScreen('screen-3'); });
            registerPhotoPicker?.addEventListener('click', e => { if (e.target.classList.contains('profile-pic')) { registerPhotoPicker.querySelectorAll('.profile-pic').forEach(p => p.classList.remove('active')); e.target.classList.add('active'); } });
            logoutButton?.addEventListener('click', () => { currentUser = null; cart = []; selectedPaymentMethod = 'cash'; updateCartUI(); updateUserInfoUI(); if(paymentMethodsContainer) paymentMethodsContainer.querySelectorAll('.payment-button').forEach(b => b.classList.toggle('active', b.dataset.method === 'cash')); if (menuSortButtonsContainer) { const d = baseMenuData[0]?.category || 'sweet'; menuSortButtonsContainer.querySelectorAll('.sort-button').forEach(b => b.classList.toggle('active', b.dataset.category === d)); populateMenuGrid(); } showScreen('screen-1'); });
            menuGrid?.addEventListener('click', e => { const m = e.target.closest('.menu-item'), p = e.target.closest('.price-button'); if (m) { const id = m.dataset.id; if (p) { addToCart(id); p.style.transition = 'transform 0.1s ease-out, background-color 0.1s ease-out'; p.style.backgroundColor = 'var(--active-green)'; p.style.transform = 'scale(1.1)'; setTimeout(() => { p.style.backgroundColor = ''; p.style.transform = ''; setTimeout(() => p.style.transition = '', 150); }, 150); } else { showItemPreview(id); } } });
            menuSortButtonsContainer?.addEventListener('click', e => { if (e.target.classList.contains('sort-button')) { const b = e.target; if (b.classList.contains('active')) return; menuSortButtonsContainer.querySelectorAll('.sort-button').forEach(btn => btn.classList.remove('active')); b.classList.add('active'); applyFilter(document.getElementById('screen-3'), true); } });
            paymentMethodsContainer?.addEventListener('click', e => { const b = e.target.closest('.payment-button'); if (b && !b.classList.contains('active')) { selectedPaymentMethod = b.dataset.method; paymentMethodsContainer.querySelectorAll('.payment-button').forEach(btn => btn.classList.remove('active')); b.classList.add('active'); } });
            cartItemsContainer?.addEventListener('click', e => { if (e.target.classList.contains('remove-item-button')) { const c = e.target.closest('.cart-item'), id = c?.dataset.id; if (id) removeFromCart(id); } });
            checkoutButton?.addEventListener('click', () => { placeOrder(); });
            adminLoginSubmitButton?.addEventListener('click', () => { const e = adminEmailInput.value, p = adminPasswordInput.value; if(!adminLoginErrorMsg) return; adminLoginErrorMsg.style.display = 'none'; if (e === ADMIN_EMAIL && p === ADMIN_PASSWORD) { console.log("Admin login OK"); showScreen('screen-5'); } else { console.log("Admin login FAIL"); adminLoginErrorMsg.textContent = getText('admin_login_error'); adminLoginErrorMsg.style.display = 'block'; } });
            mgmtBackToLoginButton?.addEventListener('click', () => { clearOrderPreview(); if(orderSearchInput) orderSearchInput.value = ''; showScreen('screen-1'); });
            orderSearchButton?.addEventListener('click', handleOrderSearch);
            orderSearchInput?.addEventListener('keypress', e => { if (e.key === 'Enter') handleOrderSearch(); });
            orderSearchInput?.addEventListener('input', () => { if (orderSearchInput.value.trim() === '') handleOrderSearch(); });
            addToCartPreviewButton?.addEventListener('click', e => { const b = e.target.closest('button'), id = b?.dataset.itemId; if (id) { addToCart(id); if (previewButtonTimeout) { clearTimeout(previewButtonTimeout); } setPreviewButtonState(true); previewButtonTimeout = setTimeout(() => { if (currentScreen && currentScreen.id === 'screen-7' && addToCartPreviewButton.dataset.itemId === id) { setPreviewButtonState(false); } previewButtonTimeout = null; }, 1500); } });
            toggleFullScreenButton?.addEventListener('click', () => { bodyElement.classList.toggle('full-screen-mode'); const f = bodyElement.classList.contains('full-screen-mode'); toggleFullScreenButton.innerHTML = f ? '<i class="fas fa-compress"></i>' : '<i class="fas fa-expand"></i>'; toggleFullScreenButton.title = f ? 'Exit Full Screen' : 'Enter Full Screen'; });

            // --- Settings Panel Event Listeners ---
             if (settingsBtn) { settingsBtn.addEventListener('click', (e) => { e.stopPropagation(); toggleSettingsPanel(); }); }
            if (currentLanguageDisplay) { currentLanguageDisplay.addEventListener('click', (e) => { e.stopPropagation(); toggleSettingsDropdown(languageGroup); }); currentLanguageDisplay.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggleSettingsDropdown(languageGroup); } }); }
            if (currentThemeDisplay) { currentThemeDisplay.addEventListener('click', (e) => { e.stopPropagation(); toggleSettingsDropdown(themeGroup); }); currentThemeDisplay.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggleSettingsDropdown(themeGroup); } }); }
            if (languageOptions) { languageOptions.addEventListener('click', (e) => { const o = e.target.closest('.option-item[data-lang]'); if (o && !o.classList.contains('active')) { const n = o.dataset.lang; appContainer.classList.add('language-switching'); setTimeout(() => { currentLanguage = n; localStorage.setItem('appLanguage', currentLanguage); updateLanguageUI(); closeAllSettingsDropdowns(); requestAnimationFrame(() => { appContainer.classList.remove('language-switching'); }); }, parseFloat(getComputedStyle(appContainer).getPropertyValue('--lang-change-speed') || '0.3') * 1000); } else if (o) { closeAllSettingsDropdowns(); } }); }
            if (themeOptions) { themeOptions.addEventListener('click', (e) => { const o = e.target.closest('.option-item[data-theme]'); if (o && !o.classList.contains('active')) { const n = o.dataset.theme; applyTheme(n); updateThemeDisplay(); closeAllSettingsDropdowns(); } else if (o) { closeAllSettingsDropdowns(); } }); }
            // --- End Settings Panel Event Listeners ---

            // --- Custom Alert Event Listeners ---
            customAlertCloseBtn?.addEventListener('click', hideCustomAlert);
            customAlertOverlay?.addEventListener('click', (e) => { if (e.target === customAlertOverlay) { hideCustomAlert(); } });
            // --- End Custom Alert Event Listeners ---

            // --- Initialization ---
            applyTheme(currentTheme);
            updateLanguageUI();
            updateSettingsDisplays();
            showScreen('screen-1');
            updateCartUI();
            updateUserInfoUI();
        });
    </script>

</body>
</html>
