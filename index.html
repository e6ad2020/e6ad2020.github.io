<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Crucial for responsiveness -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EVA Canteen App - Responsive v1 (Toggle View + Spring Effect)</title> <!-- Updated Title -->
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            /* Adjusted Colors */
            --main-bg-color: #48B4F6;
            --lighter-blue-bg: #6ADDEF;
            --button-bg-color: #6ADDEF;
            --active-green: #90EE90;
            --remove-red: #FF6B6B;
            --pending-orange: #FFA500;
            --delivered-green: #32CD32;
            --preparing-yellow: #FFD700;
            --text-color-dark: #000;
            --text-color-light: #fff;
            --border-color: #000;
            /* Sizes & Radii */
            --screen-min-height: 600px;
            --screen-border-radius: 35px;
            --element-border-radius: 10px;
            --pill-border-radius: 50px;
            --border-thickness: 2px;
            /* Transitions */
            --transition-speed: 0.3s;
            --fast-transition-speed: 0.15s;
            --view-change-speed: 0.4s;
        }

        html {
             font-size: 16px;
             scroll-behavior: smooth;
             height: 100%;
             box-sizing: border-box;
        }
        *, *:before, *:after {
            box-sizing: inherit;
        }

        /* DEFAULT BODY STYLES (Desktop View) */
        body {
            background-color: #282828;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px 10px;
            font-family: 'Nunito', sans-serif;
            margin: 0;
            min-height: 100vh;
            overflow-x: hidden;
            transition: padding var(--view-change-speed) ease, background-color var(--view-change-speed) ease;
        }

        /* App Container - Base (Desktop View) Style */
        .app-container {
            width: 100%;
            max-width: 340px;
            min-height: var(--screen-min-height);
            position: relative;
            overflow: hidden; /* Keep this to contain screen animations */
            border-radius: var(--screen-border-radius);
            border: var(--border-thickness) solid var(--border-color);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            background-color: var(--main-bg-color);
            margin: 0 auto;
            transition: max-width var(--view-change-speed) ease,
                        min-height var(--view-change-speed) ease,
                        height var(--view-change-speed) ease,
                        width var(--view-change-speed) ease,
                        margin var(--view-change-speed) ease,
                        border-radius var(--view-change-speed) ease,
                        border var(--view-change-speed) ease,
                        box-shadow var(--view-change-speed) ease;
        }

        /* --- START: Full Screen Mode Styles --- */
        body.full-screen-mode {
            padding: 0;
            background-color: var(--main-bg-color);
            align-items: stretch;
            overflow: hidden;
             height: 100%;
        }

        body.full-screen-mode .app-container {
            max-width: none;
            margin: 0;
            border: none;
            border-radius: 0;
            box-shadow: none;
            width: 100%;
            height: 100%;
            min-height: 100%;
        }
        /* --- END: Full Screen Mode Styles --- */


        /* Screen Styling & Transitions */
        .screen {
            background-color: var(--main-bg-color);
            width: 100%;
            height: 100%;
            padding: 25px 20px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            pointer-events: none;
            /* --- MODIFICATION: Add Spring Effect START --- */
            transform: translateY(40px); /* Start slightly below */
            transition: opacity var(--transition-speed) ease-in-out,
                        transform calc(var(--transition-speed) * 1.5) cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Opacity fade + Springy transform */
            /* --- MODIFICATION: Add Spring Effect END --- */
            overflow-y: auto;
            z-index: 1;
        }
        .screen.active {
            opacity: 1;
            pointer-events: auto;
            /* --- MODIFICATION: Add Spring Effect START --- */
            transform: translateY(0); /* Move to final position */
             /* --- MODIFICATION: Add Spring Effect END --- */
            z-index: 2;
        }
        .screen-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            flex-grow: 1;
             max-width: 1100px;
             margin-left: auto;
             margin-right: auto;
             padding-bottom: 30px;
        }

        /* Headings */
        h2 {
             color: var(--text-color-light); -webkit-text-stroke: 1px var(--text-color-dark); text-stroke: 1px var(--text-color-dark); paint-order: stroke fill; font-size: 2rem; margin-bottom: 25px; text-align: center; font-weight: 700;
        }
         h3:not(.screen-title) {
            color: var(--text-color-dark); font-size: 1.3rem; margin-bottom: 20px; text-align: center;
        }
        h4 {
            color: var(--text-color-light); -webkit-text-stroke: 1px var(--text-color-dark); text-stroke: 1px var(--text-color-dark); paint-order: stroke fill; font-size: 1.8rem; margin-top: 10px; margin-bottom: 20px; align-self: center; font-weight: 700;
        }
         #screen-5 h4 { /* Mgmt titles */
            font-size: 1.5rem; margin-bottom: 10px; color: var(--text-color-dark); -webkit-text-stroke: none; text-stroke: none;
        }


        /* Forms */
        .form-box {
            width: 100%; margin-bottom: 25px; display: flex; flex-direction: column; align-items: center;
             max-width: 450px;
        }
        .form-box h3 { margin-bottom: 20px; font-size: 1.5rem; color: var(--text-color-dark); }
        input[type="email"], input[type="password"], input[type="text"] {
            background-color: var(--lighter-blue-bg); border: var(--border-thickness) solid var(--border-color); border-radius: var(--element-border-radius); padding: 12px 15px; margin-bottom: 15px; width: 100%; box-sizing: border-box; color: var(--text-color-dark); font-size: 1rem; text-align: center; transition: box-shadow var(--fast-transition-speed) ease;
        }
        input:focus { outline: none; box-shadow: 0 0 0 2px var(--active-green); }
        input::placeholder { color: #555; text-align: center; }
        .error-message { color: red; font-size: 0.9rem; display: none; margin-top: -10px; margin-bottom: 10px; }


        /* Buttons */
        .button { border: var(--border-thickness) solid var(--border-color); border-radius: var(--pill-border-radius); padding: 10px 25px; cursor: pointer; font-size: 1.1rem; font-weight: 600; text-align: center; background-color: var(--lighter-blue-bg); color: var(--text-color-dark); transition: background-color var(--fast-transition-speed) ease, transform var(--fast-transition-speed) ease; width: 70%; margin-top: 15px; box-sizing: border-box; user-select: none;
            max-width: 350px;
        }
        .button:hover { background-color: #8beeff; }
        .button:active { transform: scale(0.96); background-color: #a1f1ff; }
        .button.rect-button { border-radius: var(--element-border-radius); width: 100%; }
        .button.submit-button { width: auto; padding: 10px 35px; margin-top: 25px; font-size: 1.2rem; }
        .button.small-button { font-size: 0.9rem; padding: 6px 15px; width: auto; margin-top: 5px; }
        .button.back-button { width: auto; padding: 8px 20px; font-size: 0.9rem; margin-top: 20px; background: transparent; border: none; }


        /* Login/Register Specific */
        .switch-account { margin-top: 40px; text-align: center; width: 80%; max-width: 350px; }
        .switch-account p { font-size: 0.9rem; color: var(--text-color-dark); margin-bottom: 8px; }
        .pick-photo-label { font-size: 1.1rem; color: var(--text-color-dark); margin-top: 20px; margin-bottom: 15px; font-weight: 600; }
        .photo-picker { display: flex; justify-content: center; gap: 20px; margin-bottom: 30px; flex-wrap: wrap; }
        .profile-pic { width: 70px; height: 70px; border-radius: 50%; border: 3px solid transparent; cursor: pointer; object-fit: cover; transition: border-color var(--transition-speed) ease, transform var(--fast-transition-speed) ease; background-color: #eee; }
        .profile-pic:active { transform: scale(0.95); }
        .profile-pic.active { border-color: var(--border-color); transform: scale(1.05); }

        /* Header (Menu/Cart/Mgmt/Preview) */
        .header {
            display: flex; align-items: center; justify-content: space-between; width: 100%; margin-bottom: 30px; padding: 0; position: relative; min-height: 60px; gap: 10px;
        }
        .header h3.screen-title {
            flex-grow: 1; text-align: center; margin: 0; padding-top: 0; font-size: 1.8rem; color: var(--text-color-light); -webkit-text-stroke: 1px var(--text-color-dark); text-stroke: 1px var(--text-color-dark); paint-order: stroke fill; font-weight: 700;
        }
        .header-button {
            margin-top: 0; flex-shrink: 0; background: var(--lighter-blue-bg); border: var(--border-thickness) solid var(--border-color); border-radius: var(--element-border-radius); padding: 8px 12px; cursor: pointer; font-size: 0.9rem; font-weight: 600; color: var(--text-color-dark); display: flex; align-items: center; gap: 8px; white-space: nowrap; transition: background-color var(--fast-transition-speed) ease, transform var(--fast-transition-speed) ease; user-select: none;
        }
        .header-button:active { transform: scale(0.96); background-color: #a1f1ff; }
        .header-button i { font-size: 1.1em; }

        /* Icon Containers in Header */
        .cart-icon-container, .user-icon-container {
            margin-top: 0; flex-shrink: 0; position: relative; display: flex; flex-direction: column; align-items: center; gap: 3px; min-width: 50px; cursor: pointer; user-select: none; transition: transform var(--fast-transition-speed) ease;
        }
        .cart-icon-container:active, .user-icon-container:active { transform: scale(0.95); }
        .cart-icon, .user-icon { width: 45px; height: 45px; border-radius: 50%; border: var(--border-thickness) solid var(--border-color); background-color: var(--lighter-blue-bg); display: flex; justify-content: center; align-items: center; font-size: 1.6rem; color: var(--text-color-dark); transition: background-color var(--fast-transition-speed) ease; overflow: hidden; /* Ensure image stays within bounds */ }
        /* Style for the profile image inside the user icon */
        .user-icon img { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; display: none; /* Initially hidden */ }
        /* Style for the guest icon */
        .user-icon i.fa-user { display: block; /* Initially visible */ }
        .cart-icon-container:hover .cart-icon, .user-icon-container:hover .user-icon { background-color: #8beeff; }
        .cart-icon-container span, .user-icon-container span { font-size: 0.8rem; font-weight: 600; color: var(--text-color-dark); }
        .cart-badge { position: absolute; top: -5px; right: -5px; background-color: var(--active-green); color: var(--text-color-light); border-radius: 50%; width: 22px; height: 22px; font-size: 0.8rem; font-weight: 700; display: flex; justify-content: center; align-items: center; border: 1px solid var(--border-color); transform-origin: center; animation: pulseBadge 1.5s infinite ease-in-out; display: none; }
        .cart-badge.visible { display: flex; }
        @keyframes pulseBadge { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }


        /* Sort Options */
        .sort-options { display: flex; flex-direction: column; align-items: center; width: 100%; margin-bottom: 25px; }
        .sort-options p { margin: 0 0 10px 0; font-size: 1.2rem; font-weight: 600; color: var(--text-color-dark); }
        .sort-buttons { display: flex; gap: 10px; border: var(--border-thickness) solid var(--border-color); border-radius: var(--pill-border-radius); padding: 5px; background-color: rgba(255, 255, 255, 0.2); flex-wrap: wrap; justify-content: center; }
        .sort-button { background: none; border: none; border-radius: var(--pill-border-radius); padding: 6px 18px; cursor: pointer; font-size: 1rem; font-weight: 600; color: var(--text-color-dark); transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease, transform var(--fast-transition-speed) ease; user-select: none; margin: 2px; }
        .sort-button.active { background-color: var(--active-green); color: var(--text-color-dark); }
        .sort-button:active { transform: scale(0.96); }

        /* Menu Grid & Item Animation */
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; width: 100%; padding-bottom: 10px; }
        @keyframes fadeInItem { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .menu-item { background-color: var(--main-bg-color); border: var(--border-thickness) solid var(--border-color); border-radius: var(--element-border-radius); padding: 10px; text-align: center; flex-direction: column; align-items: center; justify-content: space-between; box-sizing: border-box; cursor: pointer; transition: transform var(--fast-transition-speed) ease, box-shadow var(--fast-transition-speed) ease; opacity: 1; animation: fadeInItem 0.5s ease-out backwards; display: flex; }
        .menu-item.hidden { display: none; }
        .menu-item:hover { transform: translateY(-3px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .menu-item:active { transform: scale(0.98) translateY(-1px); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .menu-item img {
            width: 100%;
            aspect-ratio: 4 / 3;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 10px;
            border: 1px solid rgba(0,0,0,0.1);
            background-color: #eee;
            pointer-events: none;
        }
        .menu-item p { margin: 0 0 10px 0; font-size: 1rem; font-weight: 600; color: var(--text-color-dark); pointer-events: none; }
        .menu-item .price-button { background-color: var(--button-bg-color); border: var(--border-thickness) solid var(--border-color); border-radius: var(--pill-border-radius); padding: 5px 15px; font-size: 0.9rem; font-weight: 700; color: var(--text-color-dark); display: inline-block; transition: background-color var(--fast-transition-speed) ease, transform var(--fast-transition-speed) ease; pointer-events: auto; user-select: none; z-index: 5; position: relative; }
        .menu-item .price-button:active { transform: scale(0.95); background-color: #a1f1ff; }

        /* Cart Screen Specific */
        .cart-items { width: 100%; margin-bottom: 25px; display: flex; flex-direction: column; gap: 15px; min-height: 100px;
           max-width: 600px; margin-left: auto; margin-right: auto;
        }
        .cart-item {
            display: flex;
            align-items: center; /* Ensure vertical alignment */
            background-color: var(--main-bg-color);
            border: var(--border-thickness) solid var(--border-color);
            border-radius: var(--element-border-radius);
            padding: 10px;
            gap: 10px;
            animation: fadeInItem 0.5s ease-out backwards;
            position: relative;
        }
        .cart-item img { width: 65px; height: 65px; border-radius: 5px; object-fit: cover; border: 1px solid rgba(0,0,0,0.1); background-color: #eee; flex-shrink: 0; }

        /* --- START: UPDATED Cart Item Layout CSS --- */
        .item-details {
            flex-grow: 1;
            display: flex;
            justify-content: space-between; /* Keep space between info group and price */
            align-items: center; /* Align items vertically in the center */
            gap: 10px;          /* Adjust gap between info group and price if needed */
            flex-wrap: nowrap; /* PREVENT wrapping */
            margin-right: 30px; /* Keep space for remove button */
            overflow: hidden;   /* Hide overflow to prevent breaking layout */
        }

        .item-info {
            display: flex;          /* Make it a flex container for name and quantity */
            flex-direction: row;    /* Arrange name and quantity side-by-side */
            align-items: baseline; /* Align text nicely */
            gap: 8px;              /* Space between name and quantity */
            flex-grow: 1;           /* Allow the info group to take space */
            flex-shrink: 1;         /* Allow info group to shrink if needed */
            overflow: hidden;       /* Hide overflow within the info group */
            min-width: 0;           /* Important for flex items that might overflow */
        }

        .item-info p {
            margin: 0;
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-color-dark);
            white-space: nowrap;      /* Keep name on one line */
            overflow: hidden;         /* Hide overflow */
            text-overflow: ellipsis; /* Show '...' if name is too long */
            flex-shrink: 1;           /* Allow name to shrink */
            min-width: 0;             /* Helps text-overflow work correctly in flex */
        }
        .item-info span.price-label { display: none; } /* Keep this if needed elsewhere, irrelevant for cart */

        span.item-quantity {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-color-dark);
            margin: 0;              /* Remove previous margin if any */
            white-space: nowrap;    /* Keep quantity like 'x10' together */
            flex-shrink: 0;         /* Prevent quantity from shrinking */
        }

        .item-price-button {
            background-color: var(--button-bg-color);
            border: var(--border-thickness) solid var(--border-color);
            border-radius: var(--pill-border-radius);
            padding: 6px 12px;
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--text-color-dark);
            white-space: nowrap;
            margin-left: auto; /* Keep this to push price to the right */
            flex-shrink: 0;    /* Prevent price button from shrinking */
        }
        /* --- END: UPDATED Cart Item Layout CSS --- */

        .remove-item-button { position: absolute; top: 5px; right: 5px; background: var(--remove-red); color: white; border: 1px solid var(--border-color); border-radius: 50%; width: 20px; height: 20px; font-size: 0.8rem; line-height: 18px; text-align: center; cursor: pointer; font-weight: bold; transition: background-color var(--fast-transition-speed) ease, transform var(--fast-transition-speed) ease; }
        .remove-item-button:hover { background-color: #E74C3C; }
        .remove-item-button:active { transform: scale(0.9); }

        /* Cart Total Section */
        .cart-total { padding-top: 15px; width: 100%; margin-top: auto; display: flex; flex-direction: column; align-items: center; gap: 8px;
            max-width: 600px; margin-left: auto; margin-right: auto;
        }
        .cart-total h4 { font-size: 1.5rem; margin-bottom: 5px; align-self: center; color: var(--text-color-dark); text-stroke: none; -webkit-text-stroke: none; }
        .total-calculation { text-align: center; width: 100%; font-size: 0.9rem; color: var(--text-color-dark); line-height: 1.4; max-height: 80px; overflow-y: auto; padding: 0 5px; }
        .total-calculation p { margin: 2px 0; font-weight: 600;}
        .total-calculation span.operator { display: none; }
        span.final-equals { font-size: 1.3rem; font-weight: 700; color: var(--text-color-dark); margin-top: 5px; }
        .total-amount-button { background-color: var(--button-bg-color); border: var(--border-thickness) solid var(--border-color); border-radius: var(--pill-border-radius); padding: 8px 25px; font-size: 1.2rem; font-weight: 700; color: var(--text-color-dark); display: inline-block; cursor: pointer; transition: background-color var(--fast-transition-speed) ease, transform var(--fast-transition-speed) ease; user-select: none; }
        .total-amount-button:active { transform: scale(0.96); background-color: #a1f1ff; }
        .empty-cart-message, .no-orders-message { color: var(--text-color-dark); font-weight: 600; margin: 20px 0; }

        /* Payment Method Section */
        .payment-method-section { display: flex; flex-direction: column; align-items: center; width: 100%; margin-top: 15px; margin-bottom: 10px; }
        .payment-label { margin: 0 0 8px 0; font-size: 1.1rem; font-weight: 600; color: var(--text-color-dark); }
        .payment-methods { display: flex; gap: 10px; border: var(--border-thickness) solid var(--border-color); border-radius: var(--pill-border-radius); padding: 5px; background-color: rgba(255, 255, 255, 0.2); flex-wrap: wrap; justify-content: center; }
        .payment-button { display: flex; align-items: center; gap: 8px; padding: 6px 15px; margin: 2px; }
        .payment-button i { font-size: 1.1em; }

        /* Cart Screen Specific H4 styling */
        #screen-4 h4 { color: var(--text-color-light); -webkit-text-stroke: 1px var(--text-color-dark); text-stroke: 1px var(--text-color-dark); paint-order: stroke fill; font-size: 1.8rem; margin-bottom: 20px; align-self: center; font-weight: 700; }

        /* Order Management Screen (Screen 5) Specific Styles */
        .management-container { display: flex; flex-direction: column; width: 100%; flex-grow: 1; gap: 20px; }
        .search-section { display: flex; gap: 10px; width: 100%; margin-bottom: 0; flex-wrap: wrap; }
        .search-section input { flex-grow: 1; margin-bottom: 0; min-width: 150px; }
        .search-section .button { width: auto; margin-top: 0; padding: 10px 15px; font-size: 1rem; border-radius: var(--element-border-radius); flex-shrink: 0; }
        .order-management-layout { display: flex; flex-direction: column; flex-grow: 1; gap: 15px; width: 100%; }
        .order-log-section { display: flex; flex-direction: column; width: 100%; }
        .order-log-container { max-height: 200px; overflow-y: auto; border: var(--border-thickness) solid var(--border-color); border-radius: var(--element-border-radius); padding: 10px; background-color: rgba(255, 255, 255, 0.1); display: flex; flex-direction: column; gap: 8px; }
        .order-log-item { display: flex; justify-content: space-between; align-items: center; background-color: var(--lighter-blue-bg); border: 1px solid var(--border-color); border-radius: 5px; padding: 8px 12px; cursor: pointer; transition: background-color var(--fast-transition-speed); gap: 5px; }
        .order-log-item:hover { background-color: #a1f1ff; }
        .order-log-item.active { background-color: var(--active-green); border-width: 2px; }
        .order-log-item span { font-size: 0.9rem; font-weight: 600; white-space: nowrap; }
        .order-id { flex-basis: 40%; overflow: hidden; text-overflow: ellipsis; flex-shrink: 1; }
        .order-status { flex-basis: 30%; text-align: center; text-transform: capitalize; padding: 2px 6px; border-radius: 4px; color: var(--text-color-dark); flex-shrink: 0; }
        .order-total { flex-basis: 30%; text-align: right; flex-shrink: 0; }
        /* Status Colors */
        .order-status.pending { background-color: var(--pending-orange); }
        .order-status.preparing { background-color: var(--preparing-yellow); }
        .order-status.delivered { background-color: var(--delivered-green); color: var(--text-color-light); }
        .order-preview-section { display: flex; flex-direction: column; width: 100%; border: var(--border-thickness) solid var(--border-color); border-radius: var(--element-border-radius); padding: 15px; background-color: rgba(255, 255, 255, 0.1); min-height: 150px; }
        .order-preview-content { font-size: 0.9rem; color: var(--text-color-dark); flex-grow: 1; }
        .order-preview-content p { margin: 3px 0; font-weight: 600; }
        .order-preview-content p span { font-weight: normal; }
        .order-preview-content ul { list-style: none; padding-left: 15px; margin: 5px 0; }
        .order-preview-content li { margin-bottom: 2px; font-size: 0.95em;}
        .order-preview-placeholder { text-align: center; color: #555; margin-top: 20px; }
        .order-status-controls { display: flex; gap: 10px; margin-top: 15px; justify-content: center; flex-wrap: wrap; }
        .status-button { }
        .status-button.active { background-color: var(--active-green); }
        .status-button:disabled { background-color: #ccc; cursor: not-allowed; border-color: #999; }

        /* Item Preview Screen (Screen 7) Specific Styles */
        .item-preview-container { align-items: center; padding-top: 10px; }
        .preview-image { width: 80%; max-width: 220px; height: auto; aspect-ratio: 4 / 3; object-fit: cover; border-radius: var(--element-border-radius); border: var(--border-thickness) solid var(--border-color); margin-bottom: 20px; background-color: #eee; box-shadow: 0 3px 8px rgba(0,0,0,0.15); }
        .preview-name { font-size: 1.7rem; color: var(--text-color-dark); font-weight: 700; margin-bottom: 10px; text-align: center; }
        .preview-description { font-size: 0.95rem; color: var(--text-color-dark); text-align: center; margin-bottom: 20px; margin-top: 0; padding: 0 10px; width: 95%; line-height: 1.4; max-width: 500px; }
        .preview-price { font-size: 1.3rem; font-weight: 700; color: var(--text-color-dark); margin-bottom: 30px; background-color: var(--button-bg-color); padding: 6px 20px; border-radius: var(--pill-border-radius); border: var(--border-thickness) solid var(--border-color); display: inline-block; }
        .add-to-cart-preview-button { width: 80%; max-width: 240px; margin-top: auto; margin-bottom: 15px; padding: 12px 20px; font-size: 1.2rem; display: flex; justify-content: center; align-items: center; gap: 10px; background-color: var(--active-green); border-color: var(--border-color); color: var(--text-color-dark); }
        .add-to-cart-preview-button:hover { background-color: #76d776; }
        .add-to-cart-preview-button:active { transform: scale(0.96); background-color: #a1f1ff; }
        .add-to-cart-preview-button.added { background-color: var(--pending-orange); cursor: default; }


        /* --- Responsive Adjustments --- */

        /* Medium screens */
        @media (min-width: 600px) {
            html { font-size: 17px; }
            body:not(.full-screen-mode) { padding: 30px 20px; }
            .app-container:not(body.full-screen-mode *) { max-width: 500px; border-radius: 45px; min-height: 650px; }
            .screen { padding: 30px 30px; }
            .header { margin-bottom: 40px; min-height: 70px; }
            .header-button { padding: 10px 15px; }
            .cart-icon, .user-icon { width: 50px; height: 50px; font-size: 1.8rem; }
            .menu-grid { gap: 20px; grid-template-columns: repeat(3, 1fr); }
            .cart-item img { width: 75px; height: 75px; }
            .item-details { margin-right: 35px; } /* Adjust if needed */
            .remove-item-button { width: 22px; height: 22px; font-size: 0.9rem; line-height: 20px; }
            .total-calculation { max-height: 100px; }
            .preview-image { max-width: 280px; }
            .preview-name { font-size: 1.9rem; }
            .preview-description { font-size: 1rem; max-width: 600px; }
            .preview-price { font-size: 1.4rem; }
            .add-to-cart-preview-button { max-width: 280px; font-size: 1.3rem; }
            .order-log-container { max-height: 250px; }
            .order-preview-section { min-height: 200px; }
        }

        /* Larger screens */
        @media (min-width: 992px) {
            html { font-size: 18px; }
            body:not(.full-screen-mode) { padding: 40px 30px; align-items: center; }
            .app-container:not(body.full-screen-mode *) { max-width: 800px; min-height: 700px; border-radius: 50px; }
            .screen { padding: 35px 40px; }
            .screen-content { padding-bottom: 40px; }
            h2 { font-size: 2.5rem; }
            h4 { font-size: 2rem; }
            #screen-5 h4 { font-size: 1.7rem; }
            .menu-grid { grid-template-columns: repeat(3, 1fr); gap: 30px; }
            .cart-total { gap: 10px; }
            .total-calculation { max-height: 120px; }
            .item-preview-container { padding-top: 20px; }
            .preview-image { max-width: 350px; }
            .preview-name { font-size: 2.2rem; }
            .preview-description { font-size: 1.1rem; max-width: 700px; }
            .preview-price { font-size: 1.5rem; padding: 8px 25px; }
            .add-to-cart-preview-button { max-width: 320px; padding: 14px 25px; font-size: 1.4rem; }
            .management-container { gap: 30px; }
            .order-management-layout { flex-direction: row; align-items: flex-start; gap: 25px; width: 100%; }
            .order-log-section { flex: 1 1 45%; }
            .order-log-container { max-height: 420px; }
            .order-preview-section { flex: 1 1 55%; min-height: 420px; }
            .order-preview-content { font-size: 1rem; }
        }

        /* Extra Large screens */
        @media (min-width: 1200px) {
            .app-container:not(body.full-screen-mode *) { max-width: 900px; }
            .screen { padding-left: 50px; padding-right: 50px; }
            .menu-grid { grid-template-columns: repeat(4, 1fr); gap: 30px; }
            .order-log-container { max-height: 500px; }
            .order-preview-section { min-height: 500px; }
        }

        /* --- Toggle Button Style --- */
        #toggle-fullscreen-btn {
            position: fixed; bottom: 15px; right: 15px; z-index: 1000; background-color: rgba(0, 0, 0, 0.5); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; padding: 0; cursor: pointer; font-size: 1.1rem; line-height: 40px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.3); transition: background-color 0.2s ease, transform 0.2s ease;
        }
        #toggle-fullscreen-btn:hover { background-color: rgba(0, 0, 0, 0.7); transform: scale(1.1); }
        #toggle-fullscreen-btn:active { transform: scale(0.95); }
        @media print { #toggle-fullscreen-btn { display: none; } }

    </style>
</head>
<body>
    <!-- Full Screen Toggle Button -->
    <button id="toggle-fullscreen-btn" title="Enter Full Screen">
        <i class="fas fa-expand"></i>
    </button>

    <div class="app-container">

        <!-- Screen 1: Login -->
        <div class="screen" id="screen-1">
            <div class="screen-content">
                <h2 class="screen-title">Welcome to<br>EVA Canteen</h2>
                <div class="form-box">
                    <h3>sign in</h3>
                    <input type="email" id="login-email" placeholder="email.....">
                    <input type="password" id="login-password" placeholder="password*****">
                    <p id="login-error" class="error-message">Invalid credentials (use any)</p>
                </div>
                <button class="button submit-button" id="login-submit">submit</button>
                <div class="switch-account">
                    <p>new account?</p>
                    <button class="button rect-button register-button" data-target="screen-2">Register</button>
                </div>
                <button class="button small-button" id="goto-admin-login-button" style="margin-top: 25px; background-color: #ffc107; width: auto;">
                    <i class="fas fa-cog"></i> Management
                </button>
            </div>
        </div>

        <!-- Screen 2: Register -->
        <div class="screen" id="screen-2">
             <div class="screen-content">
                 <h2 class="screen-title">Welcome to<br>EVA Canteen</h2>
                 <div class="form-box">
                     <h3>Register</h3>
                     <input type="email" id="register-email" placeholder="email.....">
                     <input type="password" id="register-password" placeholder="password*****">
                     <input type="password" id="register-password-confirm" placeholder="password again*****">
                      <p id="register-error" class="error-message">Passwords don't match or field empty.</p>
                     <p class="pick-photo-label">pick photo</p>
                     <div class="photo-picker" id="register-photo-picker">
                         <!-- Updated Profile Picture URLs -->
                         <img src="https://i.postimg.cc/6pkqNQdB/file-000000005f5052309370194ce0d09274-conversation-id-67e85992-b064-8005-abf6-a96aee541aaf-message-i.png" alt="Profile Pic 1" class="profile-pic">
                         <img src="https://i.postimg.cc/XYGqh5B2/IMG.png" alt="Profile Pic 2" class="profile-pic active"> <!-- Default active -->
                         <img src="https://i.postimg.cc/sXy2v068/file-000000000cb852309a865637b17bf852-conversation-id-67e85992-b064-8005-abf6-a96aee541aaf-message-i.png" alt="Profile Pic 3" class="profile-pic">
                     </div>
                 </div>
                 <button class="button submit-button" id="register-submit">submit</button>
                 <button class="button back-button" data-target="screen-1">Back to Login</button>
             </div>
        </div>

        <!-- Screen 3: Menu -->
        <div class="screen" id="screen-3">
            <div class="screen-content">
                 <div class="header">
                     <button class="header-button logout-button" id="logout-button">Log out <i class="fas fa-arrow-left"></i></button>
                     <h3 class="screen-title">EVA Canteen</h3>
                     <div class="cart-icon-container" data-target="screen-4">
                         <div class="cart-icon"><i class="fas fa-shopping-cart"></i><span class="cart-badge" id="cart-badge">0</span></div>
                         <span>Cart</span>
                     </div>
                 </div>
                 <div class="sort-options">
                     <p>Sort</p>
                     <div class="sort-buttons" id="menu-sort-buttons">
                         <button class="sort-button active" data-category="sweet">sweet</button>
                         <button class="sort-button" data-category="lunch">lunch</button>
                         <button class="sort-button" data-category="snacks">snacks</button>
                     </div>
                 </div>
                 <div class="menu-grid" id="menu-grid">
                      <!-- Original Items -->
                      <div class="menu-item" data-category="sweet" data-id="coffee"> <img src="https://media.elwatannews.com/media/img/mediaarc/large/20237496061663046251.jpg" alt="Coffee"> <p>Coffee</p> <span class="price-button">30 L.E</span> </div>
                      <div class="menu-item" data-category="lunch" data-id="pizza"> <img src="https://www.foodandwine.com/thmb/4qg95tjf0mgdHqez5OLLYc0PNT4=/750x0/filters:no_upscale():max_bytes(150000):strip_icc():format(webp)/classic-cheese-pizza-FT-RECIPE0422-31a2c938fc2546c9a07b7011658cfd05.jpg" alt="Pizza"> <p>Pizza</p> <span class="price-button">70 L.E</span> </div>
                      <div class="menu-item" data-category="sweet" data-id="cookies"> <img src="https://interpretationfordream.com/wp-content/uploads/2024/09/069873874340983.webp" alt="Cookies"> <p>Cookies</p> <span class="price-button">20 L.E</span> </div>
                      <div class="menu-item" data-category="snacks" data-id="fries"> <img src="https://images.themodernproper.com/production/posts/2022/Homemade-French-Fries_8.jpg?w=1200&q=82&auto=format&fit=crop&dm=1662474181&s=687036746e03f50b6204c1390acdb537" alt="French Fries"> <p>French fries</p> <span class="price-button">35 L.E</span> </div>
                      <div class="menu-item" data-category="lunch" data-id="burger"> <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcScReRWtq7d-yl2aIG7jOJs5FUrxeJpi-DyfZ8OycsNa_taC8mePeUW6-JE&s=10" alt="Burger"> <p>Burger</p> <span class="price-button">60 L.E</span> </div>
                      <div class="menu-item" data-category="snacks" data-id="soda"> <img src="https://jx.sa/8860-large_default/soda-star-water-300-ml-x-24.jpg" alt="Soda"> <p>Soda</p> <span class="price-button">15 L.E</span> </div>
                      <div class="menu-item" data-category="lunch" data-id="salad"> <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ5sqfCpGLeoxFBPGxFxzmygHlKJgDnU-SJHEx9hVIyhnrpGmldu20OirA&s=10" alt="Salad"> <p>Salad</p> <span class="price-button">45 L.E</span> </div>
                      <div class="menu-item" data-category="sweet" data-id="cake"> <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRvFIIgqKfBgFotly6OrxXqxBGO_jLh-DIINS_e-_o4gaKlk3I9tvobZaKk&s=10" alt="Cake Slice"> <p>Cake Slice</p> <span class="price-button">40 L.E</span> </div>
                      <!-- First Batch of New Items (with updated images) -->
                      <div class="menu-item" data-category="sweet" data-id="croissant"> <img src="https://static01.nyt.com/images/2021/04/07/dining/06croissantsrex1/merlin_184841898_ccc8fb62-ee41-44e8-9ddf-b95b198b88db-articleLarge.jpg" alt="Croissant"> <p>Croissant</p> <span class="price-button">25 L.E</span> </div>
                      <div class="menu-item" data-category="lunch" data-id="pasta"> <img src="https://images.services.kitchenstories.io/eT6sd87C6s0sOmsM8S2IDw96_Xs=/1080x0/filters:quality(85)/images.kitchenstories.io/wagtailOriginalImages/R131-final-photo-3-sg.jpg" alt="Pasta Aglio e Olio"> <p>Pasta Aglio e Olio</p> <span class="price-button">55 L.E</span> </div>
                      <div class="menu-item" data-category="snacks" data-id="chips"> <img src="https://preppykitchen.com/wp-content/uploads/2024/05/Homemade-Potato-Chips-Recipe-Card.jpg" alt="Potato Chips"> <p>Potato Chips</p> <span class="price-button">10 L.E</span> </div>
                      <div class="menu-item" data-category="sweet" data-id="juice"> <img src="https://images-prod.healthline.com/hlcmsresource/images/AN_images/orange-juice-1296x728-feature.jpg" alt="Orange Juice"> <p>Orange Juice</p> <span class="price-button">20 L.E</span> </div>
                      <!-- Second Batch of New Items (with updated images) -->
                      <div class="menu-item" data-category="lunch" data-id="sandwich"> <img src="https://www.dukeshill.co.uk/cdn/shop/articles/20240725081844-chicken-20bacon-20club-20sandwich-20main-20landscape_1024x1024.jpg?v=1724401314" alt="Club Sandwich"> <p>Club Sandwich</p> <span class="price-button">50 L.E</span> </div>
                      <div class="menu-item" data-category="sweet" data-id="muffin"> <img src="https://www.giallozafferano.com/images/269-26998/Chocolate-Chip-Muffins_1200x800.jpg" alt="Muffin"> <p>Muffin</p> <span class="price-button">22 L.E</span> </div>
                      <div class="menu-item" data-category="snacks" data-id="onionrings"> <img src="https://i0.wp.com/www.angsarap.net/wp-content/uploads/2015/03/Onion-Rings-Wide.jpg" alt="Onion Rings"> <p>Onion Rings</p> <span class="price-button">30 L.E</span> </div>
                      <div class="menu-item" data-category="lunch" data-id="soup"> <img src="https://www.superzu.com.au/wp-content/uploads/2020/11/Soup.jpg" alt="Soup of the Day"> <p>Soup of the Day</p> <span class="price-button">35 L.E</span> </div>
                 </div>
            </div>
        </div>

        <!-- Screen 4: Cart -->
        <div class="screen" id="screen-4">
             <div class="screen-content">
                 <div class="header">
                     <button class="header-button" data-target="screen-3">Menu <i class="fas fa-utensils"></i></button>
                     <h3 class="screen-title">EVA Canteen</h3>
                     <div class="user-icon-container">
                         <div class="user-icon">
                             <!-- Profile Image (initially hidden) -->
                             <img id="user-profile-image-display" src="" alt="User Profile" style="display: none;">
                             <!-- Guest Icon (initially visible) -->
                             <i id="guest-user-icon" class="fas fa-user" style="display: block;"></i>
                         </div>
                         <span id="user-display-name">@guest</span>
                     </div>
                 </div>
                 <h4>Cart</h4>
                 <div class="cart-items" id="cart-items-container"></div>
                 <div class="cart-total">
                     <h4>Total</h4>
                     <div class="total-calculation" id="total-calculation-details"></div>
                     <div class="payment-method-section">
                         <p class="payment-label">Payment Method</p>
                         <div class="payment-methods" id="payment-methods">
                             <button class="sort-button payment-button active" data-method="cash"><i class="fas fa-money-bill-wave"></i> Cash</button>
                             <button class="sort-button payment-button" data-method="card"><i class="fas fa-credit-card"></i> Card</button>
                         </div>
                     </div>
                     <span class="final-equals">=</span>
                     <span class="total-amount-button" id="checkout-button">0 L.E</span>
                 </div>
             </div>
        </div>

        <!-- Screen 6: Admin Login -->
        <div class="screen" id="screen-6">
             <div class="screen-content">
                 <h2 class="screen-title">Management<br>Login</h2>
                 <div class="form-box">
                     <h3>Enter Credentials</h3>
                     <input type="email" id="admin-email" placeholder="admin email....." value="admin@canteen.app">
                     <input type="password" id="admin-password" placeholder="admin password*****" value="admin123">
                     <p id="admin-login-error" class="error-message">Invalid admin credentials.</p>
                 </div>
                 <button class="button submit-button" id="admin-login-submit">Login</button>
                 <button class="button back-button" data-target="screen-1">Back to Welcome</button>
             </div>
        </div>

        <!-- Screen 5: Order Management -->
        <div class="screen" id="screen-5">
             <div class="screen-content management-container">
                 <div class="header">
                      <button class="header-button back-to-login-button" id="mgmt-back-to-login">Exit <i class="fas fa-sign-out-alt"></i></button>
                      <h3 class="screen-title">Order Management</h3>
                      <div style="width: 80px; flex-shrink: 0;"></div> <!-- Spacer -->
                 </div>
                 <div class="search-section">
                     <input type="text" id="order-search-input" placeholder="Search by Order ID...">
                     <button class="button small-button" id="order-search-button"><i class="fas fa-search"></i> Search</button>
                 </div>
                  <div class="order-management-layout">
                     <div class="order-log-section">
                         <h4>Order Log</h4>
                         <div class="order-log-container" id="order-log-container"></div>
                     </div>
                     <div class="order-preview-section" id="order-preview-section">
                          <h4>Order Preview</h4>
                          <div class="order-preview-content" id="order-preview-content">
                              <p class="order-preview-placeholder">Select an order from the log to view details.</p>
                          </div>
                          <div class="order-status-controls" id="order-status-controls"></div>
                     </div>
                 </div>
             </div>
        </div>

        <!-- Screen 7: Item Preview -->
        <div class="screen" id="screen-7">
            <div class="screen-content item-preview-container">
                <div class="header">
                    <button class="header-button" data-target="screen-3">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <h3 class="screen-title">Item Details</h3>
                    <div class="cart-icon-container" data-target="screen-4" style="visibility: visible;">
                        <div class="cart-icon">
                            <i class="fas fa-shopping-cart"></i>
                            <span class="cart-badge" id="cart-badge-preview">0</span>
                        </div>
                        <span>Cart</span>
                    </div>
                </div>

                <img id="preview-item-image" src="https://via.placeholder.com/220x165/eee?text=Loading..." alt="Item Image" class="preview-image">
                <h3 id="preview-item-name" class="preview-name">Item Name</h3>
                <p id="preview-item-description" class="preview-description">Item description loading...</p>
                <p id="preview-item-price" class="preview-price">0 L.E</p>
                <button class="button add-to-cart-preview-button" id="add-to-cart-preview-button">
                    <i class="fas fa-cart-plus"></i> Add to Cart
                </button>
            </div>
        </div>


    </div><!-- end app-container -->

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const appContainer = document.querySelector('.app-container');
            const allScreens = document.querySelectorAll('.screen');
            const navigationElements = document.querySelectorAll('[data-target]');
            // Screen 1: Login
            const loginEmailInput = document.getElementById('login-email');
            const loginPasswordInput = document.getElementById('login-password');
            const loginSubmitButton = document.getElementById('login-submit');
            const loginErrorMsg = document.getElementById('login-error');
            const gotoAdminLoginButton = document.getElementById('goto-admin-login-button');
            // Screen 2: Register
            const registerEmailInput = document.getElementById('register-email');
            const registerPasswordInput = document.getElementById('register-password');
            const registerPasswordConfirmInput = document.getElementById('register-password-confirm');
            const registerPhotoPicker = document.getElementById('register-photo-picker');
            const registerSubmitButton = document.getElementById('register-submit');
            const registerErrorMsg = document.getElementById('register-error');
            // Screen 3: Menu
            const logoutButton = document.getElementById('logout-button');
            const menuGrid = document.getElementById('menu-grid');
            const menuSortButtonsContainer = document.getElementById('menu-sort-buttons');
            const cartBadge = document.getElementById('cart-badge'); // Main badge
            // Screen 4: Cart
            const cartItemsContainer = document.getElementById('cart-items-container');
            const totalCalculationDetails = document.getElementById('total-calculation-details');
            const checkoutButton = document.getElementById('checkout-button');
            const userDisplayName = document.getElementById('user-display-name'); // Span for username
            const userProfileImage = document.getElementById('user-profile-image-display'); // Img for profile pic
            const guestUserIcon = document.getElementById('guest-user-icon'); // Icon for guest
            const paymentMethodsContainer = document.getElementById('payment-methods');
            // Screen 6: Admin Login
            const adminEmailInput = document.getElementById('admin-email');
            const adminPasswordInput = document.getElementById('admin-password');
            const adminLoginSubmitButton = document.getElementById('admin-login-submit');
            const adminLoginErrorMsg = document.getElementById('admin-login-error');
            // Screen 5: Order Management
            const mgmtBackToLoginButton = document.getElementById('mgmt-back-to-login');
            const orderSearchInput = document.getElementById('order-search-input');
            const orderSearchButton = document.getElementById('order-search-button');
            const orderLogContainer = document.getElementById('order-log-container');
            const orderPreviewSection = document.getElementById('order-preview-section');
            const orderPreviewContent = document.getElementById('order-preview-content');
            const orderStatusControls = document.getElementById('order-status-controls');
            // Screen 7: Item Preview
            const previewItemImage = document.getElementById('preview-item-image');
            const previewItemName = document.getElementById('preview-item-name');
            const previewItemDescription = document.getElementById('preview-item-description');
            const previewItemPrice = document.getElementById('preview-item-price');
            const addToCartPreviewButton = document.getElementById('add-to-cart-preview-button');
            const cartBadgePreview = document.getElementById('cart-badge-preview'); // Cart badge on preview screen
            // --- Full Screen Toggle Elements ---
            const toggleButton = document.getElementById('toggle-fullscreen-btn');
            const bodyElement = document.body;


            // --- App State ---
            let currentScreen = null;
            let currentUser = null; // { email: '...', profilePic: '...' }
            let cart = []; // Array of { id, name, price, quantity, image, description }
            let selectedPaymentMethod = 'cash'; // Default payment method
            let allOrders = []; // Array to store completed orders: { id, items: [...cart], totalAmount, timestamp, status, paymentMethod }
            let currentAdminOrderSelection = null; // ID of the order selected in the management view
            const ADMIN_EMAIL = "admin@canteen.app";
            const ADMIN_PASSWORD = "admin123";
            const DEFAULT_PROFILE_PIC = 'https://i.postimg.cc/XYGqh5B2/IMG.png'; // Default (Pic 2)


            // --- Mock Menu Data ---
            const menuData = [];

            function populateMenuData() {
                menuData.length = 0;
                const menuItemsHTML = menuGrid.querySelectorAll('.menu-item');
                 menuItemsHTML.forEach(item => {
                     const baseData = {
                        id: item.dataset.id,
                        name: item.querySelector('p').textContent,
                        price: parseInt(item.querySelector('.price-button').textContent) || 0,
                        image: item.querySelector('img').src,
                        category: item.dataset.category
                    };
                    // Add descriptions based on ID (as before)
                    switch (baseData.id) {
                        case 'coffee': baseData.description = "A rich and aromatic blend, perfect to kickstart your day or enjoy a relaxing break."; break;
                        case 'pizza': baseData.description = "Classic cheese pizza with a tangy tomato sauce and a crispy crust. Always a favorite!"; break;
                        case 'cookies': baseData.description = "Deliciously chewy chocolate chip cookies, baked fresh. Irresistible!"; break;
                        case 'fries': baseData.description = "Crispy golden french fries, lightly salted. The perfect side or snack."; break;
                        case 'burger': baseData.description = "Juicy beef patty on a toasted bun with lettuce, tomato, and our special sauce."; break;
                        case 'soda': baseData.description = "A cold and refreshing fizzy drink to quench your thirst."; break;
                        case 'salad': baseData.description = "A fresh mix of greens, vegetables, and a light vinaigrette dressing. Healthy and tasty!"; break;
                        case 'cake': baseData.description = "A moist and decadent slice of chocolate cake with creamy frosting. Pure indulgence!"; break;
                        case 'croissant': baseData.description = "A buttery, flaky, viennoiserie pastry inspired by the shape of the Austrian kipferl."; break;
                        case 'pasta': baseData.description = "Simple yet delicious Italian pasta dish with garlic, olive oil, and red pepper flakes."; break;
                        case 'chips': baseData.description = "Thinly sliced potatoes, deep-fried or baked until crispy. The ultimate salty snack!"; break;
                        case 'juice': baseData.description = "Freshly squeezed orange juice, packed with Vitamin C and natural sweetness."; break;
                        case 'sandwich': baseData.description = "Classic club sandwich with layers of turkey, bacon, lettuce, tomato, and mayo on toasted bread."; break;
                        case 'muffin': baseData.description = "A soft and moist muffin, perfect for breakfast or a sweet treat. Ask for today's flavor!"; break;
                        case 'onionrings': baseData.description = "Thick-cut onion rings coated in a crispy batter and fried to golden perfection."; break;
                        case 'soup': baseData.description = "Warm and comforting soup made fresh daily. Please ask your server for today's selection."; break;
                        default: baseData.description = "A tasty item from our menu.";
                    }
                    menuData.push(baseData);
                });
            }


            // --- Core Functions ---

             function showScreen(screenId) {
                const targetScreen = document.getElementById(screenId);
                if (targetScreen && targetScreen !== currentScreen) {
                    if (currentScreen) currentScreen.classList.remove('active');
                    // Small delay before adding active class to allow initial style (opacity 0, transform) to apply
                    requestAnimationFrame(() => {
                        targetScreen.classList.add('active');
                        currentScreen = targetScreen;

                        // Reset states/UI for specific screens when they become active
                        if(currentScreen?.id !== 'screen-7') { resetPreviewButton(); }
                        if (screenId === 'screen-4') updateCartUI();
                        if (screenId === 'screen-3') applyFilter(targetScreen);
                        if (screenId === 'screen-5') { renderOrderLog(); clearOrderPreview(); orderSearchInput.value = ''; }
                        if (screenId === 'screen-6') { adminLoginErrorMsg.style.display = 'none'; }
                        if (screenId === 'screen-7') { updateCartBadge(); }
                        if (targetScreen) { targetScreen.scrollTop = 0; } // Scroll to top on screen change
                    });

                } else if (!targetScreen) { console.error("Target screen not found:", screenId); }
                 else if (targetScreen === currentScreen) {
                     targetScreen.scrollTop = 0; // Scroll to top if clicking the current screen's link again
                 }
            }

            // Updated function to handle profile pic display
            function updateUserInfoUI() {
                if (currentUser && userProfileImage && guestUserIcon && userDisplayName) {
                    const namePart = currentUser.email.split('@')[0];
                    userDisplayName.textContent = `@${namePart}`;
                    userProfileImage.src = currentUser.profilePic;
                    userProfileImage.alt = `${namePart}'s Profile Picture`;
                    userProfileImage.style.display = 'block'; // Show the image
                    guestUserIcon.style.display = 'none';    // Hide the guest icon
                } else if (userProfileImage && guestUserIcon && userDisplayName) {
                    userDisplayName.textContent = '@guest';
                    userProfileImage.src = ''; // Clear image source
                    userProfileImage.alt = 'User Profile';
                    userProfileImage.style.display = 'none'; // Hide the image
                    guestUserIcon.style.display = 'block';   // Show the guest icon
                }
            }

            function updateCartBadge() {
                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                const badges = [cartBadge, cartBadgePreview];
                badges.forEach(badge => {
                    if (badge) {
                        if (totalItems > 0) { badge.textContent = totalItems; badge.classList.add('visible'); }
                        else { badge.textContent = '0'; badge.classList.remove('visible'); }
                    }
                });
            }

            // --- UPDATED: updateCartUI Function ---
            function updateCartUI() {
                cartItemsContainer.innerHTML = '';
                totalCalculationDetails.innerHTML = '';
                let totalPrice = 0;
                if (cart.length === 0) {
                    cartItemsContainer.innerHTML = '<p class="empty-cart-message">Your cart is empty.</p>';
                } else {
                    cart.forEach(item => {
                        const itemTotalPrice = item.price * item.quantity;
                        totalPrice += itemTotalPrice;
                        const cartItemDiv = document.createElement('div');
                        cartItemDiv.classList.add('cart-item');
                        cartItemDiv.dataset.id = item.id;

                        // Updated innerHTML structure
                        cartItemDiv.innerHTML = `
                            <img src="${item.image}" alt="${item.name}">
                            <div class="item-details">
                                <div class="item-info">
                                     <p title="${item.name}">${item.name}</p>
                                     <span class="item-quantity">x${item.quantity}</span>
                                </div>
                                <span class="item-price-button">${itemTotalPrice} L.E</span>
                            </div>
                            <button class="remove-item-button" title="Remove item">&times;</button>
                        `;
                        cartItemsContainer.appendChild(cartItemDiv);
                        totalCalculationDetails.innerHTML += `<p>x${item.quantity} ${item.name} = ${itemTotalPrice} L.E</p>`;
                    });
                }
                checkoutButton.textContent = `${totalPrice} L.E`;
                checkoutButton.disabled = cart.length === 0;
                updateCartBadge();
            }
            // --- END: UPDATED updateCartUI Function ---

            function addToCart(itemId) {
                const itemData = menuData.find(item => item.id === itemId);
                if (!itemData) { console.error("Item data not found for ID:", itemId); return; }
                const existingCartItem = cart.find(item => item.id === itemId);
                if (existingCartItem) { existingCartItem.quantity++; }
                else { cart.push({ ...itemData, quantity: 1 }); }
                updateCartUI();
            }
            function removeFromCart(itemId) {
                const itemIndex = cart.findIndex(item => item.id === itemId);
                if (itemIndex === -1) return;
                if (cart[itemIndex].quantity > 1) { cart[itemIndex].quantity--; }
                else { cart.splice(itemIndex, 1); }
                updateCartUI();
            }
            function applyFilter(screenElement) {
                if (!screenElement || screenElement.id !== 'screen-3' || !screenElement.contains(menuGrid) || !screenElement.contains(menuSortButtonsContainer)) { return; }
                const menuItems = screenElement.querySelectorAll('.menu-grid .menu-item');
                const activeButton = screenElement.querySelector('.sort-buttons .sort-button.active');
                if (!activeButton || menuItems.length === 0) { menuItems.forEach(item => item.classList.remove('hidden')); return; }
                const activeCategory = activeButton.dataset.category;
                // Apply 'hidden' first without animation for items to be hidden
                 menuItems.forEach(item => {
                    const shouldBeVisible = item.dataset.category === activeCategory;
                    if (!shouldBeVisible) {
                        item.classList.add('hidden');
                        item.style.animation = 'none'; // Prevent animation on hide
                    }
                 });
                 // Then unhide and animate items to be shown
                 menuItems.forEach((item, index) => {
                    const shouldBeVisible = item.dataset.category === activeCategory;
                    if (shouldBeVisible) {
                        item.classList.remove('hidden');
                        // Apply animation with a slight delay based on index for staggering effect
                        item.style.animation = `fadeInItem 0.5s ${index * 0.05}s ease-out backwards`;
                    }
                 });
            }
            function showItemPreview(itemId) {
                const itemData = menuData.find(item => item.id === itemId);
                if (!itemData) { console.error("Item data not found for preview:", itemId); return; }
                previewItemImage.src = itemData.image;
                previewItemImage.alt = itemData.name;
                previewItemName.textContent = itemData.name;
                previewItemDescription.textContent = itemData.description || 'No description available.';
                previewItemPrice.textContent = `${itemData.price} L.E`;
                addToCartPreviewButton.dataset.itemId = itemId;
                resetPreviewButton();
                showScreen('screen-7');
            }
            function resetPreviewButton() {
                if (addToCartPreviewButton) { addToCartPreviewButton.disabled = false; addToCartPreviewButton.classList.remove('added'); addToCartPreviewButton.innerHTML = '<i class="fas fa-cart-plus"></i> Add to Cart'; }
            }
            function generateOrderId() { return `ORD-${Date.now()}-${Math.floor(Math.random() * 10)}`; }

            // Corrected placeOrder function (from previous fix)
            function placeOrder() {
                if (cart.length === 0) return;
                const totalAmount = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                // Capture the selected payment method in the order object
                const newOrder = { id: generateOrderId(), items: JSON.parse(JSON.stringify(cart)), totalAmount: totalAmount, timestamp: new Date(), status: 'pending', paymentMethod: selectedPaymentMethod };
                allOrders.push(newOrder);
                console.log("Order Placed:", newOrder);
                cart = [];
                selectedPaymentMethod = 'cash'; // Reset for the next potential order
                updateCartUI();
                // Reset UI buttons to default (Cash)
                if(paymentMethodsContainer){
                    const paymentButtons = paymentMethodsContainer.querySelectorAll('.payment-button');
                    paymentButtons.forEach(btn => {
                        if(btn.dataset.method === 'cash') {
                            btn.classList.add('active');
                        } else {
                            btn.classList.remove('active');
                        }
                    });
                }
                // Use the payment method stored in the newOrder object for the alert
                alert(`Checkout successful! Total: ${totalAmount} L.E.\nPayment Method: ${newOrder.paymentMethod.charAt(0).toUpperCase() + newOrder.paymentMethod.slice(1)}\nOrder ID: ${newOrder.id}\nYour order is placed (simulation).`);
                // Navigate away after a delay
                setTimeout(() => showScreen('screen-3'), 1500);
            }

            function renderOrderLog(filteredOrders = allOrders) {
                orderLogContainer.innerHTML = '';
                const sortedOrders = [...filteredOrders].sort((a, b) => b.timestamp - a.timestamp);
                if (sortedOrders.length === 0) { orderLogContainer.innerHTML = '<p class="no-orders-message">No orders found.</p>'; return; }
                sortedOrders.forEach(order => {
                    const logItem = document.createElement('div');
                    logItem.classList.add('order-log-item');
                    logItem.dataset.orderId = order.id;
                    logItem.innerHTML = `<span class="order-id" title="${order.id}">${order.id}</span> <span class="order-status ${order.status}">${order.status}</span> <span class="order-total">${order.totalAmount} L.E</span>`;
                    if (order.id === currentAdminOrderSelection) { logItem.classList.add('active'); }
                    logItem.addEventListener('click', () => { currentAdminOrderSelection = order.id; showOrderDetails(order.id); renderOrderLog(filteredOrders); });
                    orderLogContainer.appendChild(logItem);
                });
            }
            function clearOrderPreview() {
                orderPreviewContent.innerHTML = '<p class="order-preview-placeholder">Select an order from the log to view details.</p>';
                orderStatusControls.innerHTML = '';
                currentAdminOrderSelection = null;
                orderLogContainer.querySelectorAll('.order-log-item.active').forEach(item => item.classList.remove('active'));
            }
            function showOrderDetails(orderId) {
                const order = allOrders.find(o => o.id === orderId);
                if (!order) { console.error("Order not found:", orderId); clearOrderPreview(); return; }
                const formattedTimestamp = order.timestamp.toLocaleString('en-GB', { day: '2-digit', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: true });
                let itemsHtml = '<ul>'; order.items.forEach(item => { itemsHtml += `<li>x${item.quantity} ${item.name} (${item.price * item.quantity} L.E)</li>`; }); itemsHtml += '</ul>';
                orderPreviewContent.innerHTML = `<p><strong>Order ID:</strong> <span>${order.id}</span></p> <p><strong>Placed:</strong> <span>${formattedTimestamp}</span></p> <p><strong>Status:</strong> <span style="text-transform: capitalize; font-weight: bold;">${order.status}</span></p> <p><strong>Payment:</strong> <span style="text-transform: capitalize;">${order.paymentMethod}</span></p> <p><strong>Total:</strong> <span>${order.totalAmount} L.E</span></p> <p><strong>Items:</strong></p> ${itemsHtml} `;
                renderStatusButtons(order);
            }
            function renderStatusButtons(order) {
                orderStatusControls.innerHTML = '';
                const possibleStatuses = ['pending', 'preparing', 'delivered'];
                possibleStatuses.forEach(status => {
                    const button = document.createElement('button');
                    button.classList.add('button', 'small-button', 'status-button');
                    button.dataset.status = status;
                    button.textContent = status.charAt(0).toUpperCase() + status.slice(1);
                    if (order.status === status) { button.classList.add('active'); button.disabled = true; }
                    let iconClass = ''; if (status === 'pending') iconClass = 'fas fa-hourglass-start'; else if (status === 'preparing') iconClass = 'fas fa-cogs'; else if (status === 'delivered') iconClass = 'fas fa-check-circle';
                    if(iconClass) { const icon = document.createElement('i'); icon.className = iconClass; button.prepend(icon, ' '); }
                    button.addEventListener('click', () => { updateOrderStatus(order.id, status); });
                    orderStatusControls.appendChild(button);
                });
            }
            function updateOrderStatus(orderId, newStatus) {
                const orderIndex = allOrders.findIndex(o => o.id === orderId);
                if (orderIndex !== -1) {
                    allOrders[orderIndex].status = newStatus;
                    console.log(`Order ${orderId} status updated to ${newStatus}`);
                    const searchTerm = orderSearchInput.value.trim().toLowerCase();
                    const ordersToDisplay = searchTerm ? allOrders.filter(o => o.id.toLowerCase().includes(searchTerm)) : allOrders;
                    renderOrderLog(ordersToDisplay);
                    showOrderDetails(orderId);
                } else { console.error("Failed to update status: Order not found", orderId); }
            }
            function handleOrderSearch() {
                const searchTerm = orderSearchInput.value.trim().toLowerCase();
                clearOrderPreview();
                const filteredOrders = searchTerm ? allOrders.filter(order => order.id.toLowerCase().includes(searchTerm)) : allOrders;
                renderOrderLog(filteredOrders);
            }


            // --- Event Listeners ---
            navigationElements.forEach(element => { element.addEventListener('click', () => { const targetScreenId = element.dataset.target; if (targetScreenId) showScreen(targetScreenId); }); });

            // Login: Set default profile pic (Pic 2 URL)
            loginSubmitButton.addEventListener('click', () => {
                const email = loginEmailInput.value.trim();
                const password = loginPasswordInput.value;
                loginErrorMsg.style.display = 'none';
                if (email && password) {
                    currentUser = {
                        email: email,
                        profilePic: DEFAULT_PROFILE_PIC // Use the constant for Pic 2
                    };
                    loginEmailInput.value = '';
                    loginPasswordInput.value = '';
                    updateUserInfoUI(); // Update UI to show the profile picture
                    showScreen('screen-3');
                } else {
                    loginErrorMsg.textContent = 'Please enter email and password.';
                    loginErrorMsg.style.display = 'block';
                }
            });

            gotoAdminLoginButton.addEventListener('click', () => showScreen('screen-6'));

            // Register: Capture selected profile pic URL
            registerSubmitButton.addEventListener('click', () => {
                const email = registerEmailInput.value.trim();
                const password = registerPasswordInput.value;
                const confirmPassword = registerPasswordConfirmInput.value;
                const activePic = registerPhotoPicker.querySelector('.profile-pic.active');
                registerErrorMsg.style.display = 'none';
                if (!email || !password || !confirmPassword) { registerErrorMsg.textContent = 'Please fill all fields.'; registerErrorMsg.style.display = 'block'; return; }
                if (password !== confirmPassword) { registerErrorMsg.textContent = "Passwords don't match."; registerErrorMsg.style.display = 'block'; return; }
                if (!activePic) { registerErrorMsg.textContent = "Please select a profile picture."; registerErrorMsg.style.display = 'block'; return; }

                currentUser = {
                    email: email,
                    profilePic: activePic.src // Get the src of the selected image
                };
                registerEmailInput.value = '';
                registerPasswordInput.value = '';
                registerPasswordConfirmInput.value = '';
                updateUserInfoUI(); // Update UI to show the selected picture
                showScreen('screen-3');
            });

            registerPhotoPicker.addEventListener('click', (event) => { if (event.target.classList.contains('profile-pic')) { registerPhotoPicker.querySelectorAll('.profile-pic').forEach(p => p.classList.remove('active')); event.target.classList.add('active'); } });
            logoutButton.addEventListener('click', () => { currentUser = null; cart = []; selectedPaymentMethod = 'cash'; updateCartUI(); updateUserInfoUI(); if(paymentMethodsContainer){ const paymentButtons = paymentMethodsContainer.querySelectorAll('.payment-button'); paymentButtons.forEach(btn => { btn.dataset.method === 'cash' ? btn.classList.add('active') : btn.classList.remove('active'); }); } if (menuSortButtonsContainer) { menuSortButtonsContainer.querySelectorAll('.sort-button').forEach(btn => { btn.dataset.category === 'sweet' ? btn.classList.add('active') : btn.classList.remove('active'); }); } showScreen('screen-1'); });
            menuGrid.addEventListener('click', (event) => { const menuItem = event.target.closest('.menu-item'); const priceButton = event.target.closest('.price-button'); if (menuItem) { const itemId = menuItem.dataset.id; if (priceButton) { addToCart(itemId); priceButton.style.transition = 'transform 0.1s ease-out, background-color 0.1s ease-out'; priceButton.style.backgroundColor = 'var(--active-green)'; priceButton.style.transform = 'scale(1.1)'; setTimeout(() => { priceButton.style.backgroundColor = ''; priceButton.style.transform = ''; setTimeout(() => priceButton.style.transition = '', 150); }, 150); } else { showItemPreview(itemId); } } });
            menuSortButtonsContainer.addEventListener('click', (event) => { if (event.target.classList.contains('sort-button')) { const button = event.target; if (button.classList.contains('active')) return; menuSortButtonsContainer.querySelectorAll('.sort-button').forEach(btn => btn.classList.remove('active')); button.classList.add('active'); applyFilter(document.getElementById('screen-3')); } });
            paymentMethodsContainer.addEventListener('click', (event) => { const button = event.target.closest('.payment-button'); if (button && !button.classList.contains('active')) { selectedPaymentMethod = button.dataset.method; paymentMethodsContainer.querySelectorAll('.payment-button').forEach(btn => btn.classList.remove('active')); button.classList.add('active'); console.log("Payment method selected:", selectedPaymentMethod); } });
            cartItemsContainer.addEventListener('click', (event) => { if (event.target.classList.contains('remove-item-button')) { const cartItemDiv = event.target.closest('.cart-item'); const itemId = cartItemDiv?.dataset.id; if (itemId) { removeFromCart(itemId); } } });
            checkoutButton.addEventListener('click', () => { if (cart.length > 0) { placeOrder(); } else { alert("Your cart is empty!"); } });
            adminLoginSubmitButton.addEventListener('click', () => { const email = adminEmailInput.value; const password = adminPasswordInput.value; adminLoginErrorMsg.style.display = 'none'; if (email === ADMIN_EMAIL && password === ADMIN_PASSWORD) { console.log("Admin login successful"); showScreen('screen-5'); } else { console.log("Admin login failed"); adminLoginErrorMsg.style.display = 'block'; } });
            mgmtBackToLoginButton.addEventListener('click', () => { clearOrderPreview(); orderSearchInput.value = ''; showScreen('screen-1'); });
            orderSearchButton.addEventListener('click', handleOrderSearch);
            orderSearchInput.addEventListener('keypress', (event) => { if (event.key === 'Enter') { handleOrderSearch(); } });
            addToCartPreviewButton.addEventListener('click', (event) => { const button = event.target.closest('button'); const itemId = button?.dataset.itemId; if (itemId && !button.disabled) { addToCart(itemId); button.disabled = true; button.classList.add('added'); button.innerHTML = '<i class="fas fa-check"></i> Added!'; setTimeout(() => { const currentPreviewItemId = addToCartPreviewButton.dataset.itemId; if(currentScreen?.id === 'screen-7' && currentPreviewItemId === itemId) { resetPreviewButton(); } }, 1500); } });
            toggleButton.addEventListener('click', () => { bodyElement.classList.toggle('full-screen-mode'); if (bodyElement.classList.contains('full-screen-mode')) { toggleButton.innerHTML = '<i class="fas fa-compress"></i>'; toggleButton.title = 'Exit Full Screen'; } else { toggleButton.innerHTML = '<i class="fas fa-expand"></i>'; toggleButton.title = 'Enter Full Screen'; } });


            // --- Initial Setup ---
            populateMenuData(); // Populate menu data from HTML
            showScreen('screen-1'); // Start at the login screen
            updateCartUI(); // Initialize cart display and badge
            updateUserInfoUI(); // Initialize user display (will show guest initially)
            applyFilter(document.getElementById('screen-3')); // Apply initial filter on menu screen

        });
    </script>

</body>
</html>